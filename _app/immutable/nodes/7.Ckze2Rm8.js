var St=n=>{throw TypeError(n)};var Gt=(n,e,t)=>e.has(n)||St("Cannot "+t);var x=(n,e,t)=>(Gt(n,e,"read from private field"),t?t.call(n):e.get(n)),E=(n,e,t)=>e.has(n)?St("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t);import{b as K,a as U,t as Kt,h as Xt}from"../chunks/disclose-version.Ds06f9Vu.js";import{a0 as C,K as w,W as I,L as Z,_ as bt,u as Yt,o as Dt,q as Mt,m as Et,j as Zt,c as u,n as X,r as p,s as v,$ as Qt}from"../chunks/runtime.5k9ShzZt.js";import{e as Vt}from"../chunks/rune_helpers.svelte.BJfa11K-.js";import{s as B}from"../chunks/render.CAjsxhF5.js";import{c as R,p as te,i as ee}from"../chunks/props.lofZ2jro.js";import{s as P,r as _t}from"../chunks/string.25aLtQ0-.js";import{d as ne,R as se,r as ie,c as re,e as oe,E as ae,f as ct,g as _e,U as N,S as Y,h as ce}from"../chunks/renderer_components.BBKIkb5V.js";import{o as de}from"../chunks/index-client.Ce0wy-IS.js";import{B as le}from"../chunks/Breadcrumb.CAHD5SKZ.js";import{a as ue,A as pe,D as ve,c as $}from"../chunks/Dealt.Bcy5Guyb.js";import{S as he,F as me,c as dt,a as fe,H as xe,b as ye}from"../chunks/Help_Button.BTNV0Dwq.js";import{R as ge}from"../chunks/Renderer_Controls.Dh9Vj2zP.js";const we=(n,e,t=Math.random)=>t()*(e-n)+n,$e=(n,e,t=Math.random)=>Math.floor(t()*(e-n+1))+n,Se=(...n)=>{let e=0,t=0,r=0,d=1;const m=n.length?n:[Date.now()];let _=be();e=_(" "),t=_(" "),r=_(" ");for(const i of m)e-=_(i),e<0&&(e+=1),t-=_(i),t<0&&(t+=1),r-=_(i),r<0&&(r+=1);_=null;const y=()=>{const i=2091639*e+d*23283064365386963e-26;return e=t,t=r,r=i-(d=i|0)};return y.uint32=()=>y()*4294967296,y.fract53=()=>y()+(y()*2097152|0)*11102230246251565e-32,y.version="Alea 0.9",y.seeds=m,y},be=()=>{let n=4022871197;return e=>{const t=e+"";for(let r=0;r<t.length;r++){n+=t.charCodeAt(r);let d=.02519603282416938*n;n=d>>>0,d-=n,d*=n,n=d>>>0,d-=n,n+=d*4294967296}return(n>>>0)*23283064365386963e-26}};var k,z,F,H,L,W,Q;class Pt{constructor(e=ne){E(this,k,C());E(this,z,C());E(this,F,C());E(this,H,C());E(this,L,C());E(this,W,C());E(this,Q,Z(()=>this.toJSON()));const{width:t=800,height:r=600,unit_count:d=72,unit_scale:m=1,renderer_type:_="pixi",simulation_speed:y=1}=e;this.width=t,this.height=r,this.unit_count=d,this.unit_scale=m,this.renderer_type=_,this.simulation_speed=y}get width(){return w(x(this,k))}set width(e){I(x(this,k),R(e))}get height(){return w(x(this,z))}set height(e){I(x(this,z),R(e))}get unit_count(){return w(x(this,F))}set unit_count(e){I(x(this,F),R(e))}get unit_scale(){return w(x(this,H))}set unit_scale(e){I(x(this,H),R(e))}get renderer_type(){return w(x(this,L))}set renderer_type(e){I(x(this,L),R(e))}get simulation_speed(){return w(x(this,W))}set simulation_speed(e){I(x(this,W),R(e))}get json(){return w(x(this,Q))}toJSON(){return{width:this.width,height:this.height,unit_count:this.unit_count,unit_scale:this.unit_scale,renderer_type:this.renderer_type,simulation_speed:this.simulation_speed}}}k=new WeakMap,z=new WeakMap,F=new WeakMap,H=new WeakMap,L=new WeakMap,W=new WeakMap,Q=new WeakMap;const Ee=n=>{if(!n)return;const e=n.startsWith("#")?n.substring(1):n;let t;try{t=JSON.parse(decodeURIComponent(e))}catch(r){console.error("Failed to parse hash:",e,r)}return console.log("parsed",t),t},De=n=>encodeURIComponent(JSON.stringify(n));var Me=Kt('<div class="p_md"><header class="pb_md"><!></header> <form class="width_md"><div class="my_md flex"><!> <div class="align_self_end"><!></div></div> <div class="mb_md"><!></div> <div class="row"><!> <input title="unit speed" type="range"></div> <fieldset><div class="row"><!> <input title="unit count" type="range"></div> <div class="row"><!> <input title="unit scale" type="range"></div></fieldset></form> <p> </p> <div class="relative"><!> <!></div> <p class="mt_lg"><!></p> <div><div> </div> <div> </div> <div> </div> <div> </div></div></div>');function Pe(n,e){Mt(e,!0);const t=te(e,"spawn_demo",23,()=>new Pt);console.log("spawn_demo.renderer_type",t().renderer_type);const r=new se(ie,t().renderer_type,t().width,t().height),d=ue.set(new pe({renderer:r})),{simulation:m}=d;re.set(d.clock),globalThis.app=d;const _=oe.set(new ae({app:d})),{project:y}=_,{scene:i}=y,lt=.002,ut=0,jt=3,pt=5,Ct=1,It=1e3,vt=.1,Rt=5,ht=.01;m.speed=t().simulation_speed,bt(()=>{t().renderer_type=r.type}),bt(()=>{t().simulation_speed=m.speed}),de(()=>{const g=_.playing;_.playing=!0;const h=i.onupdate(Ot);return()=>{h(),_.playing=g}});const S=1e5,Nt=(g,h,s,c)=>{const a=Se(g,h),l=(f,D)=>we(f,D,a);console.time("resetting scene"),i.reset(null),console.timeEnd("resetting scene"),i.add_unit(new N(i,{x:0,y:0,strength:Y,movement_multiplier:0,points:[{x:0,y:0},{x:s,y:0},{x:s,y:-S},{x:0,y:-S}]})),i.add_unit(new N(i,{x:0,y:0,strength:Y,movement_multiplier:0,points:[{x:s,y:0},{x:s,y:c},{x:s+S,y:c},{x:s+S,y:0}]})),i.add_unit(new N(i,{x:0,y:0,strength:Y,movement_multiplier:0,points:[{x:s,y:c},{x:0,y:c},{x:0,y:c+S},{x:s,y:c+S}]})),i.add_unit(new N(i,{x:0,y:0,strength:Y,movement_multiplier:0,points:[{x:0,y:c},{x:0,y:0},{x:-S,y:0},{x:-S,y:c}]})),console.log("creating shapes"),console.time("creating shapes");for(let f=0;f<g;++f)At(a()>.5?f%16===0:!1,h,l,a);console.timeEnd("creating shapes"),console.log("created "+g+" shapes"),i.json_initial=i.json};Yt(()=>{console.log("[Spawn_Demo] creating units");const g=t().unit_count,h=t().unit_scale,s=r.width,c=r.height;Zt(()=>Nt(g,h,s,c))});const Ot=g=>{for(let h=0;h<i.units.length;++h){const s=i.units[h],c=s.body.potentials();for(const a of c)if(_e(s.body,a,$)){const l=s.direction_x*$.overlap_y+s.direction_y*-$.overlap_x;s.direction_x=2*l*$.overlap_y-s.direction_x,s.direction_y=2*l*-$.overlap_x-s.direction_y;const f=a.unit.direction_x*$.overlap_y+a.unit.direction_y*-$.overlap_x;a.unit.direction_x=2*f*$.overlap_y-a.unit.direction_x,a.unit.direction_y=2*f*-$.overlap_x-a.unit.direction_y}}},At=(g,h,s,c)=>{const a=pt*1*(g?4.2*h:h),l=pt*2.5*(g?4.2*h:h),f=s(0,r.width),D=s(0,r.height),O=s(0,360)*Math.PI/180;let j;if(c()>.7)j=i.add_unit(new N(i,{x:f,y:D,radius:s(a,l)}));else{let b=[{x:-s(a,l),y:-s(a,l)},{x:s(a,l),y:-s(a,l)},{x:s(a,l),y:s(a,l)},{x:-s(a,l),y:s(a,l)}];if(c()>.17){const V=$e(0,b.length-1,c);b=b.filter((q,G)=>G!==V)}j=i.add_unit(new N(i,{x:f,y:D,points:b,angle:s(0,360)*Math.PI/180,speed:ce*s(.1,1)}))}j.direction_x=Math.cos(O),j.direction_y=Math.sin(O)};ve(n,{children:(g,h)=>{var s=Me(),c=u(s),a=u(c);le(a,{children:(o,T)=>{X();var M=K("ðŸ”®");U(o,M)},$$slots:{default:!0}}),p(c);var l=v(c,2),f=u(l),D=u(f);he(D,{project:y});var O=v(D,2),j=u(O);me(j,{}),p(O),p(f);var b=v(f,2),V=u(b);ge(V,{renderer:r}),p(b);var q=v(b,2),G=u(q);dt(G,{title:"unit speed",row:!0,step:lt,min:ut,get value(){return m.speed},set value(o){m.speed=o},children:(o,T)=>{X();var M=K("simuation speed");U(o,M)},$$slots:{default:!0}});var A=v(G,2);_t(A),P(A,"step",lt),P(A,"min",ut),P(A,"max",jt),p(q);var mt=v(q,2),tt=u(mt),ft=u(tt);dt(ft,{title:"unit count",row:!0,min:Ct,get value(){return t().unit_count},set value(o){t().unit_count=o},children:(o,T)=>{X();var M=K("unit count");U(o,M)},$$slots:{default:!0}});var et=v(ft,2);_t(et),P(et,"max",It),p(tt);var xt=v(tt,2),yt=u(xt);dt(yt,{title:"unit scale",row:!0,step:ht,min:vt,get value(){return t().unit_scale},set value(o){t().unit_scale=o},children:(o,T)=>{X();var M=K("unit scale");U(o,M)},$$slots:{default:!0}});var J=v(yt,2);_t(J),P(J,"step",ht),P(J,"min",vt),P(J,"max",Rt),p(xt),p(mt),p(l);var nt=v(l,2);const Jt=Z(()=>i.units.length??""),Tt=Z(()=>i.units.filter(o=>o.type==="circle").length??""),Ut=Z(()=>i.units.filter(o=>o.type==="polygon").length??"");var Bt=u(nt);Et(()=>B(Bt,`${w(Jt)} shapes - ${w(Tt)} circles,
			${w(Ut)} polygons`)),p(nt);var st=v(nt,2),gt=u(st);fe(gt,{get Component(){return r.Component},scene:i,renderer:r});var kt=v(gt,2);{var zt=o=>{ye(o,{scene:i,get unit_selection(){return _.unit_selection},get width(){return r.width},get height(){return r.height},get scene_interaction_surface_state(){return _.scene_interaction_surface_state},set scene_interaction_surface_state(T){_.scene_interaction_surface_state=T}})};ee(kt,o=>{_.editing&&o(zt)})}p(st);var it=v(st,2),Ft=u(it);xe(Ft,{}),p(it);var wt=v(it,2),rt=u(wt),Ht=u(rt);p(rt);var ot=v(rt,2),Lt=u(ot);p(ot);var at=v(ot,2),Wt=u(at);p(at);var $t=v(at,2),qt=u($t);p($t),p(wt),p(s),Et(()=>{B(Ht,`pointer_x: ${_.scene_interaction_surface_state.pointer_x??""}px`),B(Lt,`pointer_y: ${_.scene_interaction_surface_state.pointer_y??""}px`),B(Wt,`pointer_down: ${_.scene_interaction_surface_state.pointer_down??""}`),B(qt,`pointing: ${_.scene_interaction_surface_state.pointing??""}`)}),ct(A,()=>m.speed,o=>m.speed=o),ct(et,()=>t().unit_count,o=>t().unit_count=o),ct(J,()=>t().unit_scale,o=>t().unit_scale=o),U(g,s)},$$slots:{default:!0}}),Dt()}function Fe(n,e){Mt(e,!0);const t=new Pt(Ee(location.hash));let r=t.toJSON();Vt(d=>{const{json:m}=t;d!==1&&m!==r&&(r=m,console.log("[spawn page] writing to hash"),history.replaceState(null,"","#"+De(m)))}),Xt(d=>{Qt.title="Dealt: spawn demo"}),Pe(n,{spawn_demo:t}),Dt()}export{Fe as component};
