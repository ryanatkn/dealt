var pe=Object.defineProperty;var Nt=h=>{throw TypeError(h)};var be=(h,t,e)=>t in h?pe(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var a=(h,t,e)=>be(h,typeof t!="symbol"?t+"":t,e),Wt=(h,t,e)=>t.has(h)||Nt("Cannot "+e);var g=(h,t,e)=>(Wt(h,t,"read from private field"),e?e.call(h):t.get(h)),P=(h,t,e)=>t.has(h)?Nt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(h):t.set(h,e);var Xt=(h,t,e)=>(Wt(h,t,"access private method"),e);import{t as Z,a as S,b as St,c as Q}from"./BPmIRx6_.js";import{p as at,c as J,r as z,s as ot,t as it,w as i,x as D,a as rt,f as N,n as qt,u as Ht,ah as A,aK as T,_ as x,I as ne,$ as xe}from"./DaTzegC-.js";import{p as H,i as U,s as se}from"./BkMa5g5G.js";import{s as F}from"./DKcoP1oN.js";import{s as Gt,d as ye,p as we,k as Pt}from"./DS-o1SaK.js";import{s as Vt,d as Tt,b as ke,g as je}from"./BhfeDiRc.js";import{K as _e,L as Ce,M as Ae,N as R,O as Ee,Q as Y,V as It,W as zt,X as Ft,b as Jt,Y as Me,Z as Se,_ as Ge,f as Pe,$ as Be,C as Ke,a0 as Le,a1 as Re,y as De,a2 as He,e as ie,a3 as Qt}from"./DJD2jCL7.js";import{b as Te}from"./YQqkFPxZ.js";import{c as Ie}from"./DLOaw0Wj.js";var Oe=(h,t)=>t.close(),Ue=Z('<li role="none" class="svelte-xrqtyv"><a class="menu_item plain svelte-xrqtyv" role="menuitem"><div class="content"><div class="icon"><!></div> <div class="title"><span class="text svelte-xrqtyv"><!></span></div></div></a></li>');function Ye(h,t){at(t,!0);const e="ðŸ”—",r=H(t,"icon",3,e),n=_e.get(),o=(k,C=location.host)=>{const K=Tt(Tt(k,"https://"),"http://");return K.startsWith(C+"/")?Tt(K,C):K},s=D(()=>o(t.href)),_=D(()=>!(i(s)[0]==="."||i(s)[0]==="/"&&i(s)[1]!=="/")),d=D(()=>i(_)?"noreferrer":void 0);var v=Ue(),m=J(v);m.__click=[Oe,n];var w=J(m),u=J(w),E=J(u);{var p=k=>{var C=St();it(()=>Gt(C,r())),S(k,C)},L=k=>{var C=Q(),K=N(C);F(K,r,()=>e),S(k,C)};U(E,k=>{typeof r()=="string"?k(p):k(L,!1)})}z(u);var B=ot(u,2),G=J(B),I=J(G);{var M=k=>{var C=Q(),K=N(C);F(K,()=>t.children),S(k,C)},O=k=>{var C=St();it(()=>Gt(C,i(s))),S(k,C)};U(I,k=>{t.children?k(M):k(O,!1)})}z(G),z(B),z(w),z(m),z(v),it(()=>{Vt(m,"href",t.href),Vt(m,"rel",i(d))}),S(h,v),rt()}ye(["click"]);function Ne(h,t){Ce(h,{get run(){return t.run},icon:r=>{qt();var n=St();it(()=>Gt(n,t.icon)),S(r,n)},children:(r,n)=>{qt();var o=St();it(()=>Gt(o,t.content)),S(r,o)},$$slots:{icon:!0,default:!0}})}const We=(h,t=ne)=>{Ye(h,se(t))},Xe=(h,t=ne)=>{Ne(h,se(t))};var qe=Z('<div class="contextmenu_root svelte-1oafc8t" role="region"><!></div>'),Ve=Z('<div class="contextmenu_layout svelte-1oafc8t" aria-hidden="true"></div>'),ze=Z('<ul class="contextmenu unstyled pane svelte-1oafc8t" role="menu" aria-label="context menu" tabindex="-1"></ul>'),Fe=Z("<!> <!> <!>",1);function Je(h,t){at(t,!0);const e=H(t,"contextmenu",19,()=>new Ee),r=H(t,"longpress_move_tolerance",3,21),n=H(t,"longpress_duration",3,633),o=H(t,"bypass_with_tap_then_longpress",3,!0),s=H(t,"tap_then_longpress_duration",3,660),_=H(t,"tap_then_longpress_move_tolerance",3,7),d=H(t,"open_offset_x",19,()=>-2),v=H(t,"open_offset_y",19,()=>-2),m=H(t,"scoped",3,!1);_e.set(e());let w=A(void 0);const u=D(()=>e().layout),E=D(()=>e().initial_layout),p=D(()=>i(u)===i(E));let L=A(void 0),B=A(void 0);Ht(()=>{!i(p)&&i(L)!==void 0&&(i(u).width=i(L))}),Ht(()=>{!i(p)&&i(B)!==void 0&&(i(u).height=i(B))});const G=Ae.set();Ht(()=>{if(i(w)){const l=i(w).getBoundingClientRect();G.width=l.width,G.height=l.height}});const I=D(()=>e().x+Math.min(0,i(u).width-(e().x+G.width))),M=D(()=>e().y+Math.min(0,i(u).height-(e().y+G.height)));let O=A(void 0),k=A(void 0),C=A(void 0),K=A(void 0),W=A(void 0),X=A(void 0);const q=()=>{i(W)&&x(W,!1),i(K)!=null&&(clearTimeout(i(K)),x(K,null))},$=l=>{var b;if(i(X)){x(X,!1);return}if(i(W)){q(),Y(l);return}const{target:c}=l;l.shiftKey||!(c instanceof HTMLElement||c instanceof SVGElement)||(b=i(w))!=null&&b.contains(c)||It(c)||zt(c)||Ft(c,l.clientX+d(),l.clientY+v(),e())&&(Y(l),q())},tt=l=>{i(W)&&x(W,!1);const{touches:c,target:b}=l;if(e().opened||c.length!==1||l.shiftKey||!(b instanceof HTMLElement||b instanceof SVGElement)||It(b)||zt(b))return;const{clientX:j,clientY:y}=c[0];if(o()){if(i(C)!=null&&performance.now()-i(C)<s()&&Math.hypot(j-i(O),y-i(k))<_()){x(X,!0),x(C,null);return}x(C,performance.now(),!0)}x(O,j,!0),x(k,y,!0),i(K)!=null&&q(),x(K,setTimeout(()=>{x(W,!0),Ft(b,i(O)+d(),i(k)+v(),e())},n()),!0)},et=l=>{if(i(K)==null)return;const{touches:c}=l;if(c.length!==1)return;const{clientX:b,clientY:j}=c[0];Math.hypot(b-i(O),j-i(k))>r()&&(e().opened&&e().close(),q())},V=l=>{i(K)!=null&&(i(W)&&Y(l),q())},lt=l=>{i(w)&&!i(w).contains(l.target)&&e().close()},ct=new Map([["Escape",()=>e().close()],["ArrowLeft",()=>e().collapse_selected()],["ArrowRight",()=>e().expand_selected()],["ArrowDown",()=>e().select_next()],["PageDown",()=>e().select_next()],["ArrowUp",()=>e().select_previous()],["PageUp",()=>e().select_previous()],["Home",()=>e().select_first()],["End",()=>e().select_last()],[" ",()=>e().activate_selected()],["Enter",()=>e().activate_selected()]]),ht=l=>{const c=ct.get(l.key);!c||It(l.target)||(Y(l),c())},f=(l,c)=>{let b=null;const j=y=>{b&&(b(),b=null),y.disabled||(b=we(l,y.event,y.cb,{capture:!0,passive:y.passive}))};return j(c),{update:y=>{j(y)},destroy:()=>{b==null||b()}}};var Lt=Fe();R(T,(l,c)=>f==null?void 0:f(l,c),()=>({event:"contextmenu",passive:!1,cb:$,disabled:m()})),R(T,(l,c)=>f==null?void 0:f(l,c),()=>({event:"touchstart",passive:!0,cb:tt,disabled:m()})),R(T,(l,c)=>f==null?void 0:f(l,c),()=>({event:"touchmove",passive:!0,cb:et,disabled:m()})),R(T,(l,c)=>f==null?void 0:f(l,c),()=>({event:"touchend",passive:!1,cb:V,disabled:m()})),R(T,(l,c)=>f==null?void 0:f(l,c),()=>({event:"touchcancel",passive:!1,cb:V,disabled:m()})),R(T,(l,c)=>f==null?void 0:f(l,c),()=>({event:"mousedown",passive:!0,cb:lt,disabled:!e().opened})),R(T,(l,c)=>f==null?void 0:f(l,c),()=>({event:"keydown",passive:!1,cb:ht,disabled:!e().opened}));var Et=N(Lt);{var ae=l=>{var c=qe(),b=J(c);F(b,()=>t.children),z(c),R(c,(j,y)=>f==null?void 0:f(j,y),()=>({event:"contextmenu",passive:!1,cb:$})),R(c,(j,y)=>f==null?void 0:f(j,y),()=>({event:"touchstart",passive:!0,cb:tt})),R(c,(j,y)=>f==null?void 0:f(j,y),()=>({event:"touchmove",passive:!0,cb:et})),R(c,(j,y)=>f==null?void 0:f(j,y),()=>({event:"touchend",passive:!1,cb:V})),R(c,(j,y)=>f==null?void 0:f(j,y),()=>({event:"touchcancel",passive:!1,cb:V})),S(l,c)},re=l=>{var c=Q(),b=N(c);F(b,()=>t.children),S(l,c)};U(Et,l=>{m()?l(ae):l(re,!1)})}var Ut=ot(Et,2);{var le=l=>{var c=Ve();Jt(c,"clientHeight",b=>x(B,b)),Jt(c,"clientWidth",b=>x(L,b)),S(l,c)};U(Ut,l=>{i(p)||l(le)})}var ce=ot(Ut,2);{var he=l=>{var c=ze();let b;ke(c,20,()=>e().params,j=>j,(j,y)=>{var Yt=Q(),ue=N(Yt);{var me=nt=>{var Mt=Q(),Rt=N(Mt);F(Rt,()=>y),S(nt,Mt)},fe=(nt,Mt)=>{{var Rt=st=>{We(st,()=>y.props)},de=(st,ve)=>{{var ge=Dt=>{Xe(Dt,()=>y.props)};U(st,Dt=>{y.snippet==="text"&&Dt(ge)},ve)}};U(nt,st=>{y.snippet==="link"?st(Rt):st(de,!1)},Mt)}};U(ue,nt=>{typeof y=="function"?nt(me):nt(fe,!1)})}S(j,Yt)}),z(c),Te(c,j=>x(w,j),()=>i(w)),it(()=>b=je(c,"",b,{transform:`translate3d(${i(I)??""}px, ${i(M)??""}px, 0)`})),S(l,c)};U(ce,l=>{e().opened&&l(he)})}S(h,Lt),rt()}const _t=class _t{constructor(){a(this,"_bvh_branch",!0);a(this,"_bvh_parent",null);a(this,"_bvh_left",null);a(this,"_bvh_right",null);a(this,"_bvh_sort",0);a(this,"_bvh_min_x",0);a(this,"_bvh_min_y",0);a(this,"_bvh_max_x",0);a(this,"_bvh_max_y",0)}static get_branch(t=_t.branch_pool){return t.pop()??new _t}static release_branch(t,e=_t.branch_pool){e.push(t)}};a(_t,"branch_pool",[]);let Bt=_t;class Qe{constructor(){a(this,"_hierarchy",null);a(this,"_bodies",[]);a(this,"_dirty_branches",[])}insert(t,e=!1){if(!e){const p=t._bvh;if(p&&p!==this)throw new Error("Body belongs to another collision system");t._bvh=this,this._bodies.push(t)}const r=t.is_polygon,n=t.x,o=t.y;r&&(t._dirty_coords||t.x!==t._x||t.y!==t._y||t.rotation!==t._rotation||t.scale_x!==t._scale_x||t.scale_y!==t._scale_y)&&t._calculate_coords();const s=t._bvh_padding,_=r?0:t.radius*t.scale,d=(r?t._min_x:n-_)-s,v=(r?t._min_y:o-_)-s,m=(r?t._max_x:n+_)+s,w=(r?t._max_y:o+_)+s;t._bvh_min_x=d,t._bvh_min_y=v,t._bvh_max_x=m,t._bvh_max_y=w;let u=this._hierarchy,E=0;if(!u)this._hierarchy=t;else for(;;)if(u._bvh_branch){const p=u._bvh_left,L=p._bvh_min_y,B=p._bvh_max_x,G=p._bvh_max_y,I=d<p._bvh_min_x?d:p._bvh_min_x,M=v<L?v:L,O=m>B?m:B,k=w>G?w:G,C=(B-p._bvh_min_x)*(G-L),W=(O-I)*(k-M)-C,X=u._bvh_right,q=X._bvh_min_x,$=X._bvh_min_y,tt=X._bvh_max_x,et=X._bvh_max_y,V=d<q?d:q,lt=v<$?v:$,ct=m>tt?m:tt,ht=w>et?w:et,f=(tt-q)*(et-$),Et=(ct-V)*(ht-lt)-f;u._bvh_sort=E++,u._bvh_min_x=I<V?I:V,u._bvh_min_y=M<lt?M:lt,u._bvh_max_x=O>ct?O:ct,u._bvh_max_y=k>ht?k:ht,u=W<=Et?p:X}else{const p=u._bvh_parent,L=u._bvh_min_x,B=u._bvh_min_y,G=u._bvh_max_x,I=u._bvh_max_y,M=u._bvh_parent=t._bvh_parent=Bt.get_branch();M._bvh_parent=p,M._bvh_left=u,M._bvh_right=t,M._bvh_sort=E++,M._bvh_min_x=d<L?d:L,M._bvh_min_y=v<B?v:B,M._bvh_max_x=m>G?m:G,M._bvh_max_y=w>I?w:I,p?p._bvh_left===u?p._bvh_left=M:p._bvh_right=M:this._hierarchy=M;break}}remove(t,e=!1){if(!e){const _=t._bvh;if(_&&_!==this)throw new Error("Body belongs to another collision system");t._bvh=null,this._bodies.splice(this._bodies.indexOf(t),1)}if(this._hierarchy===t){this._hierarchy=null;return}const r=t._bvh_parent,n=r._bvh_parent,o=r._bvh_left,s=o===t?r._bvh_right:o;if(s._bvh_parent=n,s._bvh_branch&&(s._bvh_sort=r._bvh_sort),n){n._bvh_left===r?n._bvh_left=s:n._bvh_right=s;let _=n;for(;_;){const d=_._bvh_left,v=d._bvh_min_x,m=d._bvh_min_y,w=d._bvh_max_x,u=d._bvh_max_y,E=_._bvh_right,p=E._bvh_min_x,L=E._bvh_min_y,B=E._bvh_max_x,G=E._bvh_max_y;_._bvh_min_x=v<p?v:p,_._bvh_min_y=m<L?m:L,_._bvh_max_x=w>B?w:B,_._bvh_max_y=u>G?u:G,_=_._bvh_parent}}else this._hierarchy=s;Bt.release_branch(r)}update(){const t=this._bodies,e=t.length;for(let r=0;r<e;++r){const n=t[r];let o=!1;if(n.padding!==n._bvh_padding&&(n._bvh_padding=n.padding,o=!0),!o){const s=n.is_polygon;s&&(n._dirty_coords||n.x!==n._x||n.y!==n._y||n.rotation!==n._rotation||n.scale_x!==n._scale_x||n.scale_y!==n._scale_y)&&n._calculate_coords();const _=n.x,d=n.y,v=s?0:n.radius*n.scale,m=s?n._min_x:_-v,w=s?n._min_y:d-v,u=s?n._max_x:_+v,E=s?n._max_y:d+v;o=m<n._bvh_min_x||w<n._bvh_min_y||u>n._bvh_max_x||E>n._bvh_max_y}o&&(this.remove(n,!0),this.insert(n,!0))}}potentials(t){const e=[],r=t._bvh_min_x,n=t._bvh_min_y,o=t._bvh_max_x,s=t._bvh_max_y;let _=this._hierarchy,d=!0;if(!(_!=null&&_._bvh_branch))return e;for(;_;){if(d){d=!1;let m=_._bvh_branch?_._bvh_left:null;for(;m&&m._bvh_max_x>=r&&m._bvh_max_y>=n&&m._bvh_min_x<=o&&m._bvh_min_y<=s;)_=m,m=_._bvh_branch?_._bvh_left:null}const v=_._bvh_branch?_._bvh_right:null;if(v&&v._bvh_max_x>r&&v._bvh_max_y>n&&v._bvh_min_x<o&&v._bvh_min_y<s)_=v,d=!0;else{!_._bvh_branch&&_!==t&&e.push(_);let m=_._bvh_parent;if(m){for(;m&&m._bvh_right===_;)_=m,m=_._bvh_parent;_=m}else break}}return e}}class Ze extends Me{constructor(e=0,r=0,n=0,o=1,s=0){super(e,r,s);a(this,"is_polygon",!1);a(this,"is_circle",!0);a(this,"is_point",!1);a(this,"radius");a(this,"scale");this.radius=n,this.scale=o}}class $e{constructor(){a(this,"_bvh",new Qe)}create_circle(t=0,e=0,r=0,n=1,o=0){const s=new Ze(t,e,r,n,o);return this._bvh.insert(s),s}create_polygon(t=0,e=0,r=[{x:0,y:0}],n=0,o=1,s=1,_=0){const d=new Se(t,e,r,n,o,s,_);return this._bvh.insert(d),d}create_point(t=0,e=0,r=0){const n=new Ge(t,e,r);return this._bvh.insert(n),n}insert(...t){for(const e of t)this._bvh.insert(e,!1);return this}remove(...t){for(const e of t)this._bvh.remove(e,!1);return this}update(){return this._bvh.update(),this}potentials(t){return this._bvh.potentials(t)}}class tn{constructor(){a(this,"collision",!1);a(this,"a",null);a(this,"b",null);a(this,"a_in_b",!1);a(this,"b_in_a",!1);a(this,"overlap",0);a(this,"overlap_x",0);a(this,"overlap_y",0)}}const Zt=new tn;var ut;class en{constructor(t){a(this,"collisions");P(this,ut,A(1));this.collisions=t}get speed(){return i(g(this,ut))}set speed(t){x(g(this,ut),t,!0)}update(t,e,r){this.collisions.update();const n=e*this.speed;var o;for(const s of t){s.dead||(o=s.speed*n,o!==0&&(s.direction_x!==0&&(s.x+=s.direction_x*o),s.direction_y!==0&&(s.y+=s.direction_y*o))),s.teleporting_x!==0&&(s.x+=s.teleporting_x),s.teleporting_y!==0&&(s.y+=s.teleporting_y);for(const _ of s.body.potentials())Pe(s.body,_,Zt)&&(_.unit.behaviors.has("Harmful_Behavior")&&s.behaviors.has("Player_Controller_Behavior")?s.kill():_.unit.behaviors.has("Player_Controller_Behavior")&&s.behaviors.has("Harmful_Behavior")?_.unit.kill():_.unit.behaviors.has("Goal_Behavior")&&s.behaviors.has("Player_Controller_Behavior")?s.scene.exit():_.unit.behaviors.has("Player_Controller_Behavior")&&s.behaviors.has("Goal_Behavior")?_.unit.scene.exit():r(s,_.unit,Zt))}}}ut=new WeakMap;var mt,ft,dt,vt,gt,pt,bt,xt,yt,wt,kt,jt,Kt,oe;class nn{constructor(){P(this,Kt);P(this,mt,A(!1));P(this,ft,A(!1));P(this,dt,A(!1));P(this,vt,A(!1));a(this,"teleporting_x",null);a(this,"teleporting_y",null);P(this,gt,A(0));P(this,pt,A(0));a(this,"just_pressed_button_a",!1);a(this,"just_pressed_button_b",!1);a(this,"just_pressed_button_x",!1);a(this,"just_pressed_button_y",!1);a(this,"pressing_button_a",!1);a(this,"pressing_button_b",!1);a(this,"pressing_button_x",!1);a(this,"pressing_button_y",!1);P(this,bt,D(()=>this.gamepad_moving_x||(this.moving_left?-1:0)+(this.moving_right?1:0)));P(this,xt,D(()=>this.gamepad_moving_y||(this.moving_up?-1:0)+(this.moving_down?1:0)));P(this,yt,A(!1));P(this,wt,A(!1));P(this,kt,A(!1));a(this,"pointer_down",!1);P(this,jt,D(()=>this.pointer_down||this.moving_x!==0||this.moving_y!==0));a(this,"pointer_screen_x",null);a(this,"pointer_screen_y",null);a(this,"connected_gamepads",new Be);a(this,"gamepad_axis_sensitivity",.04);a(this,"teleport_distance_md",12);a(this,"teleport_distance_lg",this.teleport_distance_md*4);a(this,"teleport_distance_xl",this.teleport_distance_lg*4)}get moving_left(){return i(g(this,mt))}set moving_left(t){x(g(this,mt),t,!0)}get moving_right(){return i(g(this,ft))}set moving_right(t){x(g(this,ft),t,!0)}get moving_up(){return i(g(this,dt))}set moving_up(t){x(g(this,dt),t,!0)}get moving_down(){return i(g(this,vt))}set moving_down(t){x(g(this,vt),t,!0)}get gamepad_moving_x(){return i(g(this,gt))}set gamepad_moving_x(t){x(g(this,gt),t,!0)}get gamepad_moving_y(){return i(g(this,pt))}set gamepad_moving_y(t){x(g(this,pt),t,!0)}get moving_x(){return i(g(this,bt))}set moving_x(t){x(g(this,bt),t)}get moving_y(){return i(g(this,xt))}set moving_y(t){x(g(this,xt),t)}get pressing_shift(){return i(g(this,yt))}set pressing_shift(t){x(g(this,yt),t,!0)}get pressing_ctrl(){return i(g(this,wt))}set pressing_ctrl(t){x(g(this,wt),t,!0)}get pressing_alt(){return i(g(this,kt))}set pressing_alt(t){x(g(this,kt),t,!0)}set_pointer_down(t){this.pointer_down=t}get moving(){return i(g(this,jt))}set moving(t){x(g(this,jt),t)}set_pointer_location(t,e){this.pointer_screen_x=t,this.pointer_screen_y=e}update(t){Xt(this,Kt,oe).call(this);const e=this.just_pressed_button_a&&this.pressing_button_x||this.just_pressed_button_x&&this.pressing_button_a?this.teleport_distance_xl:this.just_pressed_button_x?this.teleport_distance_lg:this.just_pressed_button_a?this.teleport_distance_md:0;this.teleporting_x=e===0||this.moving_x===0?null:this.moving_x*e,this.teleporting_y=e===0||this.moving_y===0?null:this.moving_y*e}handle_keydown(t){switch(t){case"Shift":return this.pressing_shift=!0,!0;case"Control":return this.pressing_ctrl=!0,!0;case"Alt":return this.pressing_alt=!0,!0;case"ArrowLeft":case"a":return this.moving_left=!0,!0;case"ArrowRight":case"d":return this.moving_right=!0,!0;case"ArrowUp":case"w":return this.moving_up=!0,!0;case"ArrowDown":case"s":return this.moving_down=!0,!0;default:return!1}}handle_keyup(t){switch(t){case"Shift":return this.pressing_shift=!1,!0;case"Control":return this.pressing_ctrl=!1,!0;case"Alt":return this.pressing_alt=!1,!0;case"ArrowLeft":case"a":return this.moving_left=!1,!0;case"ArrowRight":case"d":return this.moving_right=!1,!0;case"ArrowUp":case"w":return this.moving_up=!1,!0;case"ArrowDown":case"s":return this.moving_down=!1,!0;default:return!1}}handle_gamepad_connected(t){console.log("[controller] handle_gamepad_connected gamepad",t),this.connected_gamepads.add(t.index)}handle_gamepad_disconnected(t){console.log("[controller] handle_gamepad_disconnected gamepad",t),this.connected_gamepads.delete(t.index)}reset(){this.moving_left=!1,this.moving_right=!1,this.moving_up=!1,this.moving_down=!1,this.teleporting_x=null,this.teleporting_y=null,this.pressing_shift=!1,this.pressing_ctrl=!1,this.pressing_alt=!1,this.just_pressed_button_a=!1,this.just_pressed_button_b=!1,this.just_pressed_button_x=!1,this.just_pressed_button_y=!1,this.pressing_button_a=!1,this.pressing_button_b=!1,this.pressing_button_x=!1,this.pressing_button_y=!1}}mt=new WeakMap,ft=new WeakMap,dt=new WeakMap,vt=new WeakMap,gt=new WeakMap,pt=new WeakMap,bt=new WeakMap,xt=new WeakMap,yt=new WeakMap,wt=new WeakMap,kt=new WeakMap,jt=new WeakMap,Kt=new WeakSet,oe=function(){if(!this.connected_gamepads.size)return;const t=navigator.getGamepads();for(const e of t){if(!e)continue;const[r,n]=e.axes;this.gamepad_moving_x=Math.abs(r)>this.gamepad_axis_sensitivity?r:0,this.gamepad_moving_y=Math.abs(n)>this.gamepad_axis_sensitivity?n:0;const[o,s,_,d]=e.buttons;this.just_pressed_button_a=o.pressed?!this.pressing_button_a:!1,this.just_pressed_button_b=s.pressed?!this.pressing_button_b:!1,this.just_pressed_button_x=_.pressed?!this.pressing_button_x:!1,this.just_pressed_button_y=d.pressed?!this.pressing_button_y:!1,this.pressing_button_a=o.pressed,this.pressing_button_b=s.pressed,this.pressing_button_x=_.pressed,this.pressing_button_y=d.pressed}};const sn=Ie(),_n={show_main_menu:()=>!1},$t=h=>(console.log("[parse_app_json]",h),{show_main_menu:typeof(h==null?void 0:h.show_main_menu)=="boolean"?h.show_main_menu:_n.show_main_menu()}),te="app";var Ct,At;const Ot=class Ot{constructor(t){a(this,"clock");a(this,"renderer");a(this,"simulation");a(this,"collisions");a(this,"controller");P(this,Ct,A(!1));P(this,At,D(()=>De(this)));a(this,"toggle_main_menu",()=>{this.show_main_menu?this.close_main_menu():this.open_main_menu()});a(this,"open_main_menu",()=>{this.show_main_menu=!0});a(this,"close_main_menu",()=>{this.show_main_menu=!1});console.log("[app] new with options",t);const{renderer:e,clock:r=new Ke,simulation:n=new en(new $e),controller:o=new nn,app_json:s=Ot.load()}=t;this.renderer=e,this.clock=r,this.collisions=n.collisions,this.simulation=n,this.controller=o,console.log("[app] app_json",s),this.set_json(s)}get show_main_menu(){return i(g(this,Ct))}set show_main_menu(t){x(g(this,Ct),t,!0)}get json(){return i(g(this,At))}set json(t){x(g(this,At),t)}toJSON(){return{show_main_menu:this.show_main_menu}}set_json(t){console.log("[app] set_json",t),this.show_main_menu=t.show_main_menu}save(t=this.json){console.log("[app] save"),Le(te,t)}static load(t=te){return console.log("[app] loading app"),Re(t,()=>$t(null),$t,!0)}};Ct=new WeakMap,At=new WeakMap;let ee=Ot;function on(h,t){at(t,!0);const e=H(t,"app",19,()=>sn.get()),r=D(()=>{let n=[{snippet:"text",props:{content:"Main menu",icon:"?",run:()=>{e().toggle_main_menu()}}},{snippet:"text",props:{content:"Reload",icon:"âŸ³",run:()=>{location.reload()}}}];return t.contextmenu_params_before&&(Array.isArray(t.contextmenu_params_before)?n=t.contextmenu_params_before.concat(n):n.unshift(t.contextmenu_params_before)),t.contextmenu_params_after&&(Array.isArray(t.contextmenu_params_after)?n=n.concat(t.contextmenu_params_after):n.push(t.contextmenu_params_after)),n});R(xe.body,(n,o)=>{var s;return(s=He)==null?void 0:s(n,o)},()=>i(r)),rt()}function an(h,t){at(t,!0);const e=ie.get(),r=o=>{if(!Qt(o.target))return;const{key:s,ctrlKey:_,altKey:d}=o;if(s===" "){e.clock.toggle(),Y(o);return}else if(s==="r"&&!_){e.project.scene.reset(),Y(o);return}else if(s==="`"&&!_&&!d){e.toggle_playing(),Y(o);return}else if(s==="~"&&!_&&!d){e.editing=!e.editing,Y(o);return}t.controller.handle_keydown(s)&&Y(o)},n=o=>{Qt(o.target)&&t.controller.handle_keyup(o.key)&&Y(o)};Pt("keydown",T,r),Pt("keyup",T,n),rt()}function rn(h,t){at(t,!0),Pt("gamepadconnected",T,e=>{t.controller.handle_gamepad_connected(e.gamepad)}),Pt("gamepaddisconnected",T,e=>{t.controller.handle_gamepad_disconnected(e.gamepad)}),rt()}var ln=Z("<!> <!>",1);function cn(h,t){at(t,!0);const e=H(t,"controller",19,()=>ie.get().controller);var r=ln(),n=N(r);an(n,{get controller(){return e()}});var o=ot(n,2);rn(o,{get controller(){return e()}}),S(h,r),rt()}var hn=Z("<!> <!> <!>",1);function wn(h,t){Je(h,{children:(e,r)=>{var n=hn(),o=N(n);{var s=u=>{var E=Q(),p=N(E);F(p,()=>t.global_controls),S(u,E)},_=u=>{cn(u,{})};U(o,u=>{t.global_controls?u(s):u(_,!1)})}var d=ot(o,2);{var v=u=>{var E=Q(),p=N(E);F(p,()=>t.app_contextmenu),S(u,E)},m=u=>{on(u,{})};U(d,u=>{t.app_contextmenu?u(v):u(m,!1)})}var w=ot(d,2);F(w,()=>t.children),S(e,n)},$$slots:{default:!0}})}export{ee as A,nn as C,wn as D,en as S,sn as a,$e as b,Zt as c,on as d};
