var xt=Object.defineProperty;var qe=h=>{throw TypeError(h)};var yt=(h,e,t)=>e in h?xt(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var a=(h,e,t)=>yt(h,typeof e!="symbol"?e+"":e,t),Ne=(h,e,t)=>e.has(h)||qe("Cannot "+t);var b=(h,e,t)=>(Ne(h,e,"read from private field"),t?t.call(h):e.get(h)),G=(h,e,t)=>e.has(h)?qe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(h):e.set(h,t);var Xe=(h,e,t)=>(Ne(h,e,"access private method"),t);import{a as C,t as $,b as Ce,c as V}from"./disclose-version.Ds06f9Vu.js";import{q as ee,c as Z,r as J,s as le,m as re,K as i,o as te,L as H,v as I,n as ze,u as Te,aI as O,W as y,a0 as E,D as st,$ as wt}from"./runtime.5k9ShzZt.js";import{p as T,i as Y,c as D,d as _t}from"./props.lofZ2jro.js";import{s as Q}from"./snippet.CcawutmI.js";import{s as Ee,d as kt,o as jt,k as Me}from"./render.CAjsxhF5.js";import{s as Ve,d as Ie,e as At,b as Ct}from"./string.25aLtQ0-.js";import{y as it,z as Et,A as Mt,B as R,F as St,b as Fe,I as q,J as Oe,K as Je,L as Qe,M as Bt,N as Gt,O as Lt,g as Pt,Q as Kt,C as Dt,V as Rt,W as Ht,X as Tt,Y as It,e as ot,Z as Ze}from"./renderer_components.BRuy53NI.js";import{b as Ot}from"./preload-helper.DV2ohNv5.js";import{c as Ut}from"./context_helpers.CfXypSow.js";var Wt=(h,e)=>e.close(),Yt=$('<li role="none" class="svelte-xrqtyv"><a class="menu_item plain svelte-xrqtyv" role="menuitem"><div class="content"><div class="icon"><!></div> <div class="title"><span class="text svelte-xrqtyv"><!></span></div></div></a></li>');function qt(h,e){ee(e,!0);const t="ðŸ”—",r=T(e,"icon",3,t),n=it.get(),o=(w,A=location.host)=>{const P=Ie(Ie(w,"https://"),"http://");return P.startsWith(A+"/")?Ie(P,A):P},s=H(()=>o(e.href)),_=H(()=>!(i(s)[0]==="."||i(s)[0]==="/"&&i(s)[1]!=="/")),d=H(()=>i(_)?"noreferrer":void 0);var v=Yt(),m=Z(v);m.__click=[Wt,n];var x=Z(m),u=Z(x),M=Z(u);{var p=w=>{var A=Ce();re(()=>Ee(A,r())),C(w,A)},K=w=>{var A=V(),P=I(A);Q(P,r,()=>t),C(w,A)};Y(M,w=>{typeof r()=="string"?w(p):w(K,!1)})}J(u);var L=le(u,2),B=Z(L),U=Z(B);{var S=w=>{var A=V(),P=I(A);Q(P,()=>e.children),C(w,A)},W=w=>{var A=Ce();re(()=>Ee(A,i(s))),C(w,A)};Y(U,w=>{e.children?w(S):w(W,!1)})}J(B),J(L),J(x),J(m),J(v),re(()=>{Ve(m,"href",e.href),Ve(m,"rel",i(d))}),C(h,v),te()}kt(["click"]);function Nt(h,e){Et(h,{get run(){return e.run},icon:r=>{ze();var n=Ce();re(()=>Ee(n,e.icon)),C(r,n)},children:(r,n)=>{ze();var o=Ce();re(()=>Ee(o,e.content)),C(r,o)},$$slots:{icon:!0,default:!0}})}const Xt=(h,e=st)=>{qt(h,_t(e))},zt=(h,e=st)=>{Nt(h,_t(e))};var Vt=$('<div class="contextmenu_root svelte-aif9y6" role="region"><!></div>'),Ft=$('<div class="contextmenu_layout svelte-aif9y6" aria-hidden="true"></div>'),Jt=$('<menu class="contextmenu unstyled pane svelte-aif9y6" role="dialog" tabindex="-1"></menu>'),Qt=$("<!> <!> <!>",1);function Zt(h,e){ee(e,!0);const t=T(e,"contextmenu",19,()=>new St),r=T(e,"longpress_move_tolerance",3,21),n=T(e,"longpress_duration",3,633),o=T(e,"bypass_with_tap_then_longpress",3,!0),s=T(e,"tap_then_longpress_duration",3,660),_=T(e,"tap_then_longpress_move_tolerance",3,7),d=T(e,"open_offset_x",19,()=>-2),v=T(e,"open_offset_y",19,()=>-2),m=T(e,"scoped",3,!1);it.set(t());let x=E(void 0);const u=H(()=>t().layout),M=H(()=>t().initial_layout),p=H(()=>i(u)===i(M));let K=E(void 0),L=E(void 0);Te(()=>{!i(p)&&i(K)!==void 0&&(i(u).width=i(K))}),Te(()=>{!i(p)&&i(L)!==void 0&&(i(u).height=i(L))});const B=Mt.set();Te(()=>{if(i(x)){const l=i(x).getBoundingClientRect();B.width=l.width,B.height=l.height}});const U=H(()=>t().x+Math.min(0,i(u).width-(t().x+B.width))),S=H(()=>t().y+Math.min(0,i(u).height-(t().y+B.height)));let W=E(void 0),w=E(void 0),A=E(void 0),P=E(void 0),N=E(void 0),X=E(void 0);const z=()=>{i(N)&&y(N,!1),i(P)!=null&&(clearTimeout(i(P)),y(P,null))},ne=l=>{var g;if(i(X)){y(X,!1);return}if(i(N)){z(),q(l);return}const{target:c}=l;l.shiftKey||!(c instanceof HTMLElement||c instanceof SVGElement)||(g=i(x))!=null&&g.contains(c)||Oe(c)||Je(c)||Qe(c,l.clientX+d(),l.clientY+v(),t())&&(q(l),z())},se=l=>{i(N)&&y(N,!1);const{touches:c,target:g}=l;if(t().opened||c.length!==1||l.shiftKey||!(g instanceof HTMLElement||g instanceof SVGElement)||Oe(g)||Je(g))return;const{clientX:k,clientY:j}=c[0];if(o()){if(i(A)!=null&&performance.now()-i(A)<s()&&Math.hypot(k-i(W),j-i(w))<_()){y(X,!0),y(A,null);return}y(A,D(performance.now()))}y(W,D(k)),y(w,D(j)),i(P)!=null&&z(),y(P,D(setTimeout(()=>{y(N,!0),Qe(g,i(W)+d(),i(w)+v(),t())},n())))},_e=l=>{if(i(P)==null)return;const{touches:c}=l;if(c.length!==1)return;const{clientX:g,clientY:k}=c[0];Math.hypot(g-i(W),k-i(w))>r()&&(t().opened&&t().close(),z())},F=l=>{i(P)!=null&&(i(N)&&q(l),z())},ce=l=>{i(x)&&!i(x).contains(l.target)&&t().close()},he=new Map([["Escape",()=>t().close()],["ArrowLeft",()=>t().collapse_selected()],["ArrowRight",()=>t().expand_selected()],["ArrowDown",()=>t().select_next()],["PageDown",()=>t().select_next()],["ArrowUp",()=>t().select_previous()],["PageUp",()=>t().select_previous()],["Home",()=>t().select_first()],["End",()=>t().select_last()],[" ",()=>t().activate_selected()],["Enter",()=>t().activate_selected()]]),ue=l=>{const c=he.get(l.key);!c||Oe(l.target)||(q(l),c())},f=(l,c)=>{let g=null;const k=j=>{g&&(g(),g=null),j.disabled||(g=jt(l,j.event,j.cb,{capture:!0,passive:j.passive}))};return k(c),{update:j=>{k(j)},destroy:()=>{g==null||g()}}};var De=Qt();R(O,(l,c)=>f==null?void 0:f(l,c),()=>({event:"contextmenu",passive:!1,cb:ne,disabled:m()})),R(O,(l,c)=>f==null?void 0:f(l,c),()=>({event:"touchstart",passive:!0,cb:se,disabled:m()})),R(O,(l,c)=>f==null?void 0:f(l,c),()=>({event:"touchmove",passive:!0,cb:_e,disabled:m()})),R(O,(l,c)=>f==null?void 0:f(l,c),()=>({event:"touchend",passive:!1,cb:F,disabled:m()})),R(O,(l,c)=>f==null?void 0:f(l,c),()=>({event:"touchcancel",passive:!1,cb:F,disabled:m()})),R(O,(l,c)=>f==null?void 0:f(l,c),()=>({event:"mousedown",passive:!0,cb:ce,disabled:!t().opened})),R(O,(l,c)=>f==null?void 0:f(l,c),()=>({event:"keydown",passive:!1,cb:ue,disabled:!t().opened}));var Ae=I(De);{var rt=l=>{var c=Vt(),g=Z(c);Q(g,()=>e.children),J(c),R(c,(k,j)=>f==null?void 0:f(k,j),()=>({event:"contextmenu",passive:!1,cb:ne})),R(c,(k,j)=>f==null?void 0:f(k,j),()=>({event:"touchstart",passive:!0,cb:se})),R(c,(k,j)=>f==null?void 0:f(k,j),()=>({event:"touchmove",passive:!0,cb:_e})),R(c,(k,j)=>f==null?void 0:f(k,j),()=>({event:"touchend",passive:!1,cb:F})),R(c,(k,j)=>f==null?void 0:f(k,j),()=>({event:"touchcancel",passive:!1,cb:F})),C(l,c)},lt=l=>{var c=V(),g=I(c);Q(g,()=>e.children),C(l,c)};Y(Ae,l=>{m()?l(rt):l(lt,!1)})}var We=le(Ae,2);{var ct=l=>{var c=Ft();Fe(c,"clientHeight",g=>y(L,g)),Fe(c,"clientWidth",g=>y(K,g)),C(l,c)};Y(We,l=>{i(p)||l(ct)})}var ht=le(We,2);{var ut=l=>{var c=Jt();At(c,20,()=>t().params,g=>g,(g,k)=>{var j=V(),mt=I(j);{var ft=ie=>{var me=V(),Re=I(me);Q(Re,()=>k),C(ie,me)},dt=ie=>{var me=V(),Re=I(me);{var gt=oe=>{Xt(oe,()=>k.props)},vt=oe=>{var Ye=V(),pt=I(Ye);{var bt=He=>{zt(He,()=>k.props)};Y(pt,He=>{k.snippet==="text"&&He(bt)},!0)}C(oe,Ye)};Y(Re,oe=>{k.snippet==="link"?oe(gt):oe(vt,!1)},!0)}C(ie,me)};Y(mt,ie=>{typeof k=="function"?ie(ft):ie(dt,!1)})}C(g,j)}),J(c),Ot(c,g=>y(x,g),()=>i(x)),re(()=>Ct(c,"transform",`translate3d(${i(U)??""}px, ${i(S)??""}px, 0)`)),C(l,c)};Y(ht,l=>{t().opened&&l(ut)})}C(h,De),te()}const ae=class ae{constructor(){a(this,"_bvh_branch",!0);a(this,"_bvh_parent",null);a(this,"_bvh_left",null);a(this,"_bvh_right",null);a(this,"_bvh_sort",0);a(this,"_bvh_min_x",0);a(this,"_bvh_min_y",0);a(this,"_bvh_max_x",0);a(this,"_bvh_max_y",0)}static get_branch(e=ae.branch_pool){return e.pop()??new ae}static release_branch(e,t=ae.branch_pool){t.push(e)}};a(ae,"branch_pool",[]);let Se=ae;class $t{constructor(){a(this,"_hierarchy",null);a(this,"_bodies",[]);a(this,"_dirty_branches",[])}insert(e,t=!1){if(!t){const p=e._bvh;if(p&&p!==this)throw new Error("Body belongs to another collision system");e._bvh=this,this._bodies.push(e)}const r=e.is_polygon,n=e.x,o=e.y;r&&(e._dirty_coords||e.x!==e._x||e.y!==e._y||e.rotation!==e._rotation||e.scale_x!==e._scale_x||e.scale_y!==e._scale_y)&&e._calculate_coords();const s=e._bvh_padding,_=r?0:e.radius*e.scale,d=(r?e._min_x:n-_)-s,v=(r?e._min_y:o-_)-s,m=(r?e._max_x:n+_)+s,x=(r?e._max_y:o+_)+s;e._bvh_min_x=d,e._bvh_min_y=v,e._bvh_max_x=m,e._bvh_max_y=x;let u=this._hierarchy,M=0;if(!u)this._hierarchy=e;else for(;;)if(u._bvh_branch){const p=u._bvh_left,K=p._bvh_min_y,L=p._bvh_max_x,B=p._bvh_max_y,U=d<p._bvh_min_x?d:p._bvh_min_x,S=v<K?v:K,W=m>L?m:L,w=x>B?x:B,A=(L-p._bvh_min_x)*(B-K),N=(W-U)*(w-S)-A,X=u._bvh_right,z=X._bvh_min_x,ne=X._bvh_min_y,se=X._bvh_max_x,_e=X._bvh_max_y,F=d<z?d:z,ce=v<ne?v:ne,he=m>se?m:se,ue=x>_e?x:_e,f=(se-z)*(_e-ne),Ae=(he-F)*(ue-ce)-f;u._bvh_sort=M++,u._bvh_min_x=U<F?U:F,u._bvh_min_y=S<ce?S:ce,u._bvh_max_x=W>he?W:he,u._bvh_max_y=w>ue?w:ue,u=N<=Ae?p:X}else{const p=u._bvh_parent,K=u._bvh_min_x,L=u._bvh_min_y,B=u._bvh_max_x,U=u._bvh_max_y,S=u._bvh_parent=e._bvh_parent=Se.get_branch();S._bvh_parent=p,S._bvh_left=u,S._bvh_right=e,S._bvh_sort=M++,S._bvh_min_x=d<K?d:K,S._bvh_min_y=v<L?v:L,S._bvh_max_x=m>B?m:B,S._bvh_max_y=x>U?x:U,p?p._bvh_left===u?p._bvh_left=S:p._bvh_right=S:this._hierarchy=S;break}}remove(e,t=!1){if(!t){const _=e._bvh;if(_&&_!==this)throw new Error("Body belongs to another collision system");e._bvh=null,this._bodies.splice(this._bodies.indexOf(e),1)}if(this._hierarchy===e){this._hierarchy=null;return}const r=e._bvh_parent,n=r._bvh_parent,o=r._bvh_left,s=o===e?r._bvh_right:o;if(s._bvh_parent=n,s._bvh_branch&&(s._bvh_sort=r._bvh_sort),n){n._bvh_left===r?n._bvh_left=s:n._bvh_right=s;let _=n;for(;_;){const d=_._bvh_left,v=d._bvh_min_x,m=d._bvh_min_y,x=d._bvh_max_x,u=d._bvh_max_y,M=_._bvh_right,p=M._bvh_min_x,K=M._bvh_min_y,L=M._bvh_max_x,B=M._bvh_max_y;_._bvh_min_x=v<p?v:p,_._bvh_min_y=m<K?m:K,_._bvh_max_x=x>L?x:L,_._bvh_max_y=u>B?u:B,_=_._bvh_parent}}else this._hierarchy=s;Se.release_branch(r)}update(){const e=this._bodies,t=e.length;for(let r=0;r<t;++r){const n=e[r];let o=!1;if(n.padding!==n._bvh_padding&&(n._bvh_padding=n.padding,o=!0),!o){const s=n.is_polygon;s&&(n._dirty_coords||n.x!==n._x||n.y!==n._y||n.rotation!==n._rotation||n.scale_x!==n._scale_x||n.scale_y!==n._scale_y)&&n._calculate_coords();const _=n.x,d=n.y,v=s?0:n.radius*n.scale,m=s?n._min_x:_-v,x=s?n._min_y:d-v,u=s?n._max_x:_+v,M=s?n._max_y:d+v;o=m<n._bvh_min_x||x<n._bvh_min_y||u>n._bvh_max_x||M>n._bvh_max_y}o&&(this.remove(n,!0),this.insert(n,!0))}}potentials(e){const t=[],r=e._bvh_min_x,n=e._bvh_min_y,o=e._bvh_max_x,s=e._bvh_max_y;let _=this._hierarchy,d=!0;if(!(_!=null&&_._bvh_branch))return t;for(;_;){if(d){d=!1;let m=_._bvh_branch?_._bvh_left:null;for(;m&&m._bvh_max_x>=r&&m._bvh_max_y>=n&&m._bvh_min_x<=o&&m._bvh_min_y<=s;)_=m,m=_._bvh_branch?_._bvh_left:null}const v=_._bvh_branch?_._bvh_right:null;if(v&&v._bvh_max_x>r&&v._bvh_max_y>n&&v._bvh_min_x<o&&v._bvh_min_y<s)_=v,d=!0;else{!_._bvh_branch&&_!==e&&t.push(_);let m=_._bvh_parent;if(m){for(;m&&m._bvh_right===_;)_=m,m=_._bvh_parent;_=m}else break}}return t}}class en extends Bt{constructor(t=0,r=0,n=0,o=1,s=0){super(t,r,s);a(this,"is_polygon",!1);a(this,"is_circle",!0);a(this,"is_point",!1);a(this,"radius");a(this,"scale");this.radius=n,this.scale=o}}class tn{constructor(){a(this,"_bvh",new $t)}create_circle(e=0,t=0,r=0,n=1,o=0){const s=new en(e,t,r,n,o);return this._bvh.insert(s),s}create_polygon(e=0,t=0,r=[{x:0,y:0}],n=0,o=1,s=1,_=0){const d=new Gt(e,t,r,n,o,s,_);return this._bvh.insert(d),d}create_point(e=0,t=0,r=0){const n=new Lt(e,t,r);return this._bvh.insert(n),n}insert(...e){for(const t of e)this._bvh.insert(t,!1);return this}remove(...e){for(const t of e)this._bvh.remove(t,!1);return this}update(){return this._bvh.update(),this}potentials(e){return this._bvh.potentials(e)}}class nn{constructor(){a(this,"collision",!1);a(this,"a",null);a(this,"b",null);a(this,"a_in_b",!1);a(this,"b_in_a",!1);a(this,"overlap",0);a(this,"overlap_x",0);a(this,"overlap_y",0)}}const $e=new nn;var fe;class sn{constructor(e){a(this,"collisions");G(this,fe,E(1));this.collisions=e}get speed(){return i(b(this,fe))}set speed(e){y(b(this,fe),D(e))}update(e,t,r){this.collisions.update();const n=t*this.speed;var o;for(const s of e){s.dead||(o=s.speed*n,o!==0&&(s.direction_x!==0&&(s.x+=s.direction_x*o),s.direction_y!==0&&(s.y+=s.direction_y*o))),s.teleporting_x!==0&&(s.x+=s.teleporting_x),s.teleporting_y!==0&&(s.y+=s.teleporting_y);for(const _ of s.body.potentials())Pt(s.body,_,$e)&&(_.unit.behaviors.has("Harmful_Behavior")&&s.behaviors.has("Player_Controller_Behavior")?s.kill():_.unit.behaviors.has("Player_Controller_Behavior")&&s.behaviors.has("Harmful_Behavior")?_.unit.kill():_.unit.behaviors.has("Goal_Behavior")&&s.behaviors.has("Player_Controller_Behavior")?s.scene.exit():_.unit.behaviors.has("Player_Controller_Behavior")&&s.behaviors.has("Goal_Behavior")?_.unit.scene.exit():r(s,_.unit,$e))}}}fe=new WeakMap;var de,ge,ve,pe,be,xe,Be,Ge,ye,we,ke,Le,Pe,at;class _n{constructor(){G(this,Pe);G(this,de,E(!1));G(this,ge,E(!1));G(this,ve,E(!1));G(this,pe,E(!1));a(this,"teleporting_x",null);a(this,"teleporting_y",null);G(this,be,E(0));G(this,xe,E(0));a(this,"just_pressed_button_a",!1);a(this,"just_pressed_button_b",!1);a(this,"just_pressed_button_x",!1);a(this,"just_pressed_button_y",!1);a(this,"pressing_button_a",!1);a(this,"pressing_button_b",!1);a(this,"pressing_button_x",!1);a(this,"pressing_button_y",!1);G(this,Be,H(()=>this.gamepad_moving_x||(this.moving_left?-1:0)+(this.moving_right?1:0)));G(this,Ge,H(()=>this.gamepad_moving_y||(this.moving_up?-1:0)+(this.moving_down?1:0)));G(this,ye,E(!1));G(this,we,E(!1));G(this,ke,E(!1));a(this,"pointer_down",!1);G(this,Le,H(()=>this.pointer_down||this.moving_x!==0||this.moving_y!==0));a(this,"pointer_screen_x",null);a(this,"pointer_screen_y",null);a(this,"connected_gamepads",new Kt);a(this,"gamepad_axis_sensitivity",.04);a(this,"teleport_distance_md",12);a(this,"teleport_distance_lg",this.teleport_distance_md*4);a(this,"teleport_distance_xl",this.teleport_distance_lg*4)}get moving_left(){return i(b(this,de))}set moving_left(e){y(b(this,de),D(e))}get moving_right(){return i(b(this,ge))}set moving_right(e){y(b(this,ge),D(e))}get moving_up(){return i(b(this,ve))}set moving_up(e){y(b(this,ve),D(e))}get moving_down(){return i(b(this,pe))}set moving_down(e){y(b(this,pe),D(e))}get gamepad_moving_x(){return i(b(this,be))}set gamepad_moving_x(e){y(b(this,be),D(e))}get gamepad_moving_y(){return i(b(this,xe))}set gamepad_moving_y(e){y(b(this,xe),D(e))}get moving_x(){return i(b(this,Be))}get moving_y(){return i(b(this,Ge))}get pressing_shift(){return i(b(this,ye))}set pressing_shift(e){y(b(this,ye),D(e))}get pressing_ctrl(){return i(b(this,we))}set pressing_ctrl(e){y(b(this,we),D(e))}get pressing_alt(){return i(b(this,ke))}set pressing_alt(e){y(b(this,ke),D(e))}set_pointer_down(e){this.pointer_down=e}get moving(){return i(b(this,Le))}set_pointer_location(e,t){this.pointer_screen_x=e,this.pointer_screen_y=t}update(e){Xe(this,Pe,at).call(this);const t=this.just_pressed_button_a&&this.pressing_button_x||this.just_pressed_button_x&&this.pressing_button_a?this.teleport_distance_xl:this.just_pressed_button_x?this.teleport_distance_lg:this.just_pressed_button_a?this.teleport_distance_md:0;this.teleporting_x=t===0||this.moving_x===0?null:this.moving_x*t,this.teleporting_y=t===0||this.moving_y===0?null:this.moving_y*t}handle_keydown(e){switch(e){case"Shift":return this.pressing_shift=!0,!0;case"Control":return this.pressing_ctrl=!0,!0;case"Alt":return this.pressing_alt=!0,!0;case"ArrowLeft":case"a":return this.moving_left=!0,!0;case"ArrowRight":case"d":return this.moving_right=!0,!0;case"ArrowUp":case"w":return this.moving_up=!0,!0;case"ArrowDown":case"s":return this.moving_down=!0,!0;default:return!1}}handle_keyup(e){switch(e){case"Shift":return this.pressing_shift=!1,!0;case"Control":return this.pressing_ctrl=!1,!0;case"Alt":return this.pressing_alt=!1,!0;case"ArrowLeft":case"a":return this.moving_left=!1,!0;case"ArrowRight":case"d":return this.moving_right=!1,!0;case"ArrowUp":case"w":return this.moving_up=!1,!0;case"ArrowDown":case"s":return this.moving_down=!1,!0;default:return!1}}handle_gamepad_connected(e){console.log("[controller] handle_gamepad_connected gamepad",e),this.connected_gamepads.add(e.index)}handle_gamepad_disconnected(e){console.log("[controller] handle_gamepad_disconnected gamepad",e),this.connected_gamepads.delete(e.index)}reset(){this.moving_left=!1,this.moving_right=!1,this.moving_up=!1,this.moving_down=!1,this.teleporting_x=null,this.teleporting_y=null,this.pressing_shift=!1,this.pressing_ctrl=!1,this.pressing_alt=!1,this.just_pressed_button_a=!1,this.just_pressed_button_b=!1,this.just_pressed_button_x=!1,this.just_pressed_button_y=!1,this.pressing_button_a=!1,this.pressing_button_b=!1,this.pressing_button_x=!1,this.pressing_button_y=!1}}de=new WeakMap,ge=new WeakMap,ve=new WeakMap,pe=new WeakMap,be=new WeakMap,xe=new WeakMap,Be=new WeakMap,Ge=new WeakMap,ye=new WeakMap,we=new WeakMap,ke=new WeakMap,Le=new WeakMap,Pe=new WeakSet,at=function(){if(!this.connected_gamepads.size)return;const e=navigator.getGamepads();for(const t of e){if(!t)continue;const[r,n]=t.axes;this.gamepad_moving_x=Math.abs(r)>this.gamepad_axis_sensitivity?r:0,this.gamepad_moving_y=Math.abs(n)>this.gamepad_axis_sensitivity?n:0;const[o,s,_,d]=t.buttons;this.just_pressed_button_a=o.pressed?!this.pressing_button_a:!1,this.just_pressed_button_b=s.pressed?!this.pressing_button_b:!1,this.just_pressed_button_x=_.pressed?!this.pressing_button_x:!1,this.just_pressed_button_y=d.pressed?!this.pressing_button_y:!1,this.pressing_button_a=o.pressed,this.pressing_button_b=s.pressed,this.pressing_button_x=_.pressed,this.pressing_button_y=d.pressed}};const on=Ut(),an={show_main_menu:()=>!1},et=h=>(console.log("[parse_app_json]",h),{show_main_menu:typeof(h==null?void 0:h.show_main_menu)=="boolean"?h.show_main_menu:an.show_main_menu()}),tt="app";var je,Ke;const Ue=class Ue{constructor(e){a(this,"clock");a(this,"renderer");a(this,"simulation");a(this,"collisions");a(this,"controller");G(this,je,E(!1));G(this,Ke,H(()=>Tt(this)));a(this,"toggle_main_menu",()=>{this.show_main_menu?this.close_main_menu():this.open_main_menu()});a(this,"open_main_menu",()=>{this.show_main_menu=!0});a(this,"close_main_menu",()=>{this.show_main_menu=!1});console.log("[app] new with options",e);const{renderer:t,clock:r=new Dt,simulation:n=new sn(new tn),controller:o=new _n,app_json:s=Ue.load()}=e;this.renderer=t,this.clock=r,this.collisions=n.collisions,this.simulation=n,this.controller=o,console.log("[app] app_json",s),this.set_json(s)}get show_main_menu(){return i(b(this,je))}set show_main_menu(e){y(b(this,je),D(e))}get json(){return i(b(this,Ke))}toJSON(){return{show_main_menu:this.show_main_menu}}set_json(e){console.log("[app] set_json",e),this.show_main_menu=e.show_main_menu}save(e=this.json){console.log("[app] save"),Rt(tt,e)}static load(e=tt){return console.log("[app] loading app"),Ht(e,()=>et(null),et,!0)}};je=new WeakMap,Ke=new WeakMap;let nt=Ue;function rn(h,e){ee(e,!0);const t=T(e,"app",19,()=>on.get()),r=H(()=>{let n=[{snippet:"text",props:{content:"Main menu",icon:"?",run:()=>{t().toggle_main_menu()}}},{snippet:"text",props:{content:"Reload",icon:"âŸ³",run:()=>{location.reload()}}}];return e.contextmenu_params_before&&(Array.isArray(e.contextmenu_params_before)?n=e.contextmenu_params_before.concat(n):n.unshift(e.contextmenu_params_before)),e.contextmenu_params_after&&(Array.isArray(e.contextmenu_params_after)?n=n.concat(e.contextmenu_params_after):n.push(e.contextmenu_params_after)),n});R(wt.body,(n,o)=>{var s;return(s=It)==null?void 0:s(n,o)},()=>i(r)),te()}function ln(h,e){ee(e,!0);const t=ot.get(),r=o=>{if(!Ze(o.target))return;const{key:s,ctrlKey:_,altKey:d}=o;if(s===" "){t.clock.toggle(),q(o);return}else if(s==="r"&&!_){t.project.scene.reset(),q(o);return}else if(s==="`"&&!_&&!d){t.toggle_playing(),q(o);return}else if(s==="~"&&!_&&!d){t.editing=!t.editing,q(o);return}e.controller.handle_keydown(s)&&q(o)},n=o=>{Ze(o.target)&&e.controller.handle_keyup(o.key)&&q(o)};Me("keydown",O,r),Me("keyup",O,n),te()}function cn(h,e){ee(e,!0),Me("gamepadconnected",O,t=>{e.controller.handle_gamepad_connected(t.gamepad)}),Me("gamepaddisconnected",O,t=>{e.controller.handle_gamepad_disconnected(t.gamepad)}),te()}var hn=$("<!> <!>",1);function un(h,e){ee(e,!0);const t=T(e,"controller",19,()=>ot.get().controller);var r=hn(),n=I(r);ln(n,{get controller(){return t()}});var o=le(n,2);cn(o,{get controller(){return t()}}),C(h,r),te()}var mn=$("<!> <!> <!>",1);function jn(h,e){ee(e,!0),Zt(h,{children:(t,r)=>{var n=mn(),o=I(n);{var s=u=>{var M=V(),p=I(M);Q(p,()=>e.global_controls),C(u,M)},_=u=>{un(u,{})};Y(o,u=>{e.global_controls?u(s):u(_,!1)})}var d=le(o,2);{var v=u=>{var M=V(),p=I(M);Q(p,()=>e.app_contextmenu),C(u,M)},m=u=>{rn(u,{})};Y(d,u=>{e.app_contextmenu?u(v):u(m,!1)})}var x=le(d,2);Q(x,()=>e.children),C(t,n)},$$slots:{default:!0}}),te()}export{nt as A,_n as C,jn as D,sn as S,on as a,tn as b,$e as c,rn as d};
