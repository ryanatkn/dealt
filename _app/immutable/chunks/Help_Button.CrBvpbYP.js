var Dt=Object.defineProperty;var St=o=>{throw TypeError(o)};var Rt=(o,t,n)=>t in o?Dt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n;var Mt=(o,t,n)=>Rt(o,typeof t!="symbol"?t+"":t,n),It=(o,t,n)=>t.has(o)||St("Cannot "+n);var J=(o,t,n)=>(It(o,t,"read from private field"),n?n.call(o):t.get(o)),dt=(o,t,n)=>t.has(o)?St("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(o):t.set(o,n),pt=(o,t,n,l)=>(It(o,t,"write to private field"),l?l.call(o,n):t.set(o,n),n);import{a as Y,t as V,n as et,c as at,b as rt}from"./disclose-version.Ds06f9Vu.js";import{aJ as Vt,K as e,k as Ft,j as Pt,a1 as Lt,a4 as Jt,v as L,m as T,o as O,q as Z,L as z,c as q,s as N,D as Et,r as W,n as lt,a0 as w,u as Ht,W as i,aI as B}from"./runtime.5k9ShzZt.js";import{d as ot,o as Kt,k as j,s as vt}from"./render.CAjsxhF5.js";import{i as D,p as Q,c as v}from"./props.lofZ2jro.js";import{s as ut}from"./snippet.CcawutmI.js";import{b as $,r as Xt,t as F,s as X,g as Ot,a as Zt,e as Ct}from"./string.25aLtQ0-.js";import{t as Gt,s as Qt}from"./index.DteDSzYE.js";import{ao as $t,e as zt,P as te,u as ee,ap as ne,Q as nt,aq as wt,ar as ie,as as le,at as oe,au as Ut,K as re,M as Yt,N as se,a2 as ae,L as mt,av as ue,c as ce,F as de}from"./renderer_components.D7vW3J2n.js";import{c as _e}from"./svelte-component.BgFhLqea.js";import{b as ve}from"./preload-helper.DV2ohNv5.js";function ge(o){let t=0,n=Jt(0),l;return()=>{Vt()&&(e(n),Ft(()=>(t===0&&(l=Pt(()=>o(()=>$t(n)))),t+=1,()=>{Lt().then(()=>{t-=1,t===0&&(l==null||l(),l=void 0)})})))}}var gt,ht;class jt{constructor(t,n){dt(this,gt);dt(this,ht);pt(this,gt,t),pt(this,ht,ge(n))}get current(){return J(this,ht).call(this),J(this,gt).call(this)}}gt=new WeakMap,ht=new WeakMap;var he=(o,t)=>e(t).reset(),fe=V('<fieldset><label class="row pt_xs"><input type="checkbox"> show bounding volume hierarchy</label></fieldset>'),ye=V('<div class="scene_controls svelte-1l7n56e"><button type="button" title="toggle the clock [Spacebar]"><div class="pr_sm">clock</div> <!></button> <button type="button" title="reset the scene [r]" class="plain">reset</button> <button type="button" class="plain deselectable">edit</button> <!></div> <!>',1);function Mn(o,t){Z(t,!0);const n=z(()=>t.project.renderer),l=z(()=>t.project.scene),h=z(()=>e(l).clock),s=zt.get();var r=ye(),g=L(r),c=q(g);c.__click=function(...x){var _;(_=e(h).toggle)==null||_.apply(this,x)},$(c,"min-width","105px");var d=N(q(c),2);te(d,{get running(){return e(h).running}}),W(c);var m=N(c,2);m.__click=[he,l];var b=N(m,2);b.__click=()=>s.editing=!s.editing;var y=N(b,2);ut(y,()=>t.children??Et),W(g);var I=N(g,2);{var k=x=>{var _=fe(),S=q(_),f=q(S);Xt(f),lt(),W(S),W(_),ee(f,()=>e(n).show_bvh,E=>e(n).show_bvh=E),Gt(3,_,()=>Qt),Y(x,_)};D(I,x=>{e(n).type==="canvas"&&x(k)})}T(()=>{F(c,"color_d",e(h).running),X(b,"title",`${(s.editing?"stop editing":"start editing")??""} [~ Shift+Backtick]`),F(b,"color_d",s.editing)}),Y(o,r),O()}ot(["click"]);const me=new jt(()=>window.innerWidth,o=>Kt(window,"resize",o)),we=new jt(()=>window.innerHeight,o=>Kt(window,"resize",o));var pe=et('<line class="svelte-4z6b3j"></line>'),xe=et('<svg class="scrubbing_indicator svelte-4z6b3j" aria-hidden="true"><!></svg>');function yt(o,t){Z(t,!0);const n=z(()=>t.container_width??me.current),l=z(()=>t.container_height??we.current);ne(o,{to:document.body,children:(h,s)=>{var r=xe(),g=q(r);{var c=d=>{var m=pe();T(()=>{X(m,"x1",t.x_start),X(m,"y1",t.y_start),X(m,"x2",t.x_last),X(m,"y2",t.y_last)}),Y(d,m)};D(g,d=>{t.x_start!==null&&t.y_start!==null&&t.x_last!==null&&t.y_last!==null&&d(c)})}W(r),T(()=>{X(r,"viewBox",`0 0 ${e(n)??""} ${e(l)??""}`),X(r,"width",e(n)),X(r,"height",e(l))}),Y(h,r)},$$slots:{default:!0}}),O()}const be=(o,t)=>{o.ctrlKey||t(o.clientX,o.clientY)};var ke=V('<div class="title svelte-1emv8hj"><!></div>'),Se=V('<label role="slider"><!> <input></label> <!>',1);function In(o,t){Z(t,!0);let n=Q(t,"value",15,0),l=Q(t,"type",3,"text"),h=Q(t,"inputmode",3,"numeric"),s=Q(t,"step",3,1),r=Q(t,"min",19,()=>1/0*-1),g=Q(t,"row",3,!1),c=w(v(n())),d=w(v(n().toString()));const m=K=>{var U;i(c,v(K)),n(Math.max(r(),K)),i(d,v(n().toString())),(U=t.oninput)==null||U.call(t,n())};Ht(()=>{n()!==Pt(()=>e(c))&&(i(c,v(n())),i(d,v(n().toString())))});const b=K=>{i(d,v(K));const U=parseFloat(K);Number.isNaN(U)||m(U)},y=K=>{m(e(c)+K)};let I=w(!1),k=w(null),x=w(null),_=w(null),S=w(null),f=w(null),E=w(null),M=w(null);const p=z(()=>e(E)===null||e(S)===null?null:e(E)-e(S)),P=z(()=>e(M)===null||e(f)===null?null:e(f)-e(M)),C=z(()=>e(p)===null||e(P)===null?null:(e(p)+e(P))*s()),H=(K,U)=>{e(I)||(i(I,!0),i(k,v(n())),i(x,v(K)),i(_,v(U)),i(S,v(K)),i(f,v(U)))},A=()=>{i(I,!1),i(k,null),i(x,null),i(_,null),i(S,null),i(f,null),i(E,null),i(M,null)},G=(K,U)=>{i(S,v(e(E))),i(f,v(e(M))),i(E,v(K)),i(M,v(U)),e(C)!==null&&y(e(C))},a=K=>{A()},u=K=>{A()},R=K=>{G(K.clientX,K.clientY)},_t=K=>{K.key==="Escape"&&(m(e(k)),A(),nt(K))};var ct=Se();j("pointerup",B,function(...K){var U;(U=e(I)?a:void 0)==null||U.apply(this,K)}),j("pointermove",B,function(...K){var U;(U=e(I)?R:void 0)==null||U.apply(this,K)}),j("pointerleave",B,function(...K){var U;(U=e(I)?u:void 0)==null||U.apply(this,K)}),j("keydown",B,function(...K){var U;(U=e(I)?_t:void 0)==null||U.apply(this,K)},!0);var it=L(ct);it.__pointerdown=[be,H];var xt=q(it);{var Tt=K=>{var U=ke(),Bt=q(U);ut(Bt,()=>t.children),W(U),Y(K,U)};D(xt,K=>{t.children&&K(Tt)})}var bt=N(xt,2);Xt(bt);var Nt=K=>b(K.currentTarget.value);let kt;W(it);var qt=N(it,2);{var Wt=K=>{yt(K,{get x_start(){return e(x)},get y_start(){return e(_)},get x_last(){return e(S)},get y_last(){return e(f)},container_width:innerWidth,container_height:innerHeight})};D(qt,K=>{e(I)&&K(Wt)})}T(()=>{Ot(it,`${t.classes??""} svelte-1emv8hj`),X(it,"aria-valuenow",e(C)),X(it,"title",t.title),F(it,"selected",e(I)),F(it,"row",g()),kt=Zt(bt,kt,{...t.attrs,class:t.input_classes,value:e(d),oninput:Nt,type:l(),inputmode:h(),step:s(),min:r(),max:t.max},"svelte-1emv8hj")}),Y(o,ct),O()}ot(["pointerdown"]);var Me=V('<div class="scene_renderer svelte-1hiky75"><!></div>');function Yn(o,t){Z(t,!0);var n=Me(),l=q(n);{var h=s=>{var r=at(),g=L(r);_e(g,()=>t.Component,(c,d)=>{d(c,{get scene(){return t.scene},get renderer(){return t.renderer}})}),Y(s,r)};D(l,s=>{s(h)})}W(n),T(()=>{$(n,"width",`${t.renderer.width??""}px`),$(n,"height",`${t.renderer.height??""}px`),$(n,"min-width",`${t.renderer.width??""}px`),$(n,"min-height",`${t.renderer.height??""}px`)}),Y(o,n),O()}const Ie=(o,t)=>{t(o.clientX,o.clientY),nt(o)};var Ye=et('<polygon role="none" class="unit_circle_radius_handles svelte-1i5of7p" fill="var(--color_selected)"></polygon><!>',1);function Pe(o,t){Z(t,!0);const n=Q(t,"unit",7),l=Q(t,"size",3,wt),h=.5;let s=w(!1),r=w(null),g=w(null),c=w(null),d=w(null),m=w(null),b=w(null),y=w(null);const I=z(()=>n().x),k=z(()=>n().y-Math.max(l(),n().radius*Math.abs(n().scale))),x=z(()=>l()/2),_=(a,u)=>{e(s)||(i(s,!0),i(r,v(n().radius)),i(g,v(a)),i(c,v(u)),i(d,v(a)),i(m,v(u)))},S=()=>{i(s,!1),i(r,null),i(g,null),i(c,null),i(d,null),i(m,null),i(b,null),i(y,null)},f=(a,u)=>{i(d,v(e(b))),i(m,v(e(y))),i(b,v(a)),i(y,v(u)),e(d)!==null&&e(m)!==null&&(n().radius=ie(e(r)+h*(e(b)-e(g)-(e(y)-e(c)))))},E=a=>{S()},M=a=>{S()},p=a=>{f(a.clientX,a.clientY)},P=a=>{a.key==="Escape"&&(n().radius=e(r),S(),nt(a))};var C=Ye();j("pointerup",B,function(...a){var u;(u=e(s)?E:void 0)==null||u.apply(this,a)}),j("pointermove",B,function(...a){var u;(u=e(s)?p:void 0)==null||u.apply(this,a)}),j("pointerleave",B,function(...a){var u;(u=e(s)?M:void 0)==null||u.apply(this,a)}),j("keydown",B,function(...a){var u;(u=e(s)?P:void 0)==null||u.apply(this,a)},!0);var H=L(C);H.__pointerdown=[Ie,_];var A=N(H);{var G=a=>{yt(a,{get x_start(){return e(g)},get y_start(){return e(c)},get x_last(){return e(d)},get y_last(){return e(m)}})};D(A,a=>{e(s)&&a(G)})}T(()=>{X(H,"points",`${e(I)-e(x)},${e(k)-e(x)} ${e(I)+e(x)},${e(k)-e(x)} ${e(I)??""},${e(k)+e(x)}`),F(H,"pressing",e(s))}),Y(o,C),O()}ot(["pointerdown"]);const Ee=(o,t)=>{t(o.clientX,o.clientY),nt(o)};var He=et('<circle role="none" class="unit_scale_handles svelte-rpawlp" fill="var(--color_selected)"></circle><!>',1);function At(o,t){Z(t,!0);const n=Q(t,"unit",7),l=Q(t,"size",3,wt),h=.01;let s=w(!1),r=w(null),g=w(null),c=w(null),d=w(null),m=w(null),b=w(null),y=w(null),I=w(null),k=w(null);const x=z(()=>n().scene.controller.pressing_alt?"move":"nesw-resize"),_=(a,u)=>{e(s)||(i(s,!0),i(r,v(n().scale)),i(g,v(n().x)),i(c,v(n().y)),i(d,v(a)),i(m,v(u)),i(b,v(a)),i(y,v(u)))},S=()=>{i(s,!1),i(r,null),i(g,null),i(c,null),i(d,null),i(m,null),i(b,null),i(y,null),i(I,null),i(k,null)},f=(a,u)=>{i(b,v(e(I))),i(y,v(e(k))),i(I,v(a)),i(k,v(u)),e(b)!==null&&e(y)!==null&&(n().scene.controller.pressing_alt?n().move_center_to(n().x+(e(I)-e(b)),n().y+(e(k)-e(y))):n().scale=le(e(r)+h*(e(I)-e(d)-(e(k)-e(m)))))},E=a=>{S()},M=a=>{S()},p=a=>{f(a.clientX,a.clientY)},P=a=>{a.key==="Escape"&&(n().scene.controller.pressing_alt?n().move_center_to(e(g),e(c)):n().scale=e(r),S(),nt(a))};var C=He();j("pointerup",B,function(...a){var u;(u=e(s)?E:void 0)==null||u.apply(this,a)}),j("pointermove",B,function(...a){var u;(u=e(s)?p:void 0)==null||u.apply(this,a)}),j("pointerleave",B,function(...a){var u;(u=e(s)?M:void 0)==null||u.apply(this,a)}),j("keydown",B,function(...a){var u;(u=e(s)?P:void 0)==null||u.apply(this,a)},!0);var H=L(C);H.__pointerdown=[Ee,_];var A=N(H);{var G=a=>{yt(a,{get x_start(){return e(d)},get y_start(){return e(m)},get x_last(){return e(b)},get y_last(){return e(y)},container_width:innerWidth,container_height:innerHeight})};D(A,a=>{e(s)&&a(G)})}T(()=>{X(H,"cx",n().x),X(H,"cy",n().y),X(H,"r",l()/2),F(H,"pressing",e(s)),$(H,"cursor",e(x))}),Y(o,C),O()}ot(["pointerdown"]);var Ke=V("<!> <!>",1);function Xe(o,t){var n=Ke(),l=L(n);At(l,{get unit(){return t.unit}});var h=N(l,2);Pe(h,{get unit(){return t.unit}}),Y(o,n)}const Ce=(o,t)=>{t(o.clientX,o.clientY),nt(o)};var ze=et('<polygon role="none" class="unit_polygon_point_handles svelte-1fl6mbc" fill="var(--color_selected)"></polygon><!>',1);function Ue(o,t){Z(t,!0);const n=Q(t,"size",3,wt);let l=w(!1),h=w(null),s=w(null),r=w(null),g=w(null),c=w(null),d=w(null),m=w(null),b=w(null),y=w(v(t.point));const I=z(()=>t.unit.x+t.transformed_point.x),k=z(()=>t.unit.y+t.transformed_point.y),x=z(()=>n()/2),_=z(()=>t.unit.scene.controller.pressing_ctrl&&t.unit.scene.controller.pressing_alt?"no-drop":t.unit.scene.controller.pressing_alt?t.unit.scene.controller.pressing_shift?"alias":"copy":"move"),S=(u,R)=>{if(t.unit.scene.controller.pressing_ctrl&&t.unit.scene.controller.pressing_alt){t.unit.points.length>3&&t.unit.remove_point(t.point);return}e(l)||(i(l,!0),t.unit.scene.controller.pressing_alt?i(y,v(t.unit.duplicate_point(t.point,t.unit.scene.controller.pressing_shift))):i(y,v(t.point)),i(h,v(e(y).x)),i(s,v(e(y).y)),i(r,v(u)),i(g,v(R)),i(c,v(u)),i(d,v(R)))},f=()=>{i(l,!1),i(h,null),i(s,null),i(r,null),i(g,null),i(c,null),i(d,null),i(m,null),i(b,null),i(y,v(t.point))},E=(u,R)=>{i(c,v(e(m))),i(d,v(e(b))),i(m,v(u)),i(b,v(R)),e(c)!==null&&e(d)!==null&&t.unit.move_transformed_point(e(y),e(m)-e(c),e(b)-e(d))},M=u=>{f()},p=u=>{f()},P=u=>{E(u.clientX,u.clientY)},C=u=>{u.key==="Escape"&&(t.unit.scene.controller.pressing_alt&&e(y)!==t.point?t.unit.remove_point(e(y)):(e(y).x=e(h),e(y).y=e(s),t.unit.update_points()),f(),nt(u))};var H=ze();j("pointerup",B,function(...u){var R;(R=e(l)?M:void 0)==null||R.apply(this,u)}),j("pointermove",B,function(...u){var R;(R=e(l)?P:void 0)==null||R.apply(this,u)}),j("pointerleave",B,function(...u){var R;(R=e(l)?p:void 0)==null||R.apply(this,u)}),j("keydown",B,function(...u){var R;(R=e(l)?C:void 0)==null||R.apply(this,u)},!0);var A=L(H);A.__pointerdown=[Ce,S];var G=N(A);{var a=u=>{yt(u,{get x_start(){return e(r)},get y_start(){return e(g)},get x_last(){return e(c)},get y_last(){return e(d)},container_width:innerWidth,container_height:innerHeight})};D(G,u=>{e(l)&&u(a)})}T(()=>{X(A,"points",`${e(I)-e(x)},${e(k)-e(x)} ${e(I)+e(x)},${e(k)-e(x)} ${e(I)??""},${e(k)+e(x)}`),F(A,"pressing",e(l)),$(A,"cursor",e(_))}),Y(o,H),O()}ot(["pointerdown"]);const je=(o,t)=>{t(o.clientX,o.clientY),nt(o)};var Ae=et('<polygon role="none" class="unit_angle_handles svelte-185pjka" fill="var(--color_selected)"></polygon><!>',1);function Te(o,t){Z(t,!0);const n=Q(t,"unit",7),l=Q(t,"size",3,wt),h=.013;let s=w(!1),r=w(null),g=w(null),c=w(null),d=w(null),m=w(null),b=w(null),y=w(null);const I=(a,u)=>{e(s)||(i(s,!0),i(r,v(n().angle)),i(g,v(a)),i(c,v(u)),i(d,v(a)),i(m,v(u)))},k=()=>{i(s,!1),i(r,null),i(g,null),i(c,null),i(d,null),i(m,null),i(b,null),i(y,null)},x=(a,u)=>{i(d,v(e(b))),i(m,v(e(y))),i(b,v(a)),i(y,v(u)),e(d)!==null&&e(m)!==null&&(n().angle=oe(e(r)+h*(e(b)-e(g)-(e(y)-e(c)))))},_=a=>{k()},S=a=>{k()},f=a=>{x(a.clientX,a.clientY)},E=a=>{a.key==="Escape"&&(n().angle=e(r),k(),nt(a))},M=z(()=>n().x+l()*Math.cos(-1*(n().angle-Math.PI/2))),p=z(()=>n().y-l()*Math.sin(-1*(n().angle-Math.PI/2))),P=z(()=>`${e(M)},${e(p)-l()/2} ${e(M)+l()/3},${e(p)} ${e(M)},${e(p)+l()/2} ${e(M)-l()/3},${e(p)}`);var C=Ae();j("pointerup",B,function(...a){var u;(u=e(s)?_:void 0)==null||u.apply(this,a)}),j("pointermove",B,function(...a){var u;(u=e(s)?f:void 0)==null||u.apply(this,a)}),j("pointerleave",B,function(...a){var u;(u=e(s)?S:void 0)==null||u.apply(this,a)}),j("keydown",B,function(...a){var u;(u=e(s)?E:void 0)==null||u.apply(this,a)},!0);var H=L(C);H.__pointerdown=[je,I];var A=N(H);{var G=a=>{yt(a,{get x_start(){return e(g)},get y_start(){return e(c)},get x_last(){return e(d)},get y_last(){return e(m)},container_width:innerWidth,container_height:innerHeight})};D(A,a=>{e(s)&&a(G)})}T(()=>{X(H,"points",e(P)),X(H,"transform",`rotate(${n().rotation??""} ${e(M)??""} ${e(p)??""})`),F(H,"pressing",e(s))}),Y(o,C),O()}ot(["pointerdown"]);var Ne=V("<!> <!> <!>",1);function qe(o,t){Z(t,!0);var n=Ne(),l=L(n);Ct(l,18,()=>t.unit.points,r=>r,(r,g,c)=>{Ue(r,{get unit(){return t.unit},get point(){return g},get transformed_point(){return t.unit.transformed_points[e(c)]}})});var h=N(l,2);At(h,{get unit(){return t.unit}});var s=N(h,2);Te(s,{get unit(){return t.unit}}),Y(o,n),O()}function We(o,t){Z(t,!0);const n=z(()=>t.unit.type);var l=at(),h=L(l);{var s=g=>{Xe(g,{get unit(){return t.unit}})},r=g=>{var c=at(),d=L(c);{var m=y=>{qe(y,{get unit(){return t.unit}})},b=y=>{var I=rt();T(()=>vt(I,Ut(e(n)))),Y(y,I)};D(d,y=>{e(n)==="polygon"?y(m):y(b,!1)},!0)}Y(g,c)};D(h,g=>{e(n)==="circle"?g(s):g(r,!1)})}Y(o,l),O()}var Be=V('<menu class="pane unstyled svelte-pa2qv7"><!></menu>'),De=V('<li role="none" class="svelte-pa2qv7"><div class="menu_item plain selectable svelte-pa2qv7" role="menuitem" aria-label="contextmenu submenmu" tabindex="-1"><div class="content"><div class="icon"><!></div> <div class="title"><!></div></div> <div class="chevron svelte-pa2qv7" aria-hidden="true"></div></div> <!></li>');function Re(o,t){Z(t,!0);const n=re.get(),l=n.add_submenu(),{layout:h}=n,s=z(()=>l.selected);let r=w(void 0);const g=Yt.get(),c=Yt.set();let d=w(0),m=w(0);Ht(()=>{e(r)&&b(e(r),h,g)});const b=(p,P,C)=>{const{x:H,y:A,width:G,height:a}=p.getBoundingClientRect();c.width=G,c.height=a;const u=H-e(d),R=A-e(m),_t=u+G+C.width-P.width;if(_t<=0)i(d,v(C.width));else{const ct=G-u;ct<=0?i(d,-G):ct>_t?i(d,C.width-_t):i(d,ct-G)}i(m,v(Math.min(0,P.height-(R+a))))};var y=De(),I=q(y),k=q(I),x=q(k),_=q(x);ut(_,()=>t.icon??Et),W(x);var S=N(x,2),f=q(S);ut(f,()=>t.children),W(S),W(k),lt(2),W(I);var E=N(I,2);{var M=p=>{var P=Be(),C=q(P);ut(C,()=>t.menu),W(P),ve(P,H=>i(r,H),()=>e(r)),T(()=>{$(P,"transform",`translate3d(${e(d)??""}px, ${e(m)??""}px, 0)`),$(P,"max-height",`${h.height??""}px`)}),Y(p,P)};D(E,p=>{e(s)&&p(M)})}W(y),T(()=>{$(y,"--contextmenu_depth",l.depth),X(I,"aria-expanded",e(s)),F(I,"selected",e(s))}),j("mouseenter",I,p=>{nt(p),setTimeout(()=>n.select(l))}),Y(o,y),O()}var Ve=et('<circle role="none"></circle>'),Fe=et('<polygon role="none"></polygon>'),Le=et('<svg class="unit_icon svelte-yrh1le"><!></svg>');function Je(o,t){Z(t,!0);const n=Q(t,"padding",3,2),l=z(()=>t.unit.type),h=z(()=>t.unit.points),s=z(()=>t.unit.angle),r=100,g=r/2,c=z(()=>`rotate(${e(s)*360/(Math.PI*2)} ${g} ${g})`),d=z(()=>{if(e(l)!=="polygon"||!e(h).length)return"";const k=e(h).map(P=>P.x),x=e(h).map(P=>P.y),_=(Math.min(...k)+Math.max(...k))/2,S=(Math.min(...x)+Math.max(...x))/2,f=Math.max(...e(h).map(P=>Math.sqrt((P.x-_)**2+(P.y-S)**2))),E=(r-n()*2)/(f*2),M=r/2-_*E,p=r/2-S*E;return e(h).map(P=>`${P.x*E+M},${P.y*E+p}`).join(" ")});var m=Le();X(m,"viewBox",`0 0 ${r} ${r}`);var b=q(m);{var y=k=>{var x=Ve();X(x,"cx",g),X(x,"cy",g),T(()=>{X(x,"r",(r-n()*2)/2.6),X(x,"fill",t.unit.color),X(x,"transform",e(c))}),Y(k,x)},I=k=>{var x=at(),_=L(x);{var S=E=>{var M=Fe();T(()=>{X(M,"points",e(d)),X(M,"fill",t.unit.color),X(M,"transform",e(c))}),Y(E,M)},f=E=>{var M=rt();T(()=>vt(M,Ut(e(l)))),Y(E,M)};D(_,E=>{e(l)==="polygon"?E(S):E(f,!1)},!0)}Y(k,x)};D(b,k=>{e(l)==="circle"?k(y):k(I,!1)})}W(m),Y(o,m),O()}var Oe=V("<!> <!> <!> <!>",1),Ze=V("<small><code> </code></small>"),Ge=V("Unit <!>",1),Qe=V('<div class="display_contents"><!></div>');function $e(o,t){Z(t,!0);const n=g=>{var c=at(),d=L(c);{var m=b=>{Re(b,{menu:k=>{var x=Oe(),_=L(x);mt(_,{icon:"⎘",run:()=>{const p=t.unit.clone();p.x+=10,p.y+=10,t.scene.add_unit(p)},children:(p,P)=>{lt();var C=rt("Duplicate unit");Y(p,C)},$$slots:{default:!0}});var S=N(_,2);{var f=p=>{mt(p,{icon:"◎",run:()=>{t.unit.create_new_point()},children:(P,C)=>{lt();var H=rt("Add point to polygon");Y(P,H)},$$slots:{default:!0}})};D(S,p=>{t.unit.type==="polygon"&&p(f)})}var E=N(S,2);mt(E,{icon:"⌸",run:async()=>{const p=JSON.stringify(t.unit.json);await navigator.clipboard.writeText(p)},children:(p,P)=>{lt();var C=rt("Copy data to clipboard");Y(p,C)},$$slots:{default:!0}});var M=N(E,2);mt(M,{icon:"✕",run:()=>{t.scene.remove_unit(t.unit)},children:(p,P)=>{lt();var C=rt("Delete unit");Y(p,C)},$$slots:{default:!0}}),Y(k,x)},icon:k=>{Je(k,{get unit(){return t.unit}})},children:(k,x)=>{lt();var _=Ge(),S=N(L(_));{var f=M=>{var p=rt();T(()=>vt(p,t.unit.name)),Y(M,p)},E=M=>{var p=Ze(),P=q(p),C=q(P,!0);W(P),W(p),T(()=>vt(C,t.unit.id_string)),Y(M,p)};D(S,M=>{t.unit.name?M(f):M(E,!1)})}Y(k,_)},$$slots:{menu:!0,icon:!0,default:!0}})};D(d,b=>{t.unit&&b(m)})}Y(g,c)};var l=at(),h=L(l);{var s=g=>{var c=Qe(),d=q(c);ut(d,()=>t.children),W(c),se(c,(m,b)=>{var y;return(y=ae)==null?void 0:y(m,b)},()=>n),T(()=>X(c,"data-unit",t.unit.id)),Y(g,c)},r=g=>{var c=at(),d=L(c);ut(d,()=>t.children),Y(g,c)};D(h,g=>{t.unit?g(s):g(r,!1)})}Y(o,l),O()}const tn=()=>({selecting:!1,selection_start_x:0,selection_start_y:0,selection_width:0,selection_height:0,initial_pointer_x:0,initial_pointer_y:0});var ft,tt,st;class en{constructor(t){Mt(this,"selection_threshold",0);dt(this,ft,w(v(tn())));dt(this,tt,w(v(new Set)));dt(this,st,w(v(new Set)));this.helpers=t}get state(){return e(J(this,ft))}set state(t){i(J(this,ft),v(t))}has(t){return e(J(this,tt)).has(t)}add(t){e(J(this,tt)).add(t)}delete(t){e(J(this,tt)).delete(t)}clear(){e(J(this,tt)).clear()}get_selected_items(){return Array.from(e(J(this,tt)))}handle_selection_start(t,n,l){const h=this.helpers.find_top_item(t,n),s=h&&this.has(h);if(this.state.initial_pointer_x=t,this.state.initial_pointer_y=n,i(J(this,st),v(new Set(e(J(this,tt))))),l==="subtractive"&&s){this.delete(h);return}h&&l!=="subtractive"?(l==="normal"&&this.clear(),this.add(h)):l==="normal"&&this.clear()}start_drag(t,n){this.state.selecting=!0,this.state.selection_start_x=t,this.state.selection_start_y=n,this.state.selection_width=0,this.state.selection_height=0}update_drag(t,n,l){if(!this.state.selecting)return;this.state.selection_width=t-this.state.selection_start_x,this.state.selection_height=n-this.state.selection_start_y;const h=this.state.selection_width>=0?this.state.selection_start_x:t,s=this.state.selection_height>=0?this.state.selection_start_y:n,r=Math.abs(this.state.selection_width),g=Math.abs(this.state.selection_height),c=this.helpers.find_all_items(h,s,r,g);switch(l){case"additive":i(J(this,tt),v(new Set(e(J(this,st)))));for(const d of c)this.add(d);break;case"subtractive":i(J(this,tt),v(new Set(e(J(this,st)))));for(const d of c)this.delete(d);break;case"normal":this.clear();for(const d of c)this.add(d);break;default:throw new ue(l)}}end_drag(t,n,l){const h=t-this.state.initial_pointer_x,s=n-this.state.initial_pointer_y,r=Math.sqrt(h*h+s*s)>this.selection_threshold;this.state.selecting&&r&&this.update_drag(t,n,l),this.state.selecting=!1,this.state.selection_width=0,this.state.selection_height=0,e(J(this,st)).clear()}}ft=new WeakMap,tt=new WeakMap,st=new WeakMap;const nn=(o,t,n,l,h,s,r,g)=>{t(o.offsetX,o.offsetY),n(n().pointer_down=!0,!0),n(n().drag_start_x=n().pointer_x,!0),n(n().drag_start_y=n().pointer_y,!0);const c=o.shiftKey&&o.ctrlKey&&!o.altKey;if(n().hovering_handle){!o.altKey&&o.shiftKey&&n().hovering_unit&&(n(n().dragging_unit=n().hovering_unit,!0),n(n().dragging_selection=!0,!0),l.unit_selection.has(n().hovering_unit)||((!o.ctrlKey||c)&&l.unit_selection.clear(),l.unit_selection.add(n().hovering_unit)),c&&e(h)&&s());return}const d=n().hovering_unit;if(d&&l.unit_selection.has(d)&&(o.shiftKey&&!o.altKey||!o.ctrlKey)){n(n().dragging_unit=d,!0),n(n().dragging_selection=!0,!0),c&&e(h)&&s();return}r.handle_selection_start(n().pointer_x,n().pointer_y,g(o)),l.unit_selection.clear();for(const b of r.get_selected_items())l.unit_selection.add(b)},ln=(o,t,n,l,h,s)=>{if(t(o.offsetX,o.offsetY),n.state.selecting){n.end_drag(l().pointer_x,l().pointer_y,h(o)),s.unit_selection.clear();for(const r of n.get_selected_items())s.unit_selection.add(r)}l(l().pointer_down=!1,!0),l(l().drag_start_x=null,!0),l(l().drag_start_y=null,!0),l(l().dragging_unit=null,!0),l(l().dragging_selection=!1,!0)},on=(o,t,n,l,h,s)=>{if(t(o.offsetX,o.offsetY),n().pointer_down&&!n().dragging_unit){const r=n().pointer_x-l.state.initial_pointer_x,g=n().pointer_y-l.state.initial_pointer_y;Math.sqrt(r*r+g*g)>l.selection_threshold&&!l.state.selecting&&l.start_drag(l.state.initial_pointer_x,l.state.initial_pointer_y)}if(l.state.selecting){l.update_drag(n().pointer_x,n().pointer_y,h(o)),s.unit_selection.clear();for(const r of l.get_selected_items())s.unit_selection.add(r)}};var rn=et('<rect class="selection_rect svelte-1s96klh"></rect>'),sn=V('<div class="scene_interaction_surface svelte-1s96klh"><svg class="controls_layer svelte-1s96klh"><!><!></svg></div>');function Pn(o,t){Z(t,!0);const n=Q(t,"scene_interaction_surface_state",15),l=z(()=>t.scene.controller),h=_=>_,s=_=>_,r=new en({find_top_item:t.scene.find_top_unit_at_point,find_all_items:t.scene.find_all_units_in_rect}),g=_=>_.shiftKey&&_.ctrlKey?"additive":_.ctrlKey?"subtractive":_.shiftKey?"additive":"normal",c=z(()=>n().hovering_unit!==null&&t.unit_selection.has(n().hovering_unit)),d=(_,S)=>{const f=h(_),E=s(S),M=n().pointer_x,p=n().pointer_y;if(n(n().pointer_x=f,!0),n(n().pointer_y=E,!0),n().dragging_unit){const P=f-M,C=E-p;for(const H of t.unit_selection)H.x+=P,H.y+=C}else n(n().hovering_unit=t.scene.find_top_unit_at_point(f,E),!0),n().hovering_unit&&n(n().hovered_unit=n().hovering_unit,!0)},m=()=>{const _=[];for(const S of t.unit_selection){const f=S.clone();t.scene.add_unit(f),_.push(f)}t.unit_selection.clear(),r.clear();for(const S of _)t.unit_selection.add(S),r.add(S)},b=_=>{d(_.offsetX,_.offsetY),n(n().pointing=!0,!0)},y=_=>{d(_.offsetX,_.offsetY),n(n().pointing=!1,!0),n(n().hovering_unit=null,!0)},I=_=>{n().pointer_down&&n(n().pointer_down=!1,!0),n(n().dragging_unit=null,!0),n(n().dragging_selection=!1,!0)},k=_=>{(_.key==="Shift"||_.key==="Control")&&r.update_drag(n().pointer_x,n().pointer_y,g(_))},x=_=>{(_.key==="Shift"||_.key==="Control")&&r.update_drag(n().pointer_x,n().pointer_y,g(_))};j("keydown",B,k),j("keyup",B,x),$e(o,{get scene(){return t.scene},get unit(){return n().hovered_unit},children:(_,S)=>{var f=sn();f.__pointerdown=[nn,d,n,t,c,m,r,g],f.__pointerup=[ln,d,r,n,g,t],f.__pointermove=[on,d,n,r,g,t];const E=z(()=>n().hovering_unit&&t.unit_selection.has(n().hovering_unit)&&!r.state.selecting&&!n().pointer_down);T(()=>F(f,"grabbable",e(E)));var M=q(f),p=q(M);Ct(p,16,()=>Array.from(t.unit_selection),H=>H,(H,A)=>{We(H,{get unit(){return A}})});var P=N(p);{var C=H=>{var A=rn();T(()=>X(A,"width",Math.abs(r.state.selection_width))),T(()=>X(A,"height",Math.abs(r.state.selection_height))),T(()=>{X(A,"x",r.state.selection_width>=0?r.state.selection_start_x:r.state.selection_start_x+r.state.selection_width),X(A,"y",r.state.selection_height>=0?r.state.selection_start_y:r.state.selection_start_y+r.state.selection_height)}),Y(H,A)};D(P,H=>{r.state.selecting&&H(C)})}W(M),W(f),T(()=>{F(f,"pressing",n().pointer_down),F(f,"selecting",r.state.selecting),F(f,"hovering",!!n().hovering_unit),F(f,"hovering_selection",e(c)),F(f,"grabbing",n().dragging_unit!==null),F(f,"pressing_shift",e(l).pressing_shift),F(f,"pressing_ctrl",e(l).pressing_ctrl),F(f,"pressing_alt",e(l).pressing_alt),$(f,"width",`${t.width??""}px`),$(f,"height",`${t.height??""}px`),X(M,"width",t.width),X(M,"height",t.height)}),j("pointerenter",f,b),j("pointerleave",f,y),j("pointercancel",f,I),Y(_,f)},$$slots:{default:!0}}),O()}ot(["pointerdown","pointerup","pointermove"]);var an=V('<div class="flex align_items_end font_weight_700 px_md font_mono"><div class="text_align_right pr_xs"> </div> <div class="text_color_4">fps</div></div>');function En(o,t){Z(t,!0);const n=z(()=>t.clock??ce.get());var l=an(),h=q(l);$(h,"width","4rem");var s=q(h,!0);W(h),lt(2),W(l),T(()=>vt(s,e(n).average_fps)),Y(o,l),O()}var un=(o,t)=>i(t,!0),cn=V("<p><strong>WASD</strong> and <strong>arrow keys</strong> to move the player</p>"),dn=V("<p><strong>` Backtick</strong> to toggle playing</p>"),_n=V('<div class="content svelte-9yd3sr"><h2 class="mt_0">Global controls</h2> <!> <p><strong>r</strong> to reset</p> <p><strong>spacebar</strong> to toggle the clock</p> <!> <p><strong>~ Shift+Backtick</strong> to toggle editing</p> <p>edit with mouse and <strong>Ctrl</strong>/<strong>Shift</strong>/<strong>Alt</strong>:</p> <ul><li><strong>Shift</strong> to add to selection</li> <li><strong>Ctrl</strong> to remove from selection</li> <li><strong>Shift+Ctrl</strong> to duplicate the selected units</li> <li><strong>Alt</strong> to recenter polygons</li> <li><strong>Alt</strong> to duplicate points</li> <li><strong>Alt+Shift</strong> to duplicate points counterclockwise</li></ul></div>'),vn=V('<button type="button">help</button> <!>',1);function Hn(o,t){Z(t,!0);const n=zt.get();let l=w(!1);var h=vn(),s=L(h);s.__click=[un,l];var r=N(s,2);{var g=c=>{de(c,{onclose:()=>i(l,!1),children:(d,m)=>{var b=_n(),y=N(q(b),2);{var I=_=>{var S=cn();Y(_,S)};D(y,_=>{n.player_input_enabled&&_(I)})}var k=N(y,6);{var x=_=>{var S=dn();Y(_,S)};D(k,_=>{n.player_input_enabled&&_(x)})}lt(6),W(b),Y(d,b)},$$slots:{default:!0}})};D(r,c=>{e(l)&&c(g)})}Y(o,h),O()}ot(["click"]);export{En as F,Hn as H,Mn as S,Je as U,Yn as a,Pn as b,In as c,$e as d};
