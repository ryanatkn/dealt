import{a as _,t as b,b as z,c as Be}from"./disclose-version.Ds06f9Vu.js";import{q as A,v as ae,s as p,m as U,o as H,c as n,r,K as g,L as Q,a0 as re,W as O,u as fe,D as Le,n as j}from"./runtime.5k9ShzZt.js";import{d as Z,s as me,k as le}from"./render.CAjsxhF5.js";import{s as F,t as X,r as J,e as _e,b as ne,h as ce,i as qe}from"./string.D4Ftlgln.js";import{p as ee,i as G,c as ie}from"./props.lofZ2jro.js";import{t as W,s as K}from"./index.DteDSzYE.js";import{e as he,f as be,U as ge,u as Se,v as ze,H as Ce,G as Ee,x as $e}from"./renderer_components.Cmt3dLGU.js";import{U as ye,d as xe,c as C}from"./Help_Button.BcYO9BjV.js";import{s as De}from"./snippet.CcawutmI.js";var Oe=(c,t)=>{t.editor.collapsed_layers.clear()},Ae=(c,t,e)=>{for(const a of t.units)e.editor.collapsed_layers.add(a)},He=b('<button type="button" class="plain">expand all</button> <button type="button" class="plain">collapse all</button>',1);function Me(c,t){A(t,!0);const{scene:e}=t.editor.project;var a=He(),s=ae(a);s.__click=[Oe,t];var i=p(s,2);i.__click=[Ae,e,t],U(()=>{s.disabled=!t.editor.collapsed_layers.size,i.disabled=t.editor.collapsed_layers.size===e.units.length}),_(c,a),H()}Z(["click"]);var Ge=(c,t,e)=>t.set(e()),Re=b('<input class="unit_name plain svelte-znqd6i" placeholder="name">'),Ne=b('<div class="unit_name svelte-znqd6i"> </div>'),Ve=b('<li role="none" class="unit_list_item plain svelte-znqd6i"><label class="flex_1 row mb_0 pr_lg"><div class="unit_type svelte-znqd6i"><!></div> <!></label></li>');function We(c,t){A(t,!0);const e=ee(t,"unit",7),{unit_selection:a}=he.get(),s=Q(()=>a.has(e()));var i=Ve();i.__pointerdown=[Ge,a,e];var o=n(i),u=n(o),v=n(u);ye(v,{get unit(){return e()}}),r(u);var m=p(u,2);{var x=l=>{var d=Re();J(d),be(d,()=>e().name,y=>e().name=y),_(l,d)},P=l=>{var d=Ne(),y=n(d,!0);r(d),U(()=>me(y,e().name)),_(l,d)};G(m,l=>{g(s)?l(x):l(P,!1)})}r(o),r(i),U(()=>{F(i,"id",`unit_list_item_${e().id??""}`),X(i,"selected",g(s))}),W(3,i,()=>K),_(c,i),H()}Z(["pointerdown"]);var Ke=b('<div class="list_item svelte-1ukt32m" draggable="true"><!></div>'),Ye=b('<div class="drop_indicator svelte-1ukt32m"></div>'),Fe=b('<div class="reorderable_list svelte-1ukt32m"><ul class="unstyled"></ul> <!></div>');function Je(c,t){A(t,!0);let e=re(null),a=re(null),s=re(null);const i=l=>{if(l.preventDefault(),g(e)===null||!l.currentTarget||!l.dataTransfer)return;const d=l.currentTarget,y=Array.from(d.children),f=y.map(B=>B.getBoundingClientRect()),q=d.getBoundingClientRect(),R=l.clientY;let I=f.findIndex(B=>R<(B.bottom+B.top)/2);if(I===-1){if(I=y.length,y.length>0){const B=f[y.length-1];O(s,B.bottom-q.top)}}else O(s,f[I].top-q.top);I>g(e)&&I--,O(a,ie(I)),l.dataTransfer.dropEffect="move"},o=l=>{var d;l.preventDefault(),((d=l.dataTransfer)==null?void 0:d.dropEffect)==="move"&&g(e)!==null&&g(a)!==null&&g(e)!==g(a)&&t.on_reorder(g(e),g(a)),O(e,null),O(a,null),O(s,null)},u=l=>{if(!l.dataTransfer)return;const y=l.target.closest("[data-item]");if(!y)return;const f=parseInt(y.dataset.item??"",10);f&&(l.dataTransfer.effectAllowed="move",O(e,ie(t.items.findIndex(q=>q.id===f))))};var v=Fe(),m=n(v);_e(m,22,()=>t.items,l=>l,(l,d,y)=>{var f=Ke(),q=n(f);De(q,()=>t.children,()=>d),r(f),U(()=>{F(f,"data-item",d.id),X(f,"dragging",g(y)===g(e))}),_(l,f)}),r(m);var x=p(m,2);{var P=l=>{var d=Ye();U(()=>ne(d,"top",`${g(s)??""}px`)),_(l,d)};G(x,l=>{g(s)!==null&&l(P)})}r(v),le("dragover",m,i),le("dragend",m,o),le("dragstart",m,u),_(c,v),H()}var Qe=b('<div class="unit_list svelte-xyjzex"><!></div>');function Xe(c,t){A(t,!0),ee(t,"scroll_on_select",3,!0)()&&fe(()=>{var o;const{latest:i}=t.project.editor.unit_selection;i&&((o=document.getElementById("unit_list_item_"+i.id))==null||o.scrollIntoView({block:"nearest"}))});var a=Qe(),s=n(a);Je(s,{get items(){return t.project.scene.units},on_reorder:(o,u)=>t.project.scene.move_unit(o,u),children:(o,u=Le)=>{xe(o,{get scene(){return t.project.scene},get unit(){return u()},children:(v,m)=>{We(v,{get unit(){return u()}})},$$slots:{default:!0}})},$$slots:{default:!0}}),r(a),_(c,a),H()}var Ze=b('<div class="unit_palette svelte-1qh4yco"><button type="button" title="add circle" class="svelte-1qh4yco">add circle ⬤</button> <button type="button" title="add polygon" class="svelte-1qh4yco">add polygon ▰</button></div>');function et(c,t){A(t,!0);const e=ee(t,"add_unit",3,m=>t.scene.add_unit(m));let a=0;const s=()=>{e()(new ge(t.scene,{type:"circle",x:100+Math.cos(a)*((a+10)*2),y:100+Math.sin(a)*((a+10)*2),radius:10})),a++},i=()=>{e()(new ge(t.scene,{type:"polygon",x:100+Math.cos(a)*((a+10)*2),y:100+Math.sin(a)*((a+10)*2),rotation:a*.8,points:[{x:-20,y:12},{x:30,y:-15},{x:17,y:17}]})),a++};var o=Ze(),u=n(o);u.__click=s;var v=p(u,2);v.__click=i,r(o),_(c,o),H()}Z(["click"]);var tt=(c,t)=>{c.currentTarget.checked?t().add_behavior(new ze):t().remove_behavior("Player_Controller_Behavior")},at=(c,t)=>{c.currentTarget.checked?t().add_behavior(new Ce):t().remove_behavior("Harmful_Behavior")},rt=(c,t)=>{c.currentTarget.checked?t().add_behavior(new Ee):t().remove_behavior("Goal_Behavior")},lt=b('<div class="w_100 mt_lg flex gap_lg justify_content_end flex_wrap"><label class="row mb_0" title="use WASD to move the player"><input type="checkbox"> player controls</label> <label class="row mb_0" title="causes damage to the player"><input type="checkbox"> harmful</label> <label class="row mb_0" title="the player touches this unit to win"><input type="checkbox"> goal</label> <label class="row mb_0" title="the unit is a goner"><input type="checkbox"> dead</label></div>');function nt(c,t){A(t,!0);const e=ee(t,"unit",7);var a=lt(),s=n(a),i=n(s);J(i),U(()=>ce(i,e().behaviors.has("Player_Controller_Behavior"))),i.__change=[tt,e],j(),r(s);var o=p(s,2),u=n(o);J(u),U(()=>ce(u,e().behaviors.has("Harmful_Behavior"))),u.__change=[at,e],j(),r(o);var v=p(o,2),m=n(v);J(m),U(()=>ce(m,e().behaviors.has("Goal_Behavior"))),m.__change=[rt,e],j(),r(v);var x=p(v,2),P=n(x);J(P),j(),r(x),r(a),Se(P,()=>e().dead,l=>e().dead=l),_(c,a),H()}Z(["change"]);var it=(c,t,e)=>{t.unit.remove_point(e)},st=b('<li class="row"><div class="flex_1 row justify_content_end"><!> <!></div> <button type="button" class="icon_button plain ml_md" title="remove point">✕</button></li>'),ot=b('<ul class="unstyled"></ul>');function dt(c,t){A(t,!0);const e=.5,a=Q(()=>t.unit.points.length<=3);var s=ot();_e(s,22,()=>t.unit.points,i=>i,(i,o,u)=>{var v=st(),m=n(v);ne(m,"--title_width","3.4rem");var x=n(m);C(x,{get title(){return`polygon.points[${g(u)??""}].x`},classes:"mb_0",input_classes:"plain",row:!0,get value(){return o.x},oninput:d=>{o.x=d,t.unit.update_points()},step:e,children:(d,y)=>{j();var f=z("x");_(d,f)},$$slots:{default:!0}});var P=p(x,2);C(P,{get title(){return`polygon.points[${g(u)??""}].y`},classes:"mb_0",input_classes:"plain",row:!0,get value(){return o.y},oninput:d=>{o.y=d,t.unit.update_points()},step:e,children:(d,y)=>{j();var f=z("y");_(d,f)},$$slots:{default:!0}}),r(m);var l=p(m,2);l.__pointerup=[it,t,o],r(v),U(()=>l.disabled=g(a)),W(3,v,()=>K),_(i,v)}),r(s),_(c,s),H()}Z(["pointerup"]);const ct=(c,t,e)=>{t.has(e())?t.delete(e()):t.add(e())};var _t=(c,t,e)=>t.set(e()),vt=b('<div class="input_row svelte-ffu65v"><!> <!></div> <div class="input_row svelte-ffu65v"><!></div> <div class="input_row svelte-ffu65v"><!></div>',1),ut=(c,t)=>{t().add_point(new $e(120,200))},pt=b('<div class="input_row svelte-ffu65v"><!> <!></div> <div class="input_row svelte-ffu65v"><!></div> <div class="input_row mb_md svelte-ffu65v"><!></div> <!> <button type="button" title="add a point to this polygon" class="plain justify_self_end">add point ◎</button>',1),gt=b('<div><div class="py_sm"><button type="button" class="inline color_g selected white_space_nowrap" title="this polygon intersects itself - collision detection is disabled">self-intersecting</button></div></div>'),ft=(c,t)=>{alert(`TODO automatically decompose the concave polygon into ${t().decomped.length} convex ones, need to support multiple bodies per unit`)},mt=b('<div><div class="py_sm"><button type="button" class="inline color_d selected deselectable white_space_nowrap">concave</button></div></div>'),ht=b('<div class="row gap_sm"><!> <!></div>'),bt=b('<div><div class="row pb_sm pt_md"><div class="pr_md text_align_right font_weight_600 input_width_sm">id</div> <small> </small></div> <!> <!> <!></div>'),yt=b('<li class="unit_layer svelte-ffu65v" role="none"><header class="row gap_xs2 svelte-ffu65v"><div class="unit_layer_type svelte-ffu65v"><button type="button" class="plain"><div class="row"><div class="chevron svelte-ffu65v"></div> <!></div></button></div> <input class="name_input plain svelte-ffu65v" placeholder="name"></header> <!></li>');function xt(c,t){A(t,!0);const e=ee(t,"unit",7),{unit_selection:a,collapsed_layers:s}=he.get(),i=Q(()=>s.has(e())),o=.5,u=.1;var v=yt();v.__pointerdown=[_t,a,e];const m=Q(()=>a.has(e()));var x=n(v),P=n(x),l=n(P);l.__click=[ct,s,e];var d=n(l),y=p(n(d),2);ye(y,{get unit(){return e()}}),r(d),r(l),r(P);var f=p(P,2);J(f),r(x);var q=p(x,2);{var R=I=>{var B=bt(),se=n(B),oe=p(n(se),2);ne(oe,"padding","var(--input_padding_y) var(--input_padding_x)");var we=n(oe,!0);r(oe),r(se);var ve=p(se,2);{var ke=S=>{var E=vt(),$=ae(E);ne($,"--title_width","3.4rem");var Y=n($);C(Y,{title:"circle x",input_classes:"plain",row:!0,step:o,get value(){return e().x},set value(h){e().x=h},children:(h,te)=>{j();var L=z("x");_(h,L)},$$slots:{default:!0}});var N=p(Y,2);C(N,{title:"circle y",input_classes:"plain",row:!0,step:o,get value(){return e().y},set value(h){e().y=h},children:(h,te)=>{j();var L=z("y");_(h,L)},$$slots:{default:!0}}),r($);var M=p($,2),T=n(M);C(T,{title:"circle scale",input_classes:"plain",row:!0,step:.01,get value(){return e().scale},set value(h){e().scale=h},children:(h,te)=>{j();var L=z("scale");_(h,L)},$$slots:{default:!0}}),r(M);var w=p(M,2),D=n(w);C(D,{title:"circle radius",input_classes:"plain",row:!0,min:0,step:u,get value(){return e().radius},set value(h){e().radius=h},children:(h,te)=>{j();var L=z("radius");_(h,L)},$$slots:{default:!0}}),r(w),_(S,E)},Pe=S=>{var E=Be(),$=ae(E);{var Y=N=>{var M=pt(),T=ae(M);ne(T,"--title_width","3.4rem");var w=n(T);C(w,{title:"polygon x",input_classes:"plain",row:!0,step:o,get value(){return e().x},set value(k){e().x=k},children:(k,de)=>{j();var V=z("x");_(k,V)},$$slots:{default:!0}});var D=p(w,2);C(D,{title:"polygon y",input_classes:"plain",row:!0,step:o,get value(){return e().y},set value(k){e().y=k},children:(k,de)=>{j();var V=z("y");_(k,V)},$$slots:{default:!0}}),r(T);var h=p(T,2),te=n(h);C(te,{title:"polygon rotation",input_classes:"plain",row:!0,step:Math.PI/360,get value(){return e().rotation},set value(k){e().rotation=k},children:(k,de)=>{j();var V=z("rotation");_(k,V)},$$slots:{default:!0}}),r(h);var L=p(h,2),Ue=n(L);C(Ue,{title:"polygon scale",input_classes:"plain",row:!0,step:.01,get value(){return e().scale},set value(k){e().scale=k},children:(k,de)=>{j();var V=z("scale");_(k,V)},$$slots:{default:!0}}),r(L);var pe=p(L,2);dt(pe,{get unit(){return e()}});var Ie=p(pe,2);Ie.__click=[ut,e],_(N,M)};G($,N=>{e().type==="polygon"&&N(Y)},!0)}_(S,E)};G(ve,S=>{e().type==="circle"?S(ke):S(Pe,!1)})}var ue=p(ve,2);{var Te=S=>{var E=ht(),$=n(E);{var Y=T=>{var w=gt(),D=n(w);r(w),W(3,D,()=>K),W(3,w,()=>K,()=>({axis:"x"})),_(T,w)};G($,T=>{e().is_simple_polygon||T(Y)})}var N=p($,2);{var M=T=>{var w=mt(),D=n(w),h=n(D);h.__click=[ft,e],r(D),r(w),U(()=>F(h,"title",`this polygon is concave, and can be decomposed into ${e().decomped.length??""} convex polygons`)),W(3,D,()=>K),W(3,w,()=>K,()=>({axis:"x"})),_(T,w)};G(N,T=>{e().concave&&T(M)})}r(E),_(S,E)};G(ue,S=>{e().type==="polygon"&&S(Te)})}var je=p(ue,2);nt(je,{get unit(){return e()}}),r(B),U(()=>me(we,e().id)),W(3,B,()=>K),_(I,B)};G(q,I=>{g(i)||I(R)})}r(v),U(()=>{F(v,"id",`unit_layer_${e().id??""}`),X(v,"collapsed",g(i)),X(v,"selected",g(m)),F(l,"title",e().type),F(f,"title",`${e().type??""} name`)}),be(f,()=>e().name,I=>e().name=I),_(c,v),H()}Z(["pointerdown","click"]);var wt=b('<ul class="unit_layers unstyled"></ul>');function kt(c,t){A(t,!0),ee(t,"scroll_on_select",3,!0)()&&fe(()=>{var i;const{latest:s}=t.project.editor.unit_selection;s&&((i=document.getElementById("unit_layer_"+s.id))==null||i.scrollIntoView({block:"nearest"}))});var a=wt();_e(a,21,()=>t.project.scene.units,qe,(s,i)=>{xe(s,{get scene(){return t.project.scene},get unit(){return g(i)},children:(o,u)=>{xt(o,{get unit(){return g(i)}})},$$slots:{default:!0}})}),r(a),_(c,a),H()}var Pt=b('<div class="column svelte-175igsh"><div class="column_panel svelte-175igsh"><!></div> <div class="p_lg"><!></div></div> <div class="column svelte-175igsh"><div class="unit_layers_controls svelte-175igsh"><!></div> <div class="column_panel svelte-175igsh"><!></div></div>',1);function Ct(c,t){const e=Q(()=>t.project.scene),a=Q(()=>t.project.editor);let s=re(0),i=re(0);var o=Pt(),u=ae(o),v=n(u),m=n(v);Xe(m,{get project(){return t.project}}),r(v);var x=p(v,2),P=n(x);et(P,{get scene(){return g(e)}}),r(x),r(u);var l=p(u,2),d=n(l),y=n(d);Me(y,{get editor(){return g(a)}}),r(d);var f=p(d,2),q=n(f);kt(q,{get project(){return t.project}}),r(f),r(l),U(()=>{X(u,"scrolled",g(s)>0),X(f,"scrolled",g(i)>0)}),le("scroll",u,R=>{O(s,ie(R.currentTarget.scrollTop))}),le("scroll",f,R=>{O(i,ie(R.currentTarget.scrollTop))}),_(c,o)}export{Ct as U,Me as a};
