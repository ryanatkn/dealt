import{t as f,a as _,b as C}from"./B-9WnmWB.js";import{p as D,f as ie,s as g,t as L,a as H,c as r,r as l,w as h,x as re,ah as te,_ as A,u as ge,I as Ie,n as U}from"./CsJOpq0I.js";import{d as X,s as me,k as ae}from"./CS7d4eST.js";import{s as K,c as ne,r as Q,b as ce,g as le,h as de}from"./DK50TLbw.js";import{p as Z,i as N}from"./CPwzJCGN.js";import{t as Y,s as F}from"./DoGG4ls-.js";import{e as ye,g as he,U as pe,k as Ue,l as Be,H as qe,G as Le,m as Se}from"./BqE_3Jp1.js";import{U as fe,d as be,c as E}from"./8vfzQ6NH.js";import{s as ze}from"./kQ0gKvDQ.js";var Ce=(c,t)=>{t.editor.collapsed_layers.clear()},Ee=(c,t,e)=>{for(const a of t.units)e.editor.collapsed_layers.add(a)},$e=f('<button type="button" class="plain">expand all</button> <button type="button" class="plain">collapse all</button>',1);function Oe(c,t){D(t,!0);const{scene:e}=t.editor.project;var a=$e(),i=ie(a);i.__click=[Ce,t];var n=g(i,2);n.__click=[Ee,e,t],L(()=>{i.disabled=!t.editor.collapsed_layers.size,n.disabled=t.editor.collapsed_layers.size===e.units.length}),_(c,a),H()}X(["click"]);var Ae=(c,t,e)=>t.set(e()),De=f('<input class="unit_name plain svelte-znqd6i" placeholder="name">'),He=f('<div class="unit_name svelte-znqd6i"> </div>'),Me=f('<li role="none"><label class="flex_1 row mb_0 pr_lg"><div class="unit_type svelte-znqd6i"><!></div> <!></label></li>');function Ge(c,t){D(t,!0);const e=Z(t,"unit",7),{unit_selection:a}=ye.get(),i=re(()=>a.has(e()));var n=Me();let d;n.__pointerdown=[Ae,a,e];var p=r(n),v=r(p),m=r(v);fe(m,{get unit(){return e()}}),l(v);var k=g(v,2);{var P=o=>{var u=De();Q(u),he(u,()=>e().name,y=>e().name=y),_(o,u)},s=o=>{var u=He(),y=r(u,!0);l(u),L(()=>me(y,e().name)),_(o,u)};N(k,o=>{h(i)?o(P):o(s,!1)})}l(p),l(n),L(o=>{K(n,"id",`unit_list_item_${e().id??""}`),d=ne(n,1,"unit_list_item plain svelte-znqd6i",null,d,o)},[()=>({selected:h(i)})]),Y(3,n,()=>F),_(c,n),H()}X(["pointerdown"]);var Re=f('<div draggable="true"><!></div>'),Ne=f('<div class="drop_indicator svelte-1ukt32m"></div>'),Ve=f('<div class="reorderable_list svelte-1ukt32m"><ul class="unstyled"></ul> <!></div>');function We(c,t){D(t,!0);let e=te(null),a=te(null),i=te(null);const n=s=>{if(s.preventDefault(),h(e)===null||!s.currentTarget||!s.dataTransfer)return;const o=s.currentTarget,u=Array.from(o.children),y=u.map(w=>w.getBoundingClientRect()),j=o.getBoundingClientRect(),M=s.clientY;let x=y.findIndex(w=>M<(w.bottom+w.top)/2);if(x===-1){if(x=u.length,u.length>0){const w=y[u.length-1];A(i,w.bottom-j.top)}}else A(i,y[x].top-j.top);x>h(e)&&x--,A(a,x,!0),s.dataTransfer.dropEffect="move"},d=s=>{var o;s.preventDefault(),((o=s.dataTransfer)==null?void 0:o.dropEffect)==="move"&&h(e)!==null&&h(a)!==null&&h(e)!==h(a)&&t.on_reorder(h(e),h(a)),A(e,null),A(a,null),A(i,null)},p=s=>{if(!s.dataTransfer)return;const u=s.target.closest("[data-item]");if(!u)return;const y=parseInt(u.dataset.item??"",10);y&&(s.dataTransfer.effectAllowed="move",A(e,t.items.findIndex(j=>j.id===y),!0))};var v=Ve(),m=r(v);ce(m,22,()=>t.items,s=>s,(s,o,u)=>{var y=Re();let j;var M=r(y);ze(M,()=>t.children,()=>o),l(y),L(x=>{j=ne(y,1,"list_item svelte-1ukt32m",null,j,x),K(y,"data-item",o.id)},[()=>({dragging:h(u)===h(e)})]),_(s,y)}),l(m);var k=g(m,2);{var P=s=>{var o=Ne();let u;L(()=>u=le(o,"",u,{top:`${h(i)??""}px`})),_(s,o)};N(k,s=>{h(i)!==null&&s(P)})}l(v),ae("dragover",m,n),ae("dragend",m,d),ae("dragstart",m,p),_(c,v),H()}var Ye=f('<div class="unit_list svelte-xyjzex"><!></div>');function Fe(c,t){D(t,!0),Z(t,"scroll_on_select",3,!0)()&&ge(()=>{var d;const{latest:n}=t.project.editor.unit_selection;n&&((d=document.getElementById("unit_list_item_"+n.id))==null||d.scrollIntoView({block:"nearest"}))});var a=Ye(),i=r(a);We(i,{get items(){return t.project.scene.units},on_reorder:(d,p)=>t.project.scene.move_unit(d,p),children:(d,p=Ie)=>{be(d,{get scene(){return t.project.scene},get unit(){return p()},children:(v,m)=>{Ge(v,{get unit(){return p()}})},$$slots:{default:!0}})},$$slots:{default:!0}}),l(a),_(c,a),H()}var Je=f('<div class="unit_palette svelte-1qh4yco"><button type="button" title="add circle" class="svelte-1qh4yco">add circle ⬤</button> <button type="button" title="add polygon" class="svelte-1qh4yco">add polygon ▰</button></div>');function Ke(c,t){D(t,!0);const e=Z(t,"add_unit",3,m=>t.scene.add_unit(m));let a=0;const i=()=>{e()(new pe(t.scene,{type:"circle",x:100+Math.cos(a)*((a+10)*2),y:100+Math.sin(a)*((a+10)*2),radius:10})),a++},n=()=>{e()(new pe(t.scene,{type:"polygon",x:100+Math.cos(a)*((a+10)*2),y:100+Math.sin(a)*((a+10)*2),rotation:a*.8,points:[{x:-20,y:12},{x:30,y:-15},{x:17,y:17}]})),a++};var d=Je(),p=r(d);p.__click=i;var v=g(p,2);v.__click=n,l(d),_(c,d),H()}X(["click"]);var Qe=(c,t)=>{c.currentTarget.checked?t().add_behavior(new Be):t().remove_behavior("Player_Controller_Behavior")},Xe=(c,t)=>{c.currentTarget.checked?t().add_behavior(new qe):t().remove_behavior("Harmful_Behavior")},Ze=(c,t)=>{c.currentTarget.checked?t().add_behavior(new Le):t().remove_behavior("Goal_Behavior")},et=f('<div class="w_100 mt_lg display_flex column_gap_xl2 row_gap_sm justify_content_end flex_wrap"><label class="row mb_0" title="use WASD to move the player"><input type="checkbox"> player controls</label> <label class="row mb_0" title="causes damage to the player"><input type="checkbox"> harmful</label> <label class="row mb_0" title="the player touches this unit to win"><input type="checkbox"> goal</label> <label class="row mb_0" title="the unit is a goner"><input type="checkbox"> dead</label></div>');function tt(c,t){D(t,!0);const e=Z(t,"unit",7);var a=et(),i=r(a),n=r(i);Q(n),n.__change=[Qe,e],U(),l(i);var d=g(i,2),p=r(d);Q(p),p.__change=[Xe,e],U(),l(d);var v=g(d,2),m=r(v);Q(m),m.__change=[Ze,e],U(),l(v);var k=g(v,2),P=r(k);Q(P),U(),l(k),l(a),L((s,o,u)=>{de(n,s),de(p,o),de(m,u)},[()=>e().behaviors.has("Player_Controller_Behavior"),()=>e().behaviors.has("Harmful_Behavior"),()=>e().behaviors.has("Goal_Behavior")]),Ue(P,()=>e().dead,s=>e().dead=s),_(c,a),H()}X(["change"]);var at=(c,t,e)=>{t.unit.remove_point(e)},lt=f('<li class="row"><div class="flex_1 row justify_content_end"><!> <!></div> <button type="button" class="icon_button plain ml_md" title="remove point">✕</button></li>'),rt=f('<ul class="unstyled"></ul>');function nt(c,t){D(t,!0);const e=.5,a=re(()=>t.unit.points.length<=3);var i=rt();ce(i,22,()=>t.unit.points,n=>n,(n,d,p)=>{var v=lt(),m=r(v);le(m,"",{},{"--title_width":"3.4rem"});var k=r(m);E(k,{get title(){return`polygon.points[${h(p)??""}].x`},classes:"mb_0",input_classes:"plain",row:!0,get value(){return d.x},oninput:o=>{d.x=o,t.unit.update_points()},step:e,children:(o,u)=>{U();var y=C("x");_(o,y)},$$slots:{default:!0}});var P=g(k,2);E(P,{get title(){return`polygon.points[${h(p)??""}].y`},classes:"mb_0",input_classes:"plain",row:!0,get value(){return d.y},oninput:o=>{d.y=o,t.unit.update_points()},step:e,children:(o,u)=>{U();var y=C("y");_(o,y)},$$slots:{default:!0}}),l(m);var s=g(m,2);s.__pointerup=[at,t,d],l(v),L(()=>s.disabled=h(a)),Y(3,v,()=>F),_(n,v)}),l(i),_(c,i),H()}X(["pointerup"]);const it=(c,t,e)=>{t.has(e())?t.delete(e()):t.add(e())};var st=(c,t,e)=>t.set(e()),ot=f('<div class="input_row svelte-1aiviy3"><!> <!></div> <div class="input_row svelte-1aiviy3"><!></div> <div class="input_row svelte-1aiviy3"><!></div>',1),dt=(c,t)=>{t().add_point(new Se(120,200))},ct=f('<div class="input_row svelte-1aiviy3"><!> <!></div> <div class="input_row svelte-1aiviy3"><!></div> <div class="input_row mb_md svelte-1aiviy3"><!></div> <!> <button type="button" title="add a point to this polygon" class="plain justify_self_end">add point ◎</button>',1),_t=f('<div><div class="py_sm"><button type="button" class="inline color_g selected white_space_nowrap" title="this polygon intersects itself - collision detection is disabled">self-intersecting</button></div></div>'),vt=(c,t)=>{alert(`TODO automatically decompose the concave polygon into ${t().decomped.length} convex ones, need to support multiple bodies per unit`)},ut=f('<div><div class="py_sm"><button type="button" class="inline color_d selected deselectable white_space_nowrap">concave</button></div></div>'),pt=f('<div class="row gap_sm"><!> <!></div>'),gt=f('<div><div class="row pb_sm pt_md"><div class="pr_md text_align_right font_weight_600 input_width_sm">id</div> <small> </small></div> <!> <!> <!></div>'),mt=f('<li role="none"><header class="row gap_xs2 svelte-1aiviy3"><div class="unit_layer_type svelte-1aiviy3"><button type="button" class="plain"><div class="row"><div class="chevron svelte-1aiviy3"></div> <!></div></button></div> <input class="name_input plain svelte-1aiviy3" placeholder="name"></header> <!></li>');function yt(c,t){D(t,!0);const e=Z(t,"unit",7),{unit_selection:a,collapsed_layers:i}=ye.get(),n=re(()=>i.has(e())),d=.5,p=.1;var v=mt();let m;v.__pointerdown=[st,a,e];var k=r(v),P=r(k),s=r(P);s.__click=[it,i,e];var o=r(s),u=g(r(o),2);fe(u,{get unit(){return e()}}),l(o),l(s),l(P);var y=g(P,2);Q(y),l(k);var j=g(k,2);{var M=x=>{var w=gt(),ee=r(w),se=g(r(ee),2);le(se,"",{},{padding:"var(--input_padding_y) var(--input_padding_x)"});var xe=r(se,!0);l(se),l(ee);var _e=g(ee,2);{var we=S=>{var G=ot(),$=ie(G);le($,"",{},{"--title_width":"3.4rem"});var R=r($);E(R,{title:"circle x",input_classes:"plain",row:!0,step:d,get value(){return e().x},set value(b){e().x=b},children:(b,V)=>{U();var O=C("x");_(b,O)},$$slots:{default:!0}});var J=g(R,2);E(J,{title:"circle y",input_classes:"plain",row:!0,step:d,get value(){return e().y},set value(b){e().y=b},children:(b,V)=>{U();var O=C("y");_(b,O)},$$slots:{default:!0}}),l($);var z=g($,2),B=r(z);E(B,{title:"circle scale",input_classes:"plain",row:!0,step:.01,get value(){return e().scale},set value(b){e().scale=b},children:(b,V)=>{U();var O=C("scale");_(b,O)},$$slots:{default:!0}}),l(z);var I=g(z,2),q=r(I);E(q,{title:"circle radius",input_classes:"plain",row:!0,min:0,step:p,get value(){return e().radius},set value(b){e().radius=b},children:(b,V)=>{U();var O=C("radius");_(b,O)},$$slots:{default:!0}}),l(I),_(S,G)},ke=(S,G)=>{{var $=R=>{var J=ct(),z=ie(J);le(z,"",{},{"--title_width":"3.4rem"});var B=r(z);E(B,{title:"polygon x",input_classes:"plain",row:!0,step:d,get value(){return e().x},set value(T){e().x=T},children:(T,oe)=>{U();var W=C("x");_(T,W)},$$slots:{default:!0}});var I=g(B,2);E(I,{title:"polygon y",input_classes:"plain",row:!0,step:d,get value(){return e().y},set value(T){e().y=T},children:(T,oe)=>{U();var W=C("y");_(T,W)},$$slots:{default:!0}}),l(z);var q=g(z,2),b=r(q);E(b,{title:"polygon rotation",input_classes:"plain",row:!0,step:Math.PI/360,get value(){return e().rotation},set value(T){e().rotation=T},children:(T,oe)=>{U();var W=C("rotation");_(T,W)},$$slots:{default:!0}}),l(q);var V=g(q,2),O=r(V);E(O,{title:"polygon scale",input_classes:"plain",row:!0,step:.01,get value(){return e().scale},set value(T){e().scale=T},children:(T,oe)=>{U();var W=C("scale");_(T,W)},$$slots:{default:!0}}),l(V);var ue=g(V,2);nt(ue,{get unit(){return e()}});var je=g(ue,2);je.__click=[dt,e],_(R,J)};N(S,R=>{e().type==="polygon"&&R($)},G)}};N(_e,S=>{e().type==="circle"?S(we):S(ke,!1)})}var ve=g(_e,2);{var Pe=S=>{var G=pt(),$=r(G);{var R=B=>{var I=_t(),q=r(I);l(I),Y(3,q,()=>F),Y(3,I,()=>F,()=>({axis:"x"})),_(B,I)};N($,B=>{e().is_simple_polygon||B(R)})}var J=g($,2);{var z=B=>{var I=ut(),q=r(I),b=r(q);b.__click=[vt,e],l(q),l(I),L(()=>K(b,"title",`this polygon is concave, and can be decomposed into ${e().decomped.length??""} convex polygons`)),Y(3,q,()=>F),Y(3,I,()=>F,()=>({axis:"x"})),_(B,I)};N(J,B=>{e().concave&&B(z)})}l(G),_(S,G)};N(ve,S=>{e().type==="polygon"&&S(Pe)})}var Te=g(ve,2);tt(Te,{get unit(){return e()}}),l(w),L(()=>me(xe,e().id)),Y(3,w,()=>F),_(x,w)};N(j,x=>{h(n)||x(M)})}l(v),L(x=>{m=ne(v,1,"unit_layer svelte-1aiviy3",null,m,x),K(v,"id",`unit_layer_${e().id??""}`),K(s,"title",e().type),K(y,"title",`${e().type??""} name`)},[()=>({collapsed:h(n),selected:a.has(e())})]),he(y,()=>e().name,x=>e().name=x),_(c,v),H()}X(["pointerdown","click"]);var ht=f('<ul class="unit_layers unstyled"></ul>');function ft(c,t){D(t,!0),Z(t,"scroll_on_select",3,!0)()&&ge(()=>{var n;const{latest:i}=t.project.editor.unit_selection;i&&((n=document.getElementById("unit_layer_"+i.id))==null||n.scrollIntoView({block:"nearest"}))});var a=ht();ce(a,21,()=>t.project.scene.units,i=>i.id,(i,n)=>{be(i,{get scene(){return t.project.scene},get unit(){return h(n)},children:(d,p)=>{yt(d,{get unit(){return h(n)}})},$$slots:{default:!0}})}),l(a),_(c,a),H()}var bt=f('<div><div class="column_panel svelte-1gu2qm4"><!></div> <div class="p_lg"><!></div></div> <div class="column svelte-1gu2qm4"><div class="unit_layers_controls svelte-1gu2qm4"><!></div> <div><!></div></div>',1);function qt(c,t){const e=re(()=>t.project.scene),a=re(()=>t.project.editor);let i=te(0),n=te(0);var d=bt(),p=ie(d);let v;var m=r(p),k=r(m);Fe(k,{get project(){return t.project}}),l(m);var P=g(m,2),s=r(P);Ke(s,{get scene(){return h(e)}}),l(P),l(p);var o=g(p,2),u=r(o),y=r(u);Oe(y,{get editor(){return h(a)}}),l(u);var j=g(u,2);let M;var x=r(j);ft(x,{get project(){return t.project}}),l(j),l(o),L((w,ee)=>{v=ne(p,1,"column svelte-1gu2qm4",null,v,w),M=ne(j,1,"column_panel svelte-1gu2qm4",null,M,ee)},[()=>({scrolled:h(i)>0}),()=>({scrolled:h(n)>0})]),ae("scroll",p,w=>{A(i,w.currentTarget.scrollTop,!0)}),ae("scroll",j,w=>{A(n,w.currentTarget.scrollTop,!0)}),_(c,d)}export{qt as U,Oe as a};
