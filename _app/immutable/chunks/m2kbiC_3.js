import{t as b,a as _,b as C}from"./BPmIRx6_.js";import{p as D,f as se,s as g,t as S,a as H,c as r,r as l,w as h,x as re,ah as te,_ as A,u as ge,I as Ie,n as U}from"./DaTzegC-.js";import{d as X,s as fe,k as ae}from"./DS-o1SaK.js";import{s as K,c as ne,r as Q,b as ce,g as le,h as de}from"./BhfeDiRc.js";import{p as Z,i as N}from"./BkMa5g5G.js";import{t as Y,s as F}from"./BOEMmhCy.js";import{e as me,g as he,U as pe,k as Ue,l as Be,H as Le,G as Se,m as qe}from"./CV03ftH4.js";import{U as be,d as ye,c as E}from"./Bg_v1Gnp.js";import{s as ze}from"./DKcoP1oN.js";var Ce=(c,t)=>{t.editor.collapsed_layers.clear()},Ee=(c,t,e)=>{for(const a of t.units)e.editor.collapsed_layers.add(a)},$e=b('<button type="button" class="plain">expand all</button> <button type="button" class="plain">collapse all</button>',1);function Oe(c,t){D(t,!0);const{scene:e}=t.editor.project;var a=$e(),s=se(a);s.__click=[Ce,t];var n=g(s,2);n.__click=[Ee,e,t],S(()=>{s.disabled=!t.editor.collapsed_layers.size,n.disabled=t.editor.collapsed_layers.size===e.units.length}),_(c,a),H()}X(["click"]);var Ae=(c,t,e)=>t.set(e()),De=b('<input class="unit_name plain svelte-znqd6i" placeholder="name">'),He=b('<div class="unit_name svelte-znqd6i"> </div>'),Me=b('<li role="none"><label class="flex_1 row mb_0 pr_lg"><div class="unit_type svelte-znqd6i"><!></div> <!></label></li>');function Ge(c,t){D(t,!0);const e=Z(t,"unit",7),{unit_selection:a}=me.get(),s=re(()=>a.has(e()));var n=Me();let d;n.__pointerdown=[Ae,a,e];var p=r(n),v=r(p),f=r(v);be(f,{get unit(){return e()}}),l(v);var k=g(v,2);{var P=o=>{var u=De();Q(u),he(u,()=>e().name,m=>e().name=m),_(o,u)},i=o=>{var u=He(),m=r(u,!0);l(u),S(()=>fe(m,e().name)),_(o,u)};N(k,o=>{h(s)?o(P):o(i,!1)})}l(p),l(n),S(o=>{K(n,"id",`unit_list_item_${e().id??""}`),d=ne(n,1,"unit_list_item plain svelte-znqd6i",null,d,o)},[()=>({selected:h(s)})]),Y(3,n,()=>F),_(c,n),H()}X(["pointerdown"]);var Re=b('<div draggable="true"><!></div>'),Ne=b('<div class="drop_indicator svelte-1ukt32m"></div>'),Ve=b('<div class="reorderable_list svelte-1ukt32m"><ul class="unstyled"></ul> <!></div>');function We(c,t){D(t,!0);let e=te(null),a=te(null),s=te(null);const n=i=>{if(i.preventDefault(),h(e)===null||!i.currentTarget||!i.dataTransfer)return;const o=i.currentTarget,u=Array.from(o.children),m=u.map(w=>w.getBoundingClientRect()),j=o.getBoundingClientRect(),M=i.clientY;let x=m.findIndex(w=>M<(w.bottom+w.top)/2);if(x===-1){if(x=u.length,u.length>0){const w=m[u.length-1];A(s,w.bottom-j.top)}}else A(s,m[x].top-j.top);x>h(e)&&x--,A(a,x,!0),i.dataTransfer.dropEffect="move"},d=i=>{var o;i.preventDefault(),((o=i.dataTransfer)==null?void 0:o.dropEffect)==="move"&&h(e)!==null&&h(a)!==null&&h(e)!==h(a)&&t.on_reorder(h(e),h(a)),A(e,null),A(a,null),A(s,null)},p=i=>{if(!i.dataTransfer)return;const u=i.target.closest("[data-item]");if(!u)return;const m=parseInt(u.dataset.item??"",10);m&&(i.dataTransfer.effectAllowed="move",A(e,t.items.findIndex(j=>j.id===m),!0))};var v=Ve(),f=r(v);ce(f,22,()=>t.items,i=>i,(i,o,u)=>{var m=Re();let j;var M=r(m);ze(M,()=>t.children,()=>o),l(m),S(x=>{j=ne(m,1,"list_item svelte-1ukt32m",null,j,x),K(m,"data-item",o.id)},[()=>({dragging:h(u)===h(e)})]),_(i,m)}),l(f);var k=g(f,2);{var P=i=>{var o=Ne();let u;S(()=>u=le(o,"",u,{top:`${h(s)??""}px`})),_(i,o)};N(k,i=>{h(s)!==null&&i(P)})}l(v),ae("dragover",f,n),ae("dragend",f,d),ae("dragstart",f,p),_(c,v),H()}var Ye=b('<div class="unit_list svelte-xyjzex"><!></div>');function Fe(c,t){D(t,!0),Z(t,"scroll_on_select",3,!0)()&&ge(()=>{var d;const{latest:n}=t.project.editor.unit_selection;n&&((d=document.getElementById("unit_list_item_"+n.id))==null||d.scrollIntoView({block:"nearest"}))});var a=Ye(),s=r(a);We(s,{get items(){return t.project.scene.units},on_reorder:(d,p)=>t.project.scene.move_unit(d,p),children:(d,p=Ie)=>{ye(d,{get scene(){return t.project.scene},get unit(){return p()},children:(v,f)=>{Ge(v,{get unit(){return p()}})},$$slots:{default:!0}})},$$slots:{default:!0}}),l(a),_(c,a),H()}var Je=b('<div class="unit_palette svelte-1qh4yco"><button type="button" title="add circle" class="svelte-1qh4yco">add circle ⬤</button> <button type="button" title="add polygon" class="svelte-1qh4yco">add polygon ▰</button></div>');function Ke(c,t){D(t,!0);const e=Z(t,"add_unit",3,f=>t.scene.add_unit(f));let a=0;const s=()=>{e()(new pe(t.scene,{type:"circle",x:100+Math.cos(a)*((a+10)*2),y:100+Math.sin(a)*((a+10)*2),radius:10})),a++},n=()=>{e()(new pe(t.scene,{type:"polygon",x:100+Math.cos(a)*((a+10)*2),y:100+Math.sin(a)*((a+10)*2),rotation:a*.8,points:[{x:-20,y:12},{x:30,y:-15},{x:17,y:17}]})),a++};var d=Je(),p=r(d);p.__click=s;var v=g(p,2);v.__click=n,l(d),_(c,d),H()}X(["click"]);var Qe=(c,t)=>{c.currentTarget.checked?t().add_behavior(new Be):t().remove_behavior("Player_Controller_Behavior")},Xe=(c,t)=>{c.currentTarget.checked?t().add_behavior(new Le):t().remove_behavior("Harmful_Behavior")},Ze=(c,t)=>{c.currentTarget.checked?t().add_behavior(new Se):t().remove_behavior("Goal_Behavior")},et=b('<div class="w_100 mt_lg flex column_gap_xl2 row_gap_sm justify_content_end flex_wrap"><label class="row mb_0" title="use WASD to move the player"><input type="checkbox"> player controls</label> <label class="row mb_0" title="causes damage to the player"><input type="checkbox"> harmful</label> <label class="row mb_0" title="the player touches this unit to win"><input type="checkbox"> goal</label> <label class="row mb_0" title="the unit is a goner"><input type="checkbox"> dead</label></div>');function tt(c,t){D(t,!0);const e=Z(t,"unit",7);var a=et(),s=r(a),n=r(s);Q(n),n.__change=[Qe,e],U(),l(s);var d=g(s,2),p=r(d);Q(p),p.__change=[Xe,e],U(),l(d);var v=g(d,2),f=r(v);Q(f),f.__change=[Ze,e],U(),l(v);var k=g(v,2),P=r(k);Q(P),U(),l(k),l(a),S((i,o,u)=>{de(n,i),de(p,o),de(f,u)},[()=>e().behaviors.has("Player_Controller_Behavior"),()=>e().behaviors.has("Harmful_Behavior"),()=>e().behaviors.has("Goal_Behavior")]),Ue(P,()=>e().dead,i=>e().dead=i),_(c,a),H()}X(["change"]);var at=(c,t,e)=>{t.unit.remove_point(e)},lt=b('<li class="row"><div class="flex_1 row justify_content_end"><!> <!></div> <button type="button" class="icon_button plain ml_md" title="remove point">✕</button></li>'),rt=b('<ul class="unstyled"></ul>');function nt(c,t){D(t,!0);const e=.5,a=re(()=>t.unit.points.length<=3);var s=rt();ce(s,22,()=>t.unit.points,n=>n,(n,d,p)=>{var v=lt(),f=r(v);le(f,"",{},{"--title_width":"3.4rem"});var k=r(f);E(k,{get title(){return`polygon.points[${h(p)??""}].x`},classes:"mb_0",input_classes:"plain",row:!0,get value(){return d.x},oninput:o=>{d.x=o,t.unit.update_points()},step:e,children:(o,u)=>{U();var m=C("x");_(o,m)},$$slots:{default:!0}});var P=g(k,2);E(P,{get title(){return`polygon.points[${h(p)??""}].y`},classes:"mb_0",input_classes:"plain",row:!0,get value(){return d.y},oninput:o=>{d.y=o,t.unit.update_points()},step:e,children:(o,u)=>{U();var m=C("y");_(o,m)},$$slots:{default:!0}}),l(f);var i=g(f,2);i.__pointerup=[at,t,d],l(v),S(()=>i.disabled=h(a)),Y(3,v,()=>F),_(n,v)}),l(s),_(c,s),H()}X(["pointerup"]);const st=(c,t,e)=>{t.has(e())?t.delete(e()):t.add(e())};var it=(c,t,e)=>t.set(e()),ot=b('<div class="input_row svelte-ffu65v"><!> <!></div> <div class="input_row svelte-ffu65v"><!></div> <div class="input_row svelte-ffu65v"><!></div>',1),dt=(c,t)=>{t().add_point(new qe(120,200))},ct=b('<div class="input_row svelte-ffu65v"><!> <!></div> <div class="input_row svelte-ffu65v"><!></div> <div class="input_row mb_md svelte-ffu65v"><!></div> <!> <button type="button" title="add a point to this polygon" class="plain justify_self_end">add point ◎</button>',1),_t=b('<div><div class="py_sm"><button type="button" class="inline color_g selected white_space_nowrap" title="this polygon intersects itself - collision detection is disabled">self-intersecting</button></div></div>'),vt=(c,t)=>{alert(`TODO automatically decompose the concave polygon into ${t().decomped.length} convex ones, need to support multiple bodies per unit`)},ut=b('<div><div class="py_sm"><button type="button" class="inline color_d selected deselectable white_space_nowrap">concave</button></div></div>'),pt=b('<div class="row gap_sm"><!> <!></div>'),gt=b('<div><div class="row pb_sm pt_md"><div class="pr_md text_align_right font_weight_600 input_width_sm">id</div> <small> </small></div> <!> <!> <!></div>'),ft=b('<li role="none"><header class="row gap_xs2 svelte-ffu65v"><div class="unit_layer_type svelte-ffu65v"><button type="button" class="plain"><div class="row"><div class="chevron svelte-ffu65v"></div> <!></div></button></div> <input class="name_input plain svelte-ffu65v" placeholder="name"></header> <!></li>');function mt(c,t){D(t,!0);const e=Z(t,"unit",7),{unit_selection:a,collapsed_layers:s}=me.get(),n=re(()=>s.has(e())),d=.5,p=.1;var v=ft();let f;v.__pointerdown=[it,a,e];var k=r(v),P=r(k),i=r(P);i.__click=[st,s,e];var o=r(i),u=g(r(o),2);be(u,{get unit(){return e()}}),l(o),l(i),l(P);var m=g(P,2);Q(m),l(k);var j=g(k,2);{var M=x=>{var w=gt(),ee=r(w),ie=g(r(ee),2);le(ie,"",{},{padding:"var(--input_padding_y) var(--input_padding_x)"});var xe=r(ie,!0);l(ie),l(ee);var _e=g(ee,2);{var we=q=>{var G=ot(),$=se(G);le($,"",{},{"--title_width":"3.4rem"});var R=r($);E(R,{title:"circle x",input_classes:"plain",row:!0,step:d,get value(){return e().x},set value(y){e().x=y},children:(y,V)=>{U();var O=C("x");_(y,O)},$$slots:{default:!0}});var J=g(R,2);E(J,{title:"circle y",input_classes:"plain",row:!0,step:d,get value(){return e().y},set value(y){e().y=y},children:(y,V)=>{U();var O=C("y");_(y,O)},$$slots:{default:!0}}),l($);var z=g($,2),B=r(z);E(B,{title:"circle scale",input_classes:"plain",row:!0,step:.01,get value(){return e().scale},set value(y){e().scale=y},children:(y,V)=>{U();var O=C("scale");_(y,O)},$$slots:{default:!0}}),l(z);var I=g(z,2),L=r(I);E(L,{title:"circle radius",input_classes:"plain",row:!0,min:0,step:p,get value(){return e().radius},set value(y){e().radius=y},children:(y,V)=>{U();var O=C("radius");_(y,O)},$$slots:{default:!0}}),l(I),_(q,G)},ke=(q,G)=>{{var $=R=>{var J=ct(),z=se(J);le(z,"",{},{"--title_width":"3.4rem"});var B=r(z);E(B,{title:"polygon x",input_classes:"plain",row:!0,step:d,get value(){return e().x},set value(T){e().x=T},children:(T,oe)=>{U();var W=C("x");_(T,W)},$$slots:{default:!0}});var I=g(B,2);E(I,{title:"polygon y",input_classes:"plain",row:!0,step:d,get value(){return e().y},set value(T){e().y=T},children:(T,oe)=>{U();var W=C("y");_(T,W)},$$slots:{default:!0}}),l(z);var L=g(z,2),y=r(L);E(y,{title:"polygon rotation",input_classes:"plain",row:!0,step:Math.PI/360,get value(){return e().rotation},set value(T){e().rotation=T},children:(T,oe)=>{U();var W=C("rotation");_(T,W)},$$slots:{default:!0}}),l(L);var V=g(L,2),O=r(V);E(O,{title:"polygon scale",input_classes:"plain",row:!0,step:.01,get value(){return e().scale},set value(T){e().scale=T},children:(T,oe)=>{U();var W=C("scale");_(T,W)},$$slots:{default:!0}}),l(V);var ue=g(V,2);nt(ue,{get unit(){return e()}});var je=g(ue,2);je.__click=[dt,e],_(R,J)};N(q,R=>{e().type==="polygon"&&R($)},G)}};N(_e,q=>{e().type==="circle"?q(we):q(ke,!1)})}var ve=g(_e,2);{var Pe=q=>{var G=pt(),$=r(G);{var R=B=>{var I=_t(),L=r(I);l(I),Y(3,L,()=>F),Y(3,I,()=>F,()=>({axis:"x"})),_(B,I)};N($,B=>{e().is_simple_polygon||B(R)})}var J=g($,2);{var z=B=>{var I=ut(),L=r(I),y=r(L);y.__click=[vt,e],l(L),l(I),S(()=>K(y,"title",`this polygon is concave, and can be decomposed into ${e().decomped.length??""} convex polygons`)),Y(3,L,()=>F),Y(3,I,()=>F,()=>({axis:"x"})),_(B,I)};N(J,B=>{e().concave&&B(z)})}l(G),_(q,G)};N(ve,q=>{e().type==="polygon"&&q(Pe)})}var Te=g(ve,2);tt(Te,{get unit(){return e()}}),l(w),S(()=>fe(xe,e().id)),Y(3,w,()=>F),_(x,w)};N(j,x=>{h(n)||x(M)})}l(v),S(x=>{f=ne(v,1,"unit_layer svelte-ffu65v",null,f,x),K(v,"id",`unit_layer_${e().id??""}`),K(i,"title",e().type),K(m,"title",`${e().type??""} name`)},[()=>({collapsed:h(n),selected:a.has(e())})]),he(m,()=>e().name,x=>e().name=x),_(c,v),H()}X(["pointerdown","click"]);var ht=b('<ul class="unit_layers unstyled"></ul>');function bt(c,t){D(t,!0),Z(t,"scroll_on_select",3,!0)()&&ge(()=>{var n;const{latest:s}=t.project.editor.unit_selection;s&&((n=document.getElementById("unit_layer_"+s.id))==null||n.scrollIntoView({block:"nearest"}))});var a=ht();ce(a,21,()=>t.project.scene.units,s=>s.id,(s,n)=>{ye(s,{get scene(){return t.project.scene},get unit(){return h(n)},children:(d,p)=>{mt(d,{get unit(){return h(n)}})},$$slots:{default:!0}})}),l(a),_(c,a),H()}var yt=b('<div><div class="column_panel svelte-175igsh"><!></div> <div class="p_lg"><!></div></div> <div class="column svelte-175igsh"><div class="unit_layers_controls svelte-175igsh"><!></div> <div><!></div></div>',1);function Lt(c,t){const e=re(()=>t.project.scene),a=re(()=>t.project.editor);let s=te(0),n=te(0);var d=yt(),p=se(d);let v;var f=r(p),k=r(f);Fe(k,{get project(){return t.project}}),l(f);var P=g(f,2),i=r(P);Ke(i,{get scene(){return h(e)}}),l(P),l(p);var o=g(p,2),u=r(o),m=r(u);Oe(m,{get editor(){return h(a)}}),l(u);var j=g(u,2);let M;var x=r(j);bt(x,{get project(){return t.project}}),l(j),l(o),S((w,ee)=>{v=ne(p,1,"column svelte-175igsh",null,v,w),M=ne(j,1,"column_panel svelte-175igsh",null,M,ee)},[()=>({scrolled:h(s)>0}),()=>({scrolled:h(n)>0})]),ae("scroll",p,w=>{A(s,w.currentTarget.scrollTop,!0)}),ae("scroll",j,w=>{A(n,w.currentTarget.scrollTop,!0)}),_(c,d)}export{Lt as U,Oe as a};
