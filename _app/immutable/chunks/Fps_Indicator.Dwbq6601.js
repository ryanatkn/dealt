var Bt=Object.defineProperty;var St=o=>{throw TypeError(o)};var Rt=(o,t,n)=>t in o?Bt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n;var It=(o,t,n)=>Rt(o,typeof t!="symbol"?t+"":t,n),Mt=(o,t,n)=>t.has(o)||St("Cannot "+n);var F=(o,t,n)=>(Mt(o,t,"read from private field"),n?n.call(o):t.get(o)),dt=(o,t,n)=>t.has(o)?St("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(o):t.set(o,n),xt=(o,t,n,l)=>(Mt(o,t,"write to private field"),l?l.call(o,n):t.set(o,n),n);import{a as X,t as O,n as et,c as rt,b as ot}from"./disclose-version.hpen2EY6.js";import{aJ as Vt,K as e,q as Dt,k as Et,a1 as Ft,a4 as Zt,f as Z,t as N,m as G,o as Q,L as C,c as j,s as B,D as Pt,r as W,n as lt,a0 as w,u as Xt,W as i,aI as A}from"./runtime.BxixJYQn.js";import{d as ut,o as Kt,k as T,s as vt}from"./render.CII73B8B.js";import{i as V,p as L,c as _}from"./props.DCp65xQH.js";import{s as at}from"./snippet.ODdKu9lL.js";import{b as $,r as Ht,t as D,s as H,g as Jt,a as Lt,e as zt}from"./string.Bu0lHRZq.js";import{t as Ot,s as Gt}from"./index.olKXB50G.js";import{ap as Qt,e as $t,P as te,u as ee,Z as ne,I as nt,aq as wt,ar as ie,as as le,at as oe,au as Ct,y as se,A as Yt,B as re,Y as ae,z as mt,av as ue,c as ce}from"./renderer_components.Br8110jH.js";import{c as de}from"./svelte-component.Cj2KZ242.js";import{b as _e}from"./preload-helper.CYsmXywa.js";function ve(o){let t=0,n=Zt(0),l;return()=>{Vt()&&(e(n),Dt(()=>(t===0&&(l=Et(()=>o(()=>Qt(n)))),t+=1,()=>{Ft().then(()=>{t-=1,t===0&&(l==null||l(),l=void 0)})})))}}var ht,gt;class Ut{constructor(t,n){dt(this,ht);dt(this,gt);xt(this,ht,t),xt(this,gt,ve(n))}get current(){return F(this,gt).call(this),F(this,ht).call(this)}}ht=new WeakMap,gt=new WeakMap;var he=(o,t)=>e(t).reset(),ge=O('<fieldset><label class="row pt_xs"><input type="checkbox"> show bounding volume hierarchy</label></fieldset>'),fe=O('<div class="scene_controls svelte-1l7n56e"><button type="button" title="toggle the clock [Spacebar]"><div class="pr_sm">clock</div> <!></button> <button type="button" title="reset the scene [r]" class="plain">reset</button> <button type="button" class="plain deselectable">edit</button> <!></div> <!>',1);function wn(o,t){Q(t,!0);const n=C(()=>t.project.renderer),l=C(()=>t.project.scene),g=C(()=>e(l).clock),u=$t.get();var s=fe(),v=Z(s),c=j(v);c.__click=function(...p){var h;(h=e(g).toggle)==null||h.apply(this,p)},$(c,"min-width","105px");var d=B(j(c),2);te(d,{get running(){return e(g).running}}),W(c);var y=B(c,2);y.__click=[he,l];var k=B(y,2);k.__click=()=>u.editing=!u.editing;var x=B(k,2);at(x,()=>t.children??Pt),W(v);var I=B(v,2);{var S=p=>{var h=ge(),M=j(h),f=j(M);Ht(f),lt(),W(M),W(h),ee(f,()=>e(n).show_bvh,E=>e(n).show_bvh=E),Ot(3,h,()=>Gt),X(p,h)};V(I,p=>{e(n).type==="canvas"&&p(S)})}N(()=>{D(c,"color_d",e(g).running),H(k,"title",`${(u.editing?"stop editing":"start editing")??""} [~ Shift+Backtick]`),D(k,"color_d",u.editing)}),X(o,s),G()}ut(["click"]);const ye=new Ut(()=>window.innerWidth,o=>Kt(window,"resize",o)),me=new Ut(()=>window.innerHeight,o=>Kt(window,"resize",o));var we=et('<line class="svelte-1v33fyc"></line>'),xe=et('<svg class="scrubbing_indicator svelte-1v33fyc" aria-hidden="true"><!></svg>');function yt(o,t){Q(t,!0);const n=C(()=>t.container_width??ye.current),l=C(()=>t.container_height??me.current);ne(o,{to:document.body,children:(g,u)=>{var s=xe(),v=j(s);{var c=d=>{var y=we();N(()=>{H(y,"x1",t.x_start),H(y,"y1",t.y_start),H(y,"x2",t.x_last),H(y,"y2",t.y_last)}),X(d,y)};V(v,d=>{t.x_start!==null&&t.y_start!==null&&t.x_last!==null&&t.y_last!==null&&d(c)})}W(s),N(()=>{H(s,"viewBox",`0 0 ${e(n)??""} ${e(l)??""}`),H(s,"width",e(n)),H(s,"height",e(l))}),X(g,s)},$$slots:{default:!0}}),G()}const pe=(o,t)=>{o.ctrlKey||t(o.clientX,o.clientY)};var be=O('<div class="title svelte-1emv8hj"><!></div>'),ke=O('<label role="slider"><!> <input></label> <!>',1);function xn(o,t){Q(t,!0);let n=L(t,"value",15,0),l=L(t,"type",3,"text"),g=L(t,"inputmode",3,"numeric"),u=L(t,"step",3,1),s=L(t,"min",19,()=>1/0*-1),v=L(t,"row",3,!1),c=w(_(n())),d=w(_(n().toString()));const y=K=>{var U;i(c,_(K)),n(Math.max(s(),K)),i(d,_(n().toString())),(U=t.oninput)==null||U.call(t,n())};Xt(()=>{n()!==Et(()=>e(c))&&(i(c,_(n())),i(d,_(n().toString())))});const k=K=>{i(d,_(K));const U=parseFloat(K);Number.isNaN(U)||y(U)},x=K=>{y(e(c)+K)};let I=w(!1),S=w(null),p=w(null),h=w(null),M=w(null),f=w(null),E=w(null),b=w(null);const m=C(()=>e(E)===null||e(M)===null?null:e(E)-e(M)),Y=C(()=>e(b)===null||e(f)===null?null:e(f)-e(b)),z=C(()=>e(m)===null||e(Y)===null?null:(e(m)+e(Y))*u()),P=(K,U)=>{e(I)||(i(I,!0),i(S,_(n())),i(p,_(K)),i(h,_(U)),i(M,_(K)),i(f,_(U)))},q=()=>{i(I,!1),i(S,null),i(p,null),i(h,null),i(M,null),i(f,null),i(E,null),i(b,null)},J=(K,U)=>{i(M,_(e(E))),i(f,_(e(b))),i(E,_(K)),i(b,_(U)),e(z)!==null&&x(e(z))},r=K=>{q()},a=K=>{q()},R=K=>{J(K.clientX,K.clientY)},_t=K=>{K.key==="Escape"&&(y(e(S)),q(),nt(K))};var ct=ke();T("pointerup",A,function(...K){var U;(U=e(I)?r:void 0)==null||U.apply(this,K)}),T("pointermove",A,function(...K){var U;(U=e(I)?R:void 0)==null||U.apply(this,K)}),T("pointerleave",A,function(...K){var U;(U=e(I)?a:void 0)==null||U.apply(this,K)}),T("keydown",A,function(...K){var U;(U=e(I)?_t:void 0)==null||U.apply(this,K)},!0);var it=Z(ct);it.__pointerdown=[pe,P];var pt=j(it);{var qt=K=>{var U=be(),At=j(U);at(At,()=>t.children),W(U),X(K,U)};V(pt,K=>{t.children&&K(qt)})}var bt=B(pt,2);Ht(bt);var Nt=K=>k(K.currentTarget.value);let kt;W(it);var jt=B(it,2);{var Wt=K=>{yt(K,{get x_start(){return e(p)},get y_start(){return e(h)},get x_last(){return e(M)},get y_last(){return e(f)},container_width:innerWidth,container_height:innerHeight})};V(jt,K=>{e(I)&&K(Wt)})}N(()=>{Jt(it,`${t.classes??""} svelte-1emv8hj`),H(it,"aria-valuenow",e(z)),H(it,"title",t.title),D(it,"selected",e(I)),D(it,"row",v()),kt=Lt(bt,kt,{...t.attrs,class:t.input_classes,value:e(d),oninput:Nt,type:l(),inputmode:g(),step:u(),min:s(),max:t.max},"svelte-1emv8hj")}),X(o,ct),G()}ut(["pointerdown"]);var Se=O('<div class="scene_renderer svelte-1hiky75"><!></div>');function pn(o,t){Q(t,!0);var n=Se(),l=j(n);{var g=u=>{var s=rt(),v=Z(s);de(v,()=>t.Component,(c,d)=>{d(c,{get scene(){return t.scene},get renderer(){return t.renderer}})}),X(u,s)};V(l,u=>{u(g)})}W(n),N(()=>{$(n,"width",`${t.renderer.width??""}px`),$(n,"height",`${t.renderer.height??""}px`),$(n,"min-width",`${t.renderer.width??""}px`),$(n,"min-height",`${t.renderer.height??""}px`)}),X(o,n),G()}const Ie=(o,t)=>{t(o.clientX,o.clientY),nt(o)};var Me=et('<polygon role="none" class="unit_circle_radius_handles svelte-1i5of7p" fill="var(--color_selected)"></polygon><!>',1);function Ye(o,t){Q(t,!0);const n=L(t,"unit",7),l=L(t,"size",3,wt),g=.5;let u=w(!1),s=w(null),v=w(null),c=w(null),d=w(null),y=w(null),k=w(null),x=w(null);const I=C(()=>n().x),S=C(()=>n().y-Math.max(l(),n().radius*Math.abs(n().scale))),p=C(()=>l()/2),h=(r,a)=>{e(u)||(i(u,!0),i(s,_(n().radius)),i(v,_(r)),i(c,_(a)),i(d,_(r)),i(y,_(a)))},M=()=>{i(u,!1),i(s,null),i(v,null),i(c,null),i(d,null),i(y,null),i(k,null),i(x,null)},f=(r,a)=>{i(d,_(e(k))),i(y,_(e(x))),i(k,_(r)),i(x,_(a)),e(d)!==null&&e(y)!==null&&(n().radius=ie(e(s)+g*(e(k)-e(v)-(e(x)-e(c)))))},E=r=>{M()},b=r=>{M()},m=r=>{f(r.clientX,r.clientY)},Y=r=>{r.key==="Escape"&&(n().radius=e(s),M(),nt(r))};var z=Me();T("pointerup",A,function(...r){var a;(a=e(u)?E:void 0)==null||a.apply(this,r)}),T("pointermove",A,function(...r){var a;(a=e(u)?m:void 0)==null||a.apply(this,r)}),T("pointerleave",A,function(...r){var a;(a=e(u)?b:void 0)==null||a.apply(this,r)}),T("keydown",A,function(...r){var a;(a=e(u)?Y:void 0)==null||a.apply(this,r)},!0);var P=Z(z);P.__pointerdown=[Ie,h];var q=B(P);{var J=r=>{yt(r,{get x_start(){return e(v)},get y_start(){return e(c)},get x_last(){return e(d)},get y_last(){return e(y)}})};V(q,r=>{e(u)&&r(J)})}N(()=>{H(P,"points",`${e(I)-e(p)},${e(S)-e(p)} ${e(I)+e(p)},${e(S)-e(p)} ${e(I)??""},${e(S)+e(p)}`),D(P,"pressing",e(u))}),X(o,z),G()}ut(["pointerdown"]);const Ee=(o,t)=>{t(o.clientX,o.clientY),nt(o)};var Pe=et('<circle role="none" class="unit_scale_handles svelte-rpawlp" fill="var(--color_selected)"></circle><!>',1);function Tt(o,t){Q(t,!0);const n=L(t,"unit",7),l=L(t,"size",3,wt),g=.01;let u=w(!1),s=w(null),v=w(null),c=w(null),d=w(null),y=w(null),k=w(null),x=w(null),I=w(null),S=w(null);const p=C(()=>n().scene.controller.pressing_alt?"move":"nesw-resize"),h=(r,a)=>{e(u)||(i(u,!0),i(s,_(n().scale)),i(v,_(n().x)),i(c,_(n().y)),i(d,_(r)),i(y,_(a)),i(k,_(r)),i(x,_(a)))},M=()=>{i(u,!1),i(s,null),i(v,null),i(c,null),i(d,null),i(y,null),i(k,null),i(x,null),i(I,null),i(S,null)},f=(r,a)=>{i(k,_(e(I))),i(x,_(e(S))),i(I,_(r)),i(S,_(a)),e(k)!==null&&e(x)!==null&&(n().scene.controller.pressing_alt?n().move_center_to(n().x+(e(I)-e(k)),n().y+(e(S)-e(x))):n().scale=le(e(s)+g*(e(I)-e(d)-(e(S)-e(y)))))},E=r=>{M()},b=r=>{M()},m=r=>{f(r.clientX,r.clientY)},Y=r=>{r.key==="Escape"&&(n().scene.controller.pressing_alt?n().move_center_to(e(v),e(c)):n().scale=e(s),M(),nt(r))};var z=Pe();T("pointerup",A,function(...r){var a;(a=e(u)?E:void 0)==null||a.apply(this,r)}),T("pointermove",A,function(...r){var a;(a=e(u)?m:void 0)==null||a.apply(this,r)}),T("pointerleave",A,function(...r){var a;(a=e(u)?b:void 0)==null||a.apply(this,r)}),T("keydown",A,function(...r){var a;(a=e(u)?Y:void 0)==null||a.apply(this,r)},!0);var P=Z(z);P.__pointerdown=[Ee,h];var q=B(P);{var J=r=>{yt(r,{get x_start(){return e(d)},get y_start(){return e(y)},get x_last(){return e(k)},get y_last(){return e(x)},container_width:innerWidth,container_height:innerHeight})};V(q,r=>{e(u)&&r(J)})}N(()=>{H(P,"cx",n().x),H(P,"cy",n().y),H(P,"r",l()/2),D(P,"pressing",e(u)),$(P,"cursor",e(p))}),X(o,z),G()}ut(["pointerdown"]);var Xe=O("<!> <!>",1);function Ke(o,t){var n=Xe(),l=Z(n);Tt(l,{get unit(){return t.unit}});var g=B(l,2);Ye(g,{get unit(){return t.unit}}),X(o,n)}const He=(o,t)=>{t(o.clientX,o.clientY),nt(o)};var ze=et('<polygon role="none" class="unit_polygon_point_handles svelte-1fl6mbc" fill="var(--color_selected)"></polygon><!>',1);function Ce(o,t){Q(t,!0);const n=L(t,"size",3,wt);let l=w(!1),g=w(null),u=w(null),s=w(null),v=w(null),c=w(null),d=w(null),y=w(null),k=w(null),x=w(_(t.point));const I=C(()=>t.unit.x+t.transformed_point.x),S=C(()=>t.unit.y+t.transformed_point.y),p=C(()=>n()/2),h=C(()=>t.unit.scene.controller.pressing_ctrl&&t.unit.scene.controller.pressing_alt?"no-drop":t.unit.scene.controller.pressing_alt?t.unit.scene.controller.pressing_shift?"alias":"copy":"move"),M=(a,R)=>{if(t.unit.scene.controller.pressing_ctrl&&t.unit.scene.controller.pressing_alt){t.unit.points.length>3&&t.unit.remove_point(t.point);return}e(l)||(i(l,!0),t.unit.scene.controller.pressing_alt?i(x,_(t.unit.duplicate_point(t.point,t.unit.scene.controller.pressing_shift))):i(x,_(t.point)),i(g,_(e(x).x)),i(u,_(e(x).y)),i(s,_(a)),i(v,_(R)),i(c,_(a)),i(d,_(R)))},f=()=>{i(l,!1),i(g,null),i(u,null),i(s,null),i(v,null),i(c,null),i(d,null),i(y,null),i(k,null),i(x,_(t.point))},E=(a,R)=>{i(c,_(e(y))),i(d,_(e(k))),i(y,_(a)),i(k,_(R)),e(c)!==null&&e(d)!==null&&t.unit.move_transformed_point(e(x),e(y)-e(c),e(k)-e(d))},b=a=>{f()},m=a=>{f()},Y=a=>{E(a.clientX,a.clientY)},z=a=>{a.key==="Escape"&&(t.unit.scene.controller.pressing_alt&&e(x)!==t.point?t.unit.remove_point(e(x)):(e(x).x=e(g),e(x).y=e(u),t.unit.update_points()),f(),nt(a))};var P=ze();T("pointerup",A,function(...a){var R;(R=e(l)?b:void 0)==null||R.apply(this,a)}),T("pointermove",A,function(...a){var R;(R=e(l)?Y:void 0)==null||R.apply(this,a)}),T("pointerleave",A,function(...a){var R;(R=e(l)?m:void 0)==null||R.apply(this,a)}),T("keydown",A,function(...a){var R;(R=e(l)?z:void 0)==null||R.apply(this,a)},!0);var q=Z(P);q.__pointerdown=[He,M];var J=B(q);{var r=a=>{yt(a,{get x_start(){return e(s)},get y_start(){return e(v)},get x_last(){return e(c)},get y_last(){return e(d)},container_width:innerWidth,container_height:innerHeight})};V(J,a=>{e(l)&&a(r)})}N(()=>{H(q,"points",`${e(I)-e(p)},${e(S)-e(p)} ${e(I)+e(p)},${e(S)-e(p)} ${e(I)??""},${e(S)+e(p)}`),D(q,"pressing",e(l)),$(q,"cursor",e(h))}),X(o,P),G()}ut(["pointerdown"]);const Ue=(o,t)=>{t(o.clientX,o.clientY),nt(o)};var Te=et('<polygon role="none" class="unit_angle_handles svelte-185pjka" fill="var(--color_selected)"></polygon><!>',1);function qe(o,t){Q(t,!0);const n=L(t,"unit",7),l=L(t,"size",3,wt),g=.013;let u=w(!1),s=w(null),v=w(null),c=w(null),d=w(null),y=w(null),k=w(null),x=w(null);const I=(r,a)=>{e(u)||(i(u,!0),i(s,_(n().angle)),i(v,_(r)),i(c,_(a)),i(d,_(r)),i(y,_(a)))},S=()=>{i(u,!1),i(s,null),i(v,null),i(c,null),i(d,null),i(y,null),i(k,null),i(x,null)},p=(r,a)=>{i(d,_(e(k))),i(y,_(e(x))),i(k,_(r)),i(x,_(a)),e(d)!==null&&e(y)!==null&&(n().angle=oe(e(s)+g*(e(k)-e(v)-(e(x)-e(c)))))},h=r=>{S()},M=r=>{S()},f=r=>{p(r.clientX,r.clientY)},E=r=>{r.key==="Escape"&&(n().angle=e(s),S(),nt(r))},b=C(()=>n().x+l()*Math.cos(-1*(n().angle-Math.PI/2))),m=C(()=>n().y-l()*Math.sin(-1*(n().angle-Math.PI/2))),Y=C(()=>`${e(b)},${e(m)-l()/2} ${e(b)+l()/3},${e(m)} ${e(b)},${e(m)+l()/2} ${e(b)-l()/3},${e(m)}`);var z=Te();T("pointerup",A,function(...r){var a;(a=e(u)?h:void 0)==null||a.apply(this,r)}),T("pointermove",A,function(...r){var a;(a=e(u)?f:void 0)==null||a.apply(this,r)}),T("pointerleave",A,function(...r){var a;(a=e(u)?M:void 0)==null||a.apply(this,r)}),T("keydown",A,function(...r){var a;(a=e(u)?E:void 0)==null||a.apply(this,r)},!0);var P=Z(z);P.__pointerdown=[Ue,I];var q=B(P);{var J=r=>{yt(r,{get x_start(){return e(v)},get y_start(){return e(c)},get x_last(){return e(d)},get y_last(){return e(y)},container_width:innerWidth,container_height:innerHeight})};V(q,r=>{e(u)&&r(J)})}N(()=>{H(P,"points",e(Y)),H(P,"transform",`rotate(${n().rotation??""} ${e(b)??""} ${e(m)??""})`),D(P,"pressing",e(u))}),X(o,z),G()}ut(["pointerdown"]);var Ne=O("<!> <!> <!>",1);function je(o,t){Q(t,!0);var n=Ne(),l=Z(n);zt(l,18,()=>t.unit.points,s=>s,(s,v,c)=>{Ce(s,{get unit(){return t.unit},get point(){return v},get transformed_point(){return t.unit.transformed_points[e(c)]}})});var g=B(l,2);Tt(g,{get unit(){return t.unit}});var u=B(g,2);qe(u,{get unit(){return t.unit}}),X(o,n),G()}function We(o,t){Q(t,!0);const n=C(()=>t.unit.type);var l=rt(),g=Z(l);{var u=v=>{Ke(v,{get unit(){return t.unit}})},s=v=>{var c=rt(),d=Z(c);{var y=x=>{je(x,{get unit(){return t.unit}})},k=x=>{var I=ot();N(()=>vt(I,Ct(e(n)))),X(x,I)};V(d,x=>{e(n)==="polygon"?x(y):x(k,!1)},!0)}X(v,c)};V(g,v=>{e(n)==="circle"?v(u):v(s,!1)})}X(o,l),G()}var Ae=O('<menu class="pane unstyled svelte-pa2qv7"><!></menu>'),Be=O('<li role="none" class="svelte-pa2qv7"><div class="menu_item plain selectable svelte-pa2qv7" role="menuitem" aria-label="contextmenu submenmu" tabindex="-1"><div class="content"><div class="icon"><!></div> <div class="title"><!></div></div> <div class="chevron svelte-pa2qv7" aria-hidden="true"></div></div> <!></li>');function Re(o,t){Q(t,!0);const n=se.get(),l=n.add_submenu(),{layout:g}=n,u=C(()=>l.selected);let s=w(void 0);const v=Yt.get(),c=Yt.set();let d=w(0),y=w(0);Xt(()=>{e(s)&&k(e(s),g,v)});const k=(m,Y,z)=>{const{x:P,y:q,width:J,height:r}=m.getBoundingClientRect();c.width=J,c.height=r;const a=P-e(d),R=q-e(y),_t=a+J+z.width-Y.width;if(_t<=0)i(d,_(z.width));else{const ct=J-a;ct<=0?i(d,-J):ct>_t?i(d,z.width-_t):i(d,ct-J)}i(y,_(Math.min(0,Y.height-(R+r))))};var x=Be(),I=j(x),S=j(I),p=j(S),h=j(p);at(h,()=>t.icon??Pt),W(p);var M=B(p,2),f=j(M);at(f,()=>t.children),W(M),W(S),lt(2),W(I);var E=B(I,2);{var b=m=>{var Y=Ae(),z=j(Y);at(z,()=>t.menu),W(Y),_e(Y,P=>i(s,P),()=>e(s)),N(()=>{$(Y,"transform",`translate3d(${e(d)??""}px, ${e(y)??""}px, 0)`),$(Y,"max-height",`${g.height??""}px`)}),X(m,Y)};V(E,m=>{e(u)&&m(b)})}W(x),N(()=>{$(x,"--contextmenu_depth",l.depth),H(I,"aria-expanded",e(u)),D(I,"selected",e(u))}),T("mouseenter",I,m=>{nt(m),setTimeout(()=>n.select(l))}),X(o,x),G()}var Ve=et('<circle role="none"></circle>'),De=et('<polygon role="none"></polygon>'),Fe=et('<svg class="unit_icon svelte-yrh1le"><!></svg>');function Ze(o,t){Q(t,!0);const n=L(t,"padding",3,2),l=C(()=>t.unit.type),g=C(()=>t.unit.points),u=C(()=>t.unit.angle),s=100,v=s/2,c=C(()=>`rotate(${e(u)*360/(Math.PI*2)} ${v} ${v})`),d=C(()=>{if(e(l)!=="polygon"||!e(g).length)return"";const S=e(g).map(Y=>Y.x),p=e(g).map(Y=>Y.y),h=(Math.min(...S)+Math.max(...S))/2,M=(Math.min(...p)+Math.max(...p))/2,f=Math.max(...e(g).map(Y=>Math.sqrt((Y.x-h)**2+(Y.y-M)**2))),E=(s-n()*2)/(f*2),b=s/2-h*E,m=s/2-M*E;return e(g).map(Y=>`${Y.x*E+b},${Y.y*E+m}`).join(" ")});var y=Fe();H(y,"viewBox",`0 0 ${s} ${s}`);var k=j(y);{var x=S=>{var p=Ve();H(p,"cx",v),H(p,"cy",v),N(()=>{H(p,"r",(s-n()*2)/2.6),H(p,"fill",t.unit.color),H(p,"transform",e(c))}),X(S,p)},I=S=>{var p=rt(),h=Z(p);{var M=E=>{var b=De();N(()=>{H(b,"points",e(d)),H(b,"fill",t.unit.color),H(b,"transform",e(c))}),X(E,b)},f=E=>{var b=ot();N(()=>vt(b,Ct(e(l)))),X(E,b)};V(h,E=>{e(l)==="polygon"?E(M):E(f,!1)},!0)}X(S,p)};V(k,S=>{e(l)==="circle"?S(x):S(I,!1)})}W(y),X(o,y),G()}var Je=O("<!> <!> <!> <!>",1),Le=O("<small><code> </code></small>"),Oe=O("Unit <!>",1),Ge=O('<div class="display_contents"><!></div>');function Qe(o,t){Q(t,!0);const n=v=>{var c=rt(),d=Z(c);{var y=k=>{Re(k,{menu:S=>{var p=Je(),h=Z(p);mt(h,{icon:"⎘",run:()=>{const m=t.unit.clone();m.x+=10,m.y+=10,t.scene.add_unit(m)},children:(m,Y)=>{lt();var z=ot("Duplicate unit");X(m,z)},$$slots:{default:!0}});var M=B(h,2);{var f=m=>{mt(m,{icon:"◎",run:()=>{t.unit.create_new_point()},children:(Y,z)=>{lt();var P=ot("Add point to polygon");X(Y,P)},$$slots:{default:!0}})};V(M,m=>{t.unit.type==="polygon"&&m(f)})}var E=B(M,2);mt(E,{icon:"⌸",run:async()=>{const m=JSON.stringify(t.unit.json);await navigator.clipboard.writeText(m)},children:(m,Y)=>{lt();var z=ot("Copy data to clipboard");X(m,z)},$$slots:{default:!0}});var b=B(E,2);mt(b,{icon:"✕",run:()=>{t.scene.remove_unit(t.unit)},children:(m,Y)=>{lt();var z=ot("Delete unit");X(m,z)},$$slots:{default:!0}}),X(S,p)},icon:S=>{Ze(S,{get unit(){return t.unit}})},children:(S,p)=>{lt();var h=Oe(),M=B(Z(h));{var f=b=>{var m=ot();N(()=>vt(m,t.unit.name)),X(b,m)},E=b=>{var m=Le(),Y=j(m),z=j(Y,!0);W(Y),W(m),N(()=>vt(z,t.unit.id_string)),X(b,m)};V(M,b=>{t.unit.name?b(f):b(E,!1)})}X(S,h)},$$slots:{menu:!0,icon:!0,default:!0}})};V(d,k=>{t.unit&&k(y)})}X(v,c)};var l=rt(),g=Z(l);{var u=v=>{var c=Ge(),d=j(c);at(d,()=>t.children),W(c),re(c,(y,k)=>{var x;return(x=ae)==null?void 0:x(y,k)},()=>n),N(()=>H(c,"data-unit",t.unit.id)),X(v,c)},s=v=>{var c=rt(),d=Z(c);at(d,()=>t.children),X(v,c)};V(g,v=>{t.unit?v(u):v(s,!1)})}X(o,l),G()}const $e=()=>({selecting:!1,selection_start_x:0,selection_start_y:0,selection_width:0,selection_height:0,initial_pointer_x:0,initial_pointer_y:0});var ft,tt,st;class tn{constructor(t){It(this,"selection_threshold",0);dt(this,ft,w(_($e())));dt(this,tt,w(_(new Set)));dt(this,st,w(_(new Set)));this.helpers=t}get state(){return e(F(this,ft))}set state(t){i(F(this,ft),_(t))}has(t){return e(F(this,tt)).has(t)}add(t){e(F(this,tt)).add(t)}delete(t){e(F(this,tt)).delete(t)}clear(){e(F(this,tt)).clear()}get_selected_items(){return Array.from(e(F(this,tt)))}handle_selection_start(t,n,l){const g=this.helpers.find_top_item(t,n),u=g&&this.has(g);if(this.state.initial_pointer_x=t,this.state.initial_pointer_y=n,i(F(this,st),_(new Set(e(F(this,tt))))),l==="subtractive"&&u){this.delete(g);return}g&&l!=="subtractive"?(l==="normal"&&this.clear(),this.add(g)):l==="normal"&&this.clear()}start_drag(t,n){this.state.selecting=!0,this.state.selection_start_x=t,this.state.selection_start_y=n,this.state.selection_width=0,this.state.selection_height=0}update_drag(t,n,l){if(!this.state.selecting)return;this.state.selection_width=t-this.state.selection_start_x,this.state.selection_height=n-this.state.selection_start_y;const g=this.state.selection_width>=0?this.state.selection_start_x:t,u=this.state.selection_height>=0?this.state.selection_start_y:n,s=Math.abs(this.state.selection_width),v=Math.abs(this.state.selection_height),c=this.helpers.find_all_items(g,u,s,v);switch(l){case"additive":i(F(this,tt),_(new Set(e(F(this,st)))));for(const d of c)this.add(d);break;case"subtractive":i(F(this,tt),_(new Set(e(F(this,st)))));for(const d of c)this.delete(d);break;case"normal":this.clear();for(const d of c)this.add(d);break;default:throw new ue(l)}}end_drag(t,n,l){const g=t-this.state.initial_pointer_x,u=n-this.state.initial_pointer_y,s=Math.sqrt(g*g+u*u)>this.selection_threshold;this.state.selecting&&s&&this.update_drag(t,n,l),this.state.selecting=!1,this.state.selection_width=0,this.state.selection_height=0,e(F(this,st)).clear()}}ft=new WeakMap,tt=new WeakMap,st=new WeakMap;const en=(o,t,n,l,g,u,s,v)=>{t(o.offsetX,o.offsetY),n(n().pointer_down=!0,!0),n(n().drag_start_x=n().pointer_x,!0),n(n().drag_start_y=n().pointer_y,!0);const c=o.shiftKey&&o.ctrlKey&&!o.altKey;if(n().hovering_handle){!o.altKey&&o.shiftKey&&n().hovering_unit&&(n(n().dragging_unit=n().hovering_unit,!0),n(n().dragging_selection=!0,!0),l.unit_selection.has(n().hovering_unit)||((!o.ctrlKey||c)&&l.unit_selection.clear(),l.unit_selection.add(n().hovering_unit)),c&&e(g)&&u());return}const d=n().hovering_unit;if(d&&l.unit_selection.has(d)&&(o.shiftKey&&!o.altKey||!o.ctrlKey)){n(n().dragging_unit=d,!0),n(n().dragging_selection=!0,!0),c&&e(g)&&u();return}s.handle_selection_start(n().pointer_x,n().pointer_y,v(o)),l.unit_selection.clear();for(const k of s.get_selected_items())l.unit_selection.add(k)},nn=(o,t,n,l,g,u)=>{if(t(o.offsetX,o.offsetY),n.state.selecting){n.end_drag(l().pointer_x,l().pointer_y,g(o)),u.unit_selection.clear();for(const s of n.get_selected_items())u.unit_selection.add(s)}l(l().pointer_down=!1,!0),l(l().drag_start_x=null,!0),l(l().drag_start_y=null,!0),l(l().dragging_unit=null,!0),l(l().dragging_selection=!1,!0)},ln=(o,t,n,l,g,u)=>{if(t(o.offsetX,o.offsetY),n().pointer_down&&!n().dragging_unit){const s=n().pointer_x-l.state.initial_pointer_x,v=n().pointer_y-l.state.initial_pointer_y;Math.sqrt(s*s+v*v)>l.selection_threshold&&!l.state.selecting&&l.start_drag(l.state.initial_pointer_x,l.state.initial_pointer_y)}if(l.state.selecting){l.update_drag(n().pointer_x,n().pointer_y,g(o)),u.unit_selection.clear();for(const s of l.get_selected_items())u.unit_selection.add(s)}};var on=et('<rect class="selection_rect svelte-1s96klh"></rect>'),sn=O('<div class="scene_interaction_surface svelte-1s96klh"><svg class="controls_layer svelte-1s96klh"><!><!></svg></div>');function bn(o,t){Q(t,!0);const n=L(t,"scene_interaction_surface_state",15),l=C(()=>t.scene.controller),g=h=>h,u=h=>h,s=new tn({find_top_item:t.scene.find_top_unit_at_point,find_all_items:t.scene.find_all_units_in_rect}),v=h=>h.shiftKey&&h.ctrlKey?"additive":h.ctrlKey?"subtractive":h.shiftKey?"additive":"normal",c=C(()=>n().hovering_unit!==null&&t.unit_selection.has(n().hovering_unit)),d=(h,M)=>{const f=g(h),E=u(M),b=n().pointer_x,m=n().pointer_y;if(n(n().pointer_x=f,!0),n(n().pointer_y=E,!0),n().dragging_unit){const Y=f-b,z=E-m;for(const P of t.unit_selection)P.x+=Y,P.y+=z}else n(n().hovering_unit=t.scene.find_top_unit_at_point(f,E),!0),n().hovering_unit&&n(n().hovered_unit=n().hovering_unit,!0)},y=()=>{const h=[];for(const M of t.unit_selection){const f=M.clone();t.scene.add_unit(f),h.push(f)}t.unit_selection.clear(),s.clear();for(const M of h)t.unit_selection.add(M),s.add(M)},k=h=>{d(h.offsetX,h.offsetY),n(n().pointing=!0,!0)},x=h=>{d(h.offsetX,h.offsetY),n(n().pointing=!1,!0),n(n().hovering_unit=null,!0)},I=h=>{n().pointer_down&&n(n().pointer_down=!1,!0),n(n().dragging_unit=null,!0),n(n().dragging_selection=!1,!0)},S=h=>{(h.key==="Shift"||h.key==="Control")&&s.update_drag(n().pointer_x,n().pointer_y,v(h))},p=h=>{(h.key==="Shift"||h.key==="Control")&&s.update_drag(n().pointer_x,n().pointer_y,v(h))};T("keydown",A,S),T("keyup",A,p),Qe(o,{get scene(){return t.scene},get unit(){return n().hovered_unit},children:(h,M)=>{var f=sn();f.__pointerdown=[en,d,n,t,c,y,s,v],f.__pointerup=[nn,d,s,n,v,t],f.__pointermove=[ln,d,n,s,v,t];const E=C(()=>n().hovering_unit&&t.unit_selection.has(n().hovering_unit)&&!s.state.selecting&&!n().pointer_down);N(()=>D(f,"grabbable",e(E)));var b=j(f),m=j(b);zt(m,16,()=>Array.from(t.unit_selection),P=>P,(P,q)=>{We(P,{get unit(){return q}})});var Y=B(m);{var z=P=>{var q=on();N(()=>H(q,"width",Math.abs(s.state.selection_width))),N(()=>H(q,"height",Math.abs(s.state.selection_height))),N(()=>{H(q,"x",s.state.selection_width>=0?s.state.selection_start_x:s.state.selection_start_x+s.state.selection_width),H(q,"y",s.state.selection_height>=0?s.state.selection_start_y:s.state.selection_start_y+s.state.selection_height)}),X(P,q)};V(Y,P=>{s.state.selecting&&P(z)})}W(b),W(f),N(()=>{D(f,"pressing",n().pointer_down),D(f,"selecting",s.state.selecting),D(f,"hovering",!!n().hovering_unit),D(f,"hovering_selection",e(c)),D(f,"grabbing",n().dragging_unit!==null),D(f,"pressing_shift",e(l).pressing_shift),D(f,"pressing_ctrl",e(l).pressing_ctrl),D(f,"pressing_alt",e(l).pressing_alt),$(f,"width",`${t.width??""}px`),$(f,"height",`${t.height??""}px`),H(b,"width",t.width),H(b,"height",t.height)}),T("pointerenter",f,k),T("pointerleave",f,x),T("pointercancel",f,I),X(h,f)},$$slots:{default:!0}}),G()}ut(["pointerdown","pointerup","pointermove"]);var rn=O('<div class="flex align_items_end font_weight_700 px_md font_mono"><div class="text_align_right pr_xs"> </div> <div class="text_color_4">fps</div></div>');function kn(o,t){Q(t,!0);const n=C(()=>t.clock??ce.get());var l=rn(),g=j(l);$(g,"width","4rem");var u=j(g,!0);W(g),lt(2),W(l),N(()=>vt(u,e(n).average_fps)),X(o,l),G()}export{kn as F,wn as S,Ze as U,pn as a,bn as b,xn as c,Qe as d};
