var pe=Object.defineProperty;var qt=h=>{throw TypeError(h)};var be=(h,t,e)=>t in h?pe(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var a=(h,t,e)=>be(h,typeof t!="symbol"?t+"":t,e),It=(h,t,e)=>t.has(h)||qt("Cannot "+e);var g=(h,t,e)=>(It(h,t,"read from private field"),e?e.call(h):t.get(h)),L=(h,t,e)=>t.has(h)?qt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(h):t.set(h,e);var Nt=(h,t,e)=>(It(h,t,"access private method"),e);import{t as Z,a as M,b as Mt,c as Q}from"./DyCZ_lw9.js";import{m as at,c as J,r as z,s as ot,o as it,w as i,x as D,q as rt,v as q,n as Wt,u as Ht,ai as A,aL as T,X as x,G as ne,$ as xe}from"./Dkaln31E.js";import{p as H,i as X,b as se}from"./Cr-AO5Xh.js";import{s as F}from"./DQXgQxX-.js";import{s as St,d as ye,o as we,k as Lt}from"./DMs3BEDJ.js";import{s as Vt,d as Tt,b as ke,g as je}from"./C07ZAADA.js";import{K as _e,L as Ce,M as Ae,N as R,O as Ee,Q as Y,V as Ot,W as zt,X as Ft,b as Jt,Y as Ge,Z as Me,_ as Se,f as Le,$ as Pe,C as Be,a0 as Ke,a1 as Re,y as De,a2 as He,e as ie,a3 as Qt}from"./BERuEieG.js";import{b as Te}from"./DlVdBben.js";import{c as Oe}from"./D2kjYpeH.js";var Ue=(h,t)=>t.close(),Xe=Z('<li role="none" class="svelte-xrqtyv"><a class="menu_item plain svelte-xrqtyv" role="menuitem"><div class="content"><div class="icon"><!></div> <div class="title"><span class="text svelte-xrqtyv"><!></span></div></div></a></li>');function Ye(h,t){at(t,!0);const e="ðŸ”—",r=H(t,"icon",3,e),n=_e.get(),o=(k,C=location.host)=>{const B=Tt(Tt(k,"https://"),"http://");return B.startsWith(C+"/")?Tt(B,C):B},s=D(()=>o(t.href)),_=D(()=>!(i(s)[0]==="."||i(s)[0]==="/"&&i(s)[1]!=="/")),d=D(()=>i(_)?"noreferrer":void 0);var v=Xe(),m=J(v);m.__click=[Ue,n];var w=J(m),u=J(w),E=J(u);{var p=k=>{var C=Mt();it(()=>St(C,r())),M(k,C)},K=k=>{var C=Q(),B=q(C);F(B,r,()=>e),M(k,C)};X(E,k=>{typeof r()=="string"?k(p):k(K,!1)})}z(u);var P=ot(u,2),S=J(P),O=J(S);{var G=k=>{var C=Q(),B=q(C);F(B,()=>t.children),M(k,C)},U=k=>{var C=Mt();it(()=>St(C,i(s))),M(k,C)};X(O,k=>{t.children?k(G):k(U,!1)})}z(S),z(P),z(w),z(m),z(v),it(()=>{Vt(m,"href",t.href),Vt(m,"rel",i(d))}),M(h,v),rt()}ye(["click"]);function qe(h,t){Ce(h,{get run(){return t.run},icon:r=>{Wt();var n=Mt();it(()=>St(n,t.icon)),M(r,n)},children:(r,n)=>{Wt();var o=Mt();it(()=>St(o,t.content)),M(r,o)},$$slots:{icon:!0,default:!0}})}const Ie=(h,t=ne)=>{Ye(h,se(t))},Ne=(h,t=ne)=>{qe(h,se(t))};var We=Z('<div class="contextmenu_root svelte-aif9y6" role="region"><!></div>'),Ve=Z('<div class="contextmenu_layout svelte-aif9y6" aria-hidden="true"></div>'),ze=Z('<ul class="contextmenu unstyled pane svelte-aif9y6" role="menu" aria-label="context menu" tabindex="-1"></ul>'),Fe=Z("<!> <!> <!>",1);function Je(h,t){at(t,!0);const e=H(t,"contextmenu",19,()=>new Ee),r=H(t,"longpress_move_tolerance",3,21),n=H(t,"longpress_duration",3,633),o=H(t,"bypass_with_tap_then_longpress",3,!0),s=H(t,"tap_then_longpress_duration",3,660),_=H(t,"tap_then_longpress_move_tolerance",3,7),d=H(t,"open_offset_x",19,()=>-2),v=H(t,"open_offset_y",19,()=>-2),m=H(t,"scoped",3,!1);_e.set(e());let w=A(void 0);const u=D(()=>e().layout),E=D(()=>e().initial_layout),p=D(()=>i(u)===i(E));let K=A(void 0),P=A(void 0);Ht(()=>{!i(p)&&i(K)!==void 0&&(i(u).width=i(K))}),Ht(()=>{!i(p)&&i(P)!==void 0&&(i(u).height=i(P))});const S=Ae.set();Ht(()=>{if(i(w)){const l=i(w).getBoundingClientRect();S.width=l.width,S.height=l.height}});const O=D(()=>e().x+Math.min(0,i(u).width-(e().x+S.width))),G=D(()=>e().y+Math.min(0,i(u).height-(e().y+S.height)));let U=A(void 0),k=A(void 0),C=A(void 0),B=A(void 0),I=A(void 0),N=A(void 0);const W=()=>{i(I)&&x(I,!1),i(B)!=null&&(clearTimeout(i(B)),x(B,null))},$=l=>{var b;if(i(N)){x(N,!1);return}if(i(I)){W(),Y(l);return}const{target:c}=l;l.shiftKey||!(c instanceof HTMLElement||c instanceof SVGElement)||(b=i(w))!=null&&b.contains(c)||Ot(c)||zt(c)||Ft(c,l.clientX+d(),l.clientY+v(),e())&&(Y(l),W())},tt=l=>{i(I)&&x(I,!1);const{touches:c,target:b}=l;if(e().opened||c.length!==1||l.shiftKey||!(b instanceof HTMLElement||b instanceof SVGElement)||Ot(b)||zt(b))return;const{clientX:j,clientY:y}=c[0];if(o()){if(i(C)!=null&&performance.now()-i(C)<s()&&Math.hypot(j-i(U),y-i(k))<_()){x(N,!0),x(C,null);return}x(C,performance.now(),!0)}x(U,j,!0),x(k,y,!0),i(B)!=null&&W(),x(B,setTimeout(()=>{x(I,!0),Ft(b,i(U)+d(),i(k)+v(),e())},n()),!0)},et=l=>{if(i(B)==null)return;const{touches:c}=l;if(c.length!==1)return;const{clientX:b,clientY:j}=c[0];Math.hypot(b-i(U),j-i(k))>r()&&(e().opened&&e().close(),W())},V=l=>{i(B)!=null&&(i(I)&&Y(l),W())},lt=l=>{i(w)&&!i(w).contains(l.target)&&e().close()},ct=new Map([["Escape",()=>e().close()],["ArrowLeft",()=>e().collapse_selected()],["ArrowRight",()=>e().expand_selected()],["ArrowDown",()=>e().select_next()],["PageDown",()=>e().select_next()],["ArrowUp",()=>e().select_previous()],["PageUp",()=>e().select_previous()],["Home",()=>e().select_first()],["End",()=>e().select_last()],[" ",()=>e().activate_selected()],["Enter",()=>e().activate_selected()]]),ht=l=>{const c=ct.get(l.key);!c||Ot(l.target)||(Y(l),c())},f=(l,c)=>{let b=null;const j=y=>{b&&(b(),b=null),y.disabled||(b=we(l,y.event,y.cb,{capture:!0,passive:y.passive}))};return j(c),{update:y=>{j(y)},destroy:()=>{b==null||b()}}};var Kt=Fe();R(T,(l,c)=>f==null?void 0:f(l,c),()=>({event:"contextmenu",passive:!1,cb:$,disabled:m()})),R(T,(l,c)=>f==null?void 0:f(l,c),()=>({event:"touchstart",passive:!0,cb:tt,disabled:m()})),R(T,(l,c)=>f==null?void 0:f(l,c),()=>({event:"touchmove",passive:!0,cb:et,disabled:m()})),R(T,(l,c)=>f==null?void 0:f(l,c),()=>({event:"touchend",passive:!1,cb:V,disabled:m()})),R(T,(l,c)=>f==null?void 0:f(l,c),()=>({event:"touchcancel",passive:!1,cb:V,disabled:m()})),R(T,(l,c)=>f==null?void 0:f(l,c),()=>({event:"mousedown",passive:!0,cb:lt,disabled:!e().opened})),R(T,(l,c)=>f==null?void 0:f(l,c),()=>({event:"keydown",passive:!1,cb:ht,disabled:!e().opened}));var Et=q(Kt);{var ae=l=>{var c=We(),b=J(c);F(b,()=>t.children),z(c),R(c,(j,y)=>f==null?void 0:f(j,y),()=>({event:"contextmenu",passive:!1,cb:$})),R(c,(j,y)=>f==null?void 0:f(j,y),()=>({event:"touchstart",passive:!0,cb:tt})),R(c,(j,y)=>f==null?void 0:f(j,y),()=>({event:"touchmove",passive:!0,cb:et})),R(c,(j,y)=>f==null?void 0:f(j,y),()=>({event:"touchend",passive:!1,cb:V})),R(c,(j,y)=>f==null?void 0:f(j,y),()=>({event:"touchcancel",passive:!1,cb:V})),M(l,c)},re=l=>{var c=Q(),b=q(c);F(b,()=>t.children),M(l,c)};X(Et,l=>{m()?l(ae):l(re,!1)})}var Xt=ot(Et,2);{var le=l=>{var c=Ve();Jt(c,"clientHeight",b=>x(P,b)),Jt(c,"clientWidth",b=>x(K,b)),M(l,c)};X(Xt,l=>{i(p)||l(le)})}var ce=ot(Xt,2);{var he=l=>{var c=ze();let b;ke(c,20,()=>e().params,j=>j,(j,y)=>{var Yt=Q(),ue=q(Yt);{var me=nt=>{var Gt=Q(),Rt=q(Gt);F(Rt,()=>y),M(nt,Gt)},fe=(nt,Gt)=>{{var Rt=st=>{Ie(st,()=>y.props)},de=(st,ve)=>{{var ge=Dt=>{Ne(Dt,()=>y.props)};X(st,Dt=>{y.snippet==="text"&&Dt(ge)},ve)}};X(nt,st=>{y.snippet==="link"?st(Rt):st(de,!1)},Gt)}};X(ue,nt=>{typeof y=="function"?nt(me):nt(fe,!1)})}M(j,Yt)}),z(c),Te(c,j=>x(w,j),()=>i(w)),it(()=>b=je(c,"",b,{transform:`translate3d(${i(O)??""}px, ${i(G)??""}px, 0)`})),M(l,c)};X(ce,l=>{e().opened&&l(he)})}M(h,Kt),rt()}const _t=class _t{constructor(){a(this,"_bvh_branch",!0);a(this,"_bvh_parent",null);a(this,"_bvh_left",null);a(this,"_bvh_right",null);a(this,"_bvh_sort",0);a(this,"_bvh_min_x",0);a(this,"_bvh_min_y",0);a(this,"_bvh_max_x",0);a(this,"_bvh_max_y",0)}static get_branch(t=_t.branch_pool){return t.pop()??new _t}static release_branch(t,e=_t.branch_pool){e.push(t)}};a(_t,"branch_pool",[]);let Pt=_t;class Qe{constructor(){a(this,"_hierarchy",null);a(this,"_bodies",[]);a(this,"_dirty_branches",[])}insert(t,e=!1){if(!e){const p=t._bvh;if(p&&p!==this)throw new Error("Body belongs to another collision system");t._bvh=this,this._bodies.push(t)}const r=t.is_polygon,n=t.x,o=t.y;r&&(t._dirty_coords||t.x!==t._x||t.y!==t._y||t.rotation!==t._rotation||t.scale_x!==t._scale_x||t.scale_y!==t._scale_y)&&t._calculate_coords();const s=t._bvh_padding,_=r?0:t.radius*t.scale,d=(r?t._min_x:n-_)-s,v=(r?t._min_y:o-_)-s,m=(r?t._max_x:n+_)+s,w=(r?t._max_y:o+_)+s;t._bvh_min_x=d,t._bvh_min_y=v,t._bvh_max_x=m,t._bvh_max_y=w;let u=this._hierarchy,E=0;if(!u)this._hierarchy=t;else for(;;)if(u._bvh_branch){const p=u._bvh_left,K=p._bvh_min_y,P=p._bvh_max_x,S=p._bvh_max_y,O=d<p._bvh_min_x?d:p._bvh_min_x,G=v<K?v:K,U=m>P?m:P,k=w>S?w:S,C=(P-p._bvh_min_x)*(S-K),I=(U-O)*(k-G)-C,N=u._bvh_right,W=N._bvh_min_x,$=N._bvh_min_y,tt=N._bvh_max_x,et=N._bvh_max_y,V=d<W?d:W,lt=v<$?v:$,ct=m>tt?m:tt,ht=w>et?w:et,f=(tt-W)*(et-$),Et=(ct-V)*(ht-lt)-f;u._bvh_sort=E++,u._bvh_min_x=O<V?O:V,u._bvh_min_y=G<lt?G:lt,u._bvh_max_x=U>ct?U:ct,u._bvh_max_y=k>ht?k:ht,u=I<=Et?p:N}else{const p=u._bvh_parent,K=u._bvh_min_x,P=u._bvh_min_y,S=u._bvh_max_x,O=u._bvh_max_y,G=u._bvh_parent=t._bvh_parent=Pt.get_branch();G._bvh_parent=p,G._bvh_left=u,G._bvh_right=t,G._bvh_sort=E++,G._bvh_min_x=d<K?d:K,G._bvh_min_y=v<P?v:P,G._bvh_max_x=m>S?m:S,G._bvh_max_y=w>O?w:O,p?p._bvh_left===u?p._bvh_left=G:p._bvh_right=G:this._hierarchy=G;break}}remove(t,e=!1){if(!e){const _=t._bvh;if(_&&_!==this)throw new Error("Body belongs to another collision system");t._bvh=null,this._bodies.splice(this._bodies.indexOf(t),1)}if(this._hierarchy===t){this._hierarchy=null;return}const r=t._bvh_parent,n=r._bvh_parent,o=r._bvh_left,s=o===t?r._bvh_right:o;if(s._bvh_parent=n,s._bvh_branch&&(s._bvh_sort=r._bvh_sort),n){n._bvh_left===r?n._bvh_left=s:n._bvh_right=s;let _=n;for(;_;){const d=_._bvh_left,v=d._bvh_min_x,m=d._bvh_min_y,w=d._bvh_max_x,u=d._bvh_max_y,E=_._bvh_right,p=E._bvh_min_x,K=E._bvh_min_y,P=E._bvh_max_x,S=E._bvh_max_y;_._bvh_min_x=v<p?v:p,_._bvh_min_y=m<K?m:K,_._bvh_max_x=w>P?w:P,_._bvh_max_y=u>S?u:S,_=_._bvh_parent}}else this._hierarchy=s;Pt.release_branch(r)}update(){const t=this._bodies,e=t.length;for(let r=0;r<e;++r){const n=t[r];let o=!1;if(n.padding!==n._bvh_padding&&(n._bvh_padding=n.padding,o=!0),!o){const s=n.is_polygon;s&&(n._dirty_coords||n.x!==n._x||n.y!==n._y||n.rotation!==n._rotation||n.scale_x!==n._scale_x||n.scale_y!==n._scale_y)&&n._calculate_coords();const _=n.x,d=n.y,v=s?0:n.radius*n.scale,m=s?n._min_x:_-v,w=s?n._min_y:d-v,u=s?n._max_x:_+v,E=s?n._max_y:d+v;o=m<n._bvh_min_x||w<n._bvh_min_y||u>n._bvh_max_x||E>n._bvh_max_y}o&&(this.remove(n,!0),this.insert(n,!0))}}potentials(t){const e=[],r=t._bvh_min_x,n=t._bvh_min_y,o=t._bvh_max_x,s=t._bvh_max_y;let _=this._hierarchy,d=!0;if(!(_!=null&&_._bvh_branch))return e;for(;_;){if(d){d=!1;let m=_._bvh_branch?_._bvh_left:null;for(;m&&m._bvh_max_x>=r&&m._bvh_max_y>=n&&m._bvh_min_x<=o&&m._bvh_min_y<=s;)_=m,m=_._bvh_branch?_._bvh_left:null}const v=_._bvh_branch?_._bvh_right:null;if(v&&v._bvh_max_x>r&&v._bvh_max_y>n&&v._bvh_min_x<o&&v._bvh_min_y<s)_=v,d=!0;else{!_._bvh_branch&&_!==t&&e.push(_);let m=_._bvh_parent;if(m){for(;m&&m._bvh_right===_;)_=m,m=_._bvh_parent;_=m}else break}}return e}}class Ze extends Ge{constructor(e=0,r=0,n=0,o=1,s=0){super(e,r,s);a(this,"is_polygon",!1);a(this,"is_circle",!0);a(this,"is_point",!1);a(this,"radius");a(this,"scale");this.radius=n,this.scale=o}}class $e{constructor(){a(this,"_bvh",new Qe)}create_circle(t=0,e=0,r=0,n=1,o=0){const s=new Ze(t,e,r,n,o);return this._bvh.insert(s),s}create_polygon(t=0,e=0,r=[{x:0,y:0}],n=0,o=1,s=1,_=0){const d=new Me(t,e,r,n,o,s,_);return this._bvh.insert(d),d}create_point(t=0,e=0,r=0){const n=new Se(t,e,r);return this._bvh.insert(n),n}insert(...t){for(const e of t)this._bvh.insert(e,!1);return this}remove(...t){for(const e of t)this._bvh.remove(e,!1);return this}update(){return this._bvh.update(),this}potentials(t){return this._bvh.potentials(t)}}class tn{constructor(){a(this,"collision",!1);a(this,"a",null);a(this,"b",null);a(this,"a_in_b",!1);a(this,"b_in_a",!1);a(this,"overlap",0);a(this,"overlap_x",0);a(this,"overlap_y",0)}}const Zt=new tn;var ut;class en{constructor(t){a(this,"collisions");L(this,ut,A(1));this.collisions=t}get speed(){return i(g(this,ut))}set speed(t){x(g(this,ut),t,!0)}update(t,e,r){this.collisions.update();const n=e*this.speed;var o;for(const s of t){s.dead||(o=s.speed*n,o!==0&&(s.direction_x!==0&&(s.x+=s.direction_x*o),s.direction_y!==0&&(s.y+=s.direction_y*o))),s.teleporting_x!==0&&(s.x+=s.teleporting_x),s.teleporting_y!==0&&(s.y+=s.teleporting_y);for(const _ of s.body.potentials())Le(s.body,_,Zt)&&(_.unit.behaviors.has("Harmful_Behavior")&&s.behaviors.has("Player_Controller_Behavior")?s.kill():_.unit.behaviors.has("Player_Controller_Behavior")&&s.behaviors.has("Harmful_Behavior")?_.unit.kill():_.unit.behaviors.has("Goal_Behavior")&&s.behaviors.has("Player_Controller_Behavior")?s.scene.exit():_.unit.behaviors.has("Player_Controller_Behavior")&&s.behaviors.has("Goal_Behavior")?_.unit.scene.exit():r(s,_.unit,Zt))}}}ut=new WeakMap;var mt,ft,dt,vt,gt,pt,bt,xt,yt,wt,kt,jt,Bt,oe;class nn{constructor(){L(this,Bt);L(this,mt,A(!1));L(this,ft,A(!1));L(this,dt,A(!1));L(this,vt,A(!1));a(this,"teleporting_x",null);a(this,"teleporting_y",null);L(this,gt,A(0));L(this,pt,A(0));a(this,"just_pressed_button_a",!1);a(this,"just_pressed_button_b",!1);a(this,"just_pressed_button_x",!1);a(this,"just_pressed_button_y",!1);a(this,"pressing_button_a",!1);a(this,"pressing_button_b",!1);a(this,"pressing_button_x",!1);a(this,"pressing_button_y",!1);L(this,bt,D(()=>this.gamepad_moving_x||(this.moving_left?-1:0)+(this.moving_right?1:0)));L(this,xt,D(()=>this.gamepad_moving_y||(this.moving_up?-1:0)+(this.moving_down?1:0)));L(this,yt,A(!1));L(this,wt,A(!1));L(this,kt,A(!1));a(this,"pointer_down",!1);L(this,jt,D(()=>this.pointer_down||this.moving_x!==0||this.moving_y!==0));a(this,"pointer_screen_x",null);a(this,"pointer_screen_y",null);a(this,"connected_gamepads",new Pe);a(this,"gamepad_axis_sensitivity",.04);a(this,"teleport_distance_md",12);a(this,"teleport_distance_lg",this.teleport_distance_md*4);a(this,"teleport_distance_xl",this.teleport_distance_lg*4)}get moving_left(){return i(g(this,mt))}set moving_left(t){x(g(this,mt),t,!0)}get moving_right(){return i(g(this,ft))}set moving_right(t){x(g(this,ft),t,!0)}get moving_up(){return i(g(this,dt))}set moving_up(t){x(g(this,dt),t,!0)}get moving_down(){return i(g(this,vt))}set moving_down(t){x(g(this,vt),t,!0)}get gamepad_moving_x(){return i(g(this,gt))}set gamepad_moving_x(t){x(g(this,gt),t,!0)}get gamepad_moving_y(){return i(g(this,pt))}set gamepad_moving_y(t){x(g(this,pt),t,!0)}get moving_x(){return i(g(this,bt))}set moving_x(t){x(g(this,bt),t)}get moving_y(){return i(g(this,xt))}set moving_y(t){x(g(this,xt),t)}get pressing_shift(){return i(g(this,yt))}set pressing_shift(t){x(g(this,yt),t,!0)}get pressing_ctrl(){return i(g(this,wt))}set pressing_ctrl(t){x(g(this,wt),t,!0)}get pressing_alt(){return i(g(this,kt))}set pressing_alt(t){x(g(this,kt),t,!0)}set_pointer_down(t){this.pointer_down=t}get moving(){return i(g(this,jt))}set moving(t){x(g(this,jt),t)}set_pointer_location(t,e){this.pointer_screen_x=t,this.pointer_screen_y=e}update(t){Nt(this,Bt,oe).call(this);const e=this.just_pressed_button_a&&this.pressing_button_x||this.just_pressed_button_x&&this.pressing_button_a?this.teleport_distance_xl:this.just_pressed_button_x?this.teleport_distance_lg:this.just_pressed_button_a?this.teleport_distance_md:0;this.teleporting_x=e===0||this.moving_x===0?null:this.moving_x*e,this.teleporting_y=e===0||this.moving_y===0?null:this.moving_y*e}handle_keydown(t){switch(t){case"Shift":return this.pressing_shift=!0,!0;case"Control":return this.pressing_ctrl=!0,!0;case"Alt":return this.pressing_alt=!0,!0;case"ArrowLeft":case"a":return this.moving_left=!0,!0;case"ArrowRight":case"d":return this.moving_right=!0,!0;case"ArrowUp":case"w":return this.moving_up=!0,!0;case"ArrowDown":case"s":return this.moving_down=!0,!0;default:return!1}}handle_keyup(t){switch(t){case"Shift":return this.pressing_shift=!1,!0;case"Control":return this.pressing_ctrl=!1,!0;case"Alt":return this.pressing_alt=!1,!0;case"ArrowLeft":case"a":return this.moving_left=!1,!0;case"ArrowRight":case"d":return this.moving_right=!1,!0;case"ArrowUp":case"w":return this.moving_up=!1,!0;case"ArrowDown":case"s":return this.moving_down=!1,!0;default:return!1}}handle_gamepad_connected(t){console.log("[controller] handle_gamepad_connected gamepad",t),this.connected_gamepads.add(t.index)}handle_gamepad_disconnected(t){console.log("[controller] handle_gamepad_disconnected gamepad",t),this.connected_gamepads.delete(t.index)}reset(){this.moving_left=!1,this.moving_right=!1,this.moving_up=!1,this.moving_down=!1,this.teleporting_x=null,this.teleporting_y=null,this.pressing_shift=!1,this.pressing_ctrl=!1,this.pressing_alt=!1,this.just_pressed_button_a=!1,this.just_pressed_button_b=!1,this.just_pressed_button_x=!1,this.just_pressed_button_y=!1,this.pressing_button_a=!1,this.pressing_button_b=!1,this.pressing_button_x=!1,this.pressing_button_y=!1}}mt=new WeakMap,ft=new WeakMap,dt=new WeakMap,vt=new WeakMap,gt=new WeakMap,pt=new WeakMap,bt=new WeakMap,xt=new WeakMap,yt=new WeakMap,wt=new WeakMap,kt=new WeakMap,jt=new WeakMap,Bt=new WeakSet,oe=function(){if(!this.connected_gamepads.size)return;const t=navigator.getGamepads();for(const e of t){if(!e)continue;const[r,n]=e.axes;this.gamepad_moving_x=Math.abs(r)>this.gamepad_axis_sensitivity?r:0,this.gamepad_moving_y=Math.abs(n)>this.gamepad_axis_sensitivity?n:0;const[o,s,_,d]=e.buttons;this.just_pressed_button_a=o.pressed?!this.pressing_button_a:!1,this.just_pressed_button_b=s.pressed?!this.pressing_button_b:!1,this.just_pressed_button_x=_.pressed?!this.pressing_button_x:!1,this.just_pressed_button_y=d.pressed?!this.pressing_button_y:!1,this.pressing_button_a=o.pressed,this.pressing_button_b=s.pressed,this.pressing_button_x=_.pressed,this.pressing_button_y=d.pressed}};const sn=Oe(),_n={show_main_menu:()=>!1},$t=h=>(console.log("[parse_app_json]",h),{show_main_menu:typeof(h==null?void 0:h.show_main_menu)=="boolean"?h.show_main_menu:_n.show_main_menu()}),te="app";var Ct,At;const Ut=class Ut{constructor(t){a(this,"clock");a(this,"renderer");a(this,"simulation");a(this,"collisions");a(this,"controller");L(this,Ct,A(!1));L(this,At,D(()=>De(this)));a(this,"toggle_main_menu",()=>{this.show_main_menu?this.close_main_menu():this.open_main_menu()});a(this,"open_main_menu",()=>{this.show_main_menu=!0});a(this,"close_main_menu",()=>{this.show_main_menu=!1});console.log("[app] new with options",t);const{renderer:e,clock:r=new Be,simulation:n=new en(new $e),controller:o=new nn,app_json:s=Ut.load()}=t;this.renderer=e,this.clock=r,this.collisions=n.collisions,this.simulation=n,this.controller=o,console.log("[app] app_json",s),this.set_json(s)}get show_main_menu(){return i(g(this,Ct))}set show_main_menu(t){x(g(this,Ct),t,!0)}get json(){return i(g(this,At))}set json(t){x(g(this,At),t)}toJSON(){return{show_main_menu:this.show_main_menu}}set_json(t){console.log("[app] set_json",t),this.show_main_menu=t.show_main_menu}save(t=this.json){console.log("[app] save"),Ke(te,t)}static load(t=te){return console.log("[app] loading app"),Re(t,()=>$t(null),$t,!0)}};Ct=new WeakMap,At=new WeakMap;let ee=Ut;function on(h,t){at(t,!0);const e=H(t,"app",19,()=>sn.get()),r=D(()=>{let n=[{snippet:"text",props:{content:"Main menu",icon:"?",run:()=>{e().toggle_main_menu()}}},{snippet:"text",props:{content:"Reload",icon:"âŸ³",run:()=>{location.reload()}}}];return t.contextmenu_params_before&&(Array.isArray(t.contextmenu_params_before)?n=t.contextmenu_params_before.concat(n):n.unshift(t.contextmenu_params_before)),t.contextmenu_params_after&&(Array.isArray(t.contextmenu_params_after)?n=n.concat(t.contextmenu_params_after):n.push(t.contextmenu_params_after)),n});R(xe.body,(n,o)=>{var s;return(s=He)==null?void 0:s(n,o)},()=>i(r)),rt()}function an(h,t){at(t,!0);const e=ie.get(),r=o=>{if(!Qt(o.target))return;const{key:s,ctrlKey:_,altKey:d}=o;if(s===" "){e.clock.toggle(),Y(o);return}else if(s==="r"&&!_){e.project.scene.reset(),Y(o);return}else if(s==="`"&&!_&&!d){e.toggle_playing(),Y(o);return}else if(s==="~"&&!_&&!d){e.editing=!e.editing,Y(o);return}t.controller.handle_keydown(s)&&Y(o)},n=o=>{Qt(o.target)&&t.controller.handle_keyup(o.key)&&Y(o)};Lt("keydown",T,r),Lt("keyup",T,n),rt()}function rn(h,t){at(t,!0),Lt("gamepadconnected",T,e=>{t.controller.handle_gamepad_connected(e.gamepad)}),Lt("gamepaddisconnected",T,e=>{t.controller.handle_gamepad_disconnected(e.gamepad)}),rt()}var ln=Z("<!> <!>",1);function cn(h,t){at(t,!0);const e=H(t,"controller",19,()=>ie.get().controller);var r=ln(),n=q(r);an(n,{get controller(){return e()}});var o=ot(n,2);rn(o,{get controller(){return e()}}),M(h,r),rt()}var hn=Z("<!> <!> <!>",1);function wn(h,t){Je(h,{children:(e,r)=>{var n=hn(),o=q(n);{var s=u=>{var E=Q(),p=q(E);F(p,()=>t.global_controls),M(u,E)},_=u=>{cn(u,{})};X(o,u=>{t.global_controls?u(s):u(_,!1)})}var d=ot(o,2);{var v=u=>{var E=Q(),p=q(E);F(p,()=>t.app_contextmenu),M(u,E)},m=u=>{on(u,{})};X(d,u=>{t.app_contextmenu?u(v):u(m,!1)})}var w=ot(d,2);F(w,()=>t.children),M(e,n)},$$slots:{default:!0}})}export{ee as A,nn as C,wn as D,en as S,sn as a,$e as b,Zt as c,on as d};
