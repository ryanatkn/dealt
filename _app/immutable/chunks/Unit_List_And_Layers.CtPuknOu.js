import{a as _,t as y,b as S,c as qe}from"./disclose-version.Ds06f9Vu.js";import{q as A,v as J,s as p,m as I,o as H,c as n,r,K as f,L as Z,a0 as re,W as O,u as me,D as Se,n as U}from"./runtime.5k9ShzZt.js";import{d as te,s as he,k as le}from"./render.CAjsxhF5.js";import{s as Q,t as ee,r as X,e as ve,b as ne,h as _e,i as ze}from"./string.25aLtQ0-.js";import{p as N,i as R,c as ie}from"./props.lofZ2jro.js";import{t as Y,s as $}from"./index.DteDSzYE.js";import{e as be,f as ye,U as fe,u as Ce,v as Ee,H as De,G as Oe,x as Ae}from"./renderer_components.BBKIkb5V.js";import{U as xe,d as we,c as z}from"./Help_Button.BTNV0Dwq.js";import{s as He}from"./snippet.CcawutmI.js";var Me=(o,t)=>{t.editor.collapsed_layers.clear()},Ge=(o,t,e)=>{for(const a of t.units)e.editor.collapsed_layers.add(a)},Re=y('<button type="button" class="plain">expand all</button> <button type="button" class="plain">collapse all</button>',1);function Ne(o,t){A(t,!0);const{scene:e}=t.editor.project;var a=Re(),d=J(a);d.__click=[Me,t];var s=p(d,2);s.__click=[Ge,e,t],I(()=>{d.disabled=!t.editor.collapsed_layers.size,s.disabled=t.editor.collapsed_layers.size===e.units.length}),_(o,a),H()}te(["click"]);var Ve=(o,t,e)=>t.set(e()),We=y('<input class="unit_name plain svelte-znqd6i" placeholder="name">'),Ke=y('<div class="unit_name svelte-znqd6i"> </div>'),Ye=y('<li role="none" class="unit_list_item plain svelte-znqd6i"><label class="flex_1 row mb_0 pr_lg"><div class="unit_type svelte-znqd6i"><!></div> <!></label></li>');function $e(o,t){A(t,!0);const e=N(t,"unit",7),{unit_selection:a}=be.get(),d=Z(()=>a.has(e()));var s=Ye();s.__pointerdown=[Ve,a,e];var v=n(s),i=n(v),m=n(i);xe(m,{get unit(){return e()}}),r(i);var u=p(i,2);{var x=l=>{var c=We();X(c),ye(c,()=>e().name,g=>e().name=g),_(l,c)},k=l=>{var c=Ke(),g=n(c,!0);r(c),I(()=>he(g,e().name)),_(l,c)};R(u,l=>{f(d)?l(x):l(k,!1)})}r(v),r(s),I(()=>{Q(s,"id",`unit_list_item_${e().id??""}`),ee(s,"selected",f(d))}),Y(3,s,()=>$),_(o,s),H()}te(["pointerdown"]);var Fe=y('<div class="list_item svelte-1ukt32m" draggable="true"><!></div>'),Je=y('<div class="drop_indicator svelte-1ukt32m"></div>'),Qe=y('<div class="reorderable_list svelte-1ukt32m"><ul class="unstyled"></ul> <!></div>');function Xe(o,t){A(t,!0);let e=re(null),a=re(null),d=re(null);const s=l=>{if(l.preventDefault(),f(e)===null||!l.currentTarget||!l.dataTransfer)return;const c=l.currentTarget,g=Array.from(c.children),b=g.map(B=>B.getBoundingClientRect()),w=c.getBoundingClientRect(),V=l.clientY;let M=b.findIndex(B=>V<(B.bottom+B.top)/2);if(M===-1){if(M=g.length,g.length>0){const B=b[g.length-1];O(d,B.bottom-w.top)}}else O(d,b[M].top-w.top);M>f(e)&&M--,O(a,ie(M)),l.dataTransfer.dropEffect="move"},v=l=>{var c;l.preventDefault(),((c=l.dataTransfer)==null?void 0:c.dropEffect)==="move"&&f(e)!==null&&f(a)!==null&&f(e)!==f(a)&&t.on_reorder(f(e),f(a)),O(e,null),O(a,null),O(d,null)},i=l=>{if(!l.dataTransfer)return;const g=l.target.closest("[data-item]");if(!g)return;const b=parseInt(g.dataset.item??"",10);b&&(l.dataTransfer.effectAllowed="move",O(e,ie(t.items.findIndex(w=>w.id===b))))};var m=Qe(),u=n(m);ve(u,22,()=>t.items,l=>l,(l,c,g)=>{var b=Fe(),w=n(b);He(w,()=>t.children,()=>c),r(b),I(()=>{Q(b,"data-item",c.id),ee(b,"dragging",f(g)===f(e))}),_(l,b)}),r(u);var x=p(u,2);{var k=l=>{var c=Je();I(()=>ne(c,"top",`${f(d)??""}px`)),_(l,c)};R(x,l=>{f(d)!==null&&l(k)})}r(m),le("dragover",u,s),le("dragend",u,v),le("dragstart",u,i),_(o,m),H()}var Ze=y('<div class="unit_list svelte-xyjzex"><!></div>');function et(o,t){A(t,!0),N(t,"scroll_on_select",3,!0)()&&me(()=>{var v;const{latest:s}=t.project.editor.unit_selection;s&&((v=document.getElementById("unit_list_item_"+s.id))==null||v.scrollIntoView({block:"nearest"}))});var a=Ze(),d=n(a);Xe(d,{get items(){return t.project.scene.units},on_reorder:(v,i)=>t.project.scene.move_unit(v,i),children:(v,i=Se)=>{we(v,{get scene(){return t.project.scene},get unit(){return i()},children:(m,u)=>{$e(m,{get unit(){return i()}})},$$slots:{default:!0}})},$$slots:{default:!0}}),r(a),_(o,a),H()}var tt=y('<div class="unit_palette svelte-1qh4yco"><button type="button" title="add circle" class="svelte-1qh4yco">add circle ⬤</button> <button type="button" title="add polygon" class="svelte-1qh4yco">add polygon ▰</button></div>');function at(o,t){A(t,!0);const e=N(t,"add_unit",3,u=>t.scene.add_unit(u));let a=0;const d=()=>{e()(new fe(t.scene,{type:"circle",x:100+Math.cos(a)*((a+10)*2),y:100+Math.sin(a)*((a+10)*2),radius:10})),a++},s=()=>{e()(new fe(t.scene,{type:"polygon",x:100+Math.cos(a)*((a+10)*2),y:100+Math.sin(a)*((a+10)*2),angle:a*.8,points:[{x:-20,y:12},{x:30,y:-15},{x:17,y:17}]})),a++};var v=tt(),i=n(v);i.__click=d;var m=p(i,2);m.__click=s,r(v),_(o,v),H()}te(["click"]);var rt=(o,t)=>{o.currentTarget.checked?t().add_behavior(new Ee):t().remove_behavior("Player_Controller_Behavior")},lt=(o,t)=>{o.currentTarget.checked?t().add_behavior(new De):t().remove_behavior("Harmful_Behavior")},nt=(o,t)=>{o.currentTarget.checked?t().add_behavior(new Oe):t().remove_behavior("Goal_Behavior")},st=y('<div class="w_100 mt_lg flex gap_lg justify_content_end flex_wrap"><label class="row mb_0" title="use WASD to move the player"><input type="checkbox"> player controls</label> <label class="row mb_0" title="causes damage to the player"><input type="checkbox"> harmful</label> <label class="row mb_0" title="the player touches this unit to win"><input type="checkbox"> goal</label> <label class="row mb_0" title="the unit is a goner"><input type="checkbox"> dead</label></div>');function it(o,t){A(t,!0);const e=N(t,"unit",7);var a=st(),d=n(a),s=n(d);X(s),I(()=>_e(s,e().behaviors.has("Player_Controller_Behavior"))),s.__change=[rt,e],U(),r(d);var v=p(d,2),i=n(v);X(i),I(()=>_e(i,e().behaviors.has("Harmful_Behavior"))),i.__change=[lt,e],U(),r(v);var m=p(v,2),u=n(m);X(u),I(()=>_e(u,e().behaviors.has("Goal_Behavior"))),u.__change=[nt,e],U(),r(m);var x=p(m,2),k=n(x);X(k),U(),r(x),r(a),Ce(k,()=>e().dead,l=>e().dead=l),_(o,a),H()}te(["change"]);var ot=(o,t,e,a)=>{t.unit.remove_point(e),a().renderer.dirty++},dt=y('<li class="row"><div class="flex_1 row justify_content_end"><!> <!></div> <button type="button" class="icon_button plain ml_md" title="remove point">✕</button></li>'),ct=y('<ul class="unstyled"></ul>');function _t(o,t){A(t,!0);const e=N(t,"project",7),a=.5,d=Z(()=>t.unit.points.length<=3);var s=ct();ve(s,22,()=>t.unit.points,v=>v,(v,i,m)=>{var u=dt(),x=n(u);ne(x,"--title_width","3.4rem");var k=n(x);z(k,{get title(){return`polygon.points[${f(m)??""}].x`},classes:"mb_0",input_classes:"plain",row:!0,get value(){return i.x},oninput:g=>{i.x=g,t.unit.update_points(),e().renderer.dirty++},step:a,children:(g,b)=>{U();var w=S("x");_(g,w)},$$slots:{default:!0}});var l=p(k,2);z(l,{get title(){return`polygon.points[${f(m)??""}].y`},classes:"mb_0",input_classes:"plain",row:!0,get value(){return i.y},oninput:g=>{i.y=g,t.unit.update_points(),e().renderer.dirty++},step:a,children:(g,b)=>{U();var w=S("y");_(g,w)},$$slots:{default:!0}}),r(x);var c=p(x,2);c.__pointerup=[ot,t,i,e],r(u),I(()=>c.disabled=f(d)),Y(3,u,()=>$),_(v,u)}),r(s),_(o,s),H()}te(["pointerup"]);const vt=(o,t,e)=>{t.has(e())?t.delete(e()):t.add(e())};var ut=(o,t,e)=>t.set(e()),pt=y('<div class="input_row svelte-ffu65v"><!> <!></div> <div class="input_row svelte-ffu65v"><!></div> <div class="input_row svelte-ffu65v"><!></div>',1),gt=(o,t,e)=>{t().add_point(new Ae(120,200)),e().renderer.dirty++},ft=y('<div class="input_row svelte-ffu65v"><!> <!></div> <div class="input_row svelte-ffu65v"><!></div> <div class="input_row mb_md svelte-ffu65v"><!></div> <!> <button type="button" title="add a point to this polygon" class="plain justify_self_end">add point ◎</button>',1),mt=y('<div><div class="py_sm"><button type="button" class="inline color_g selected white_space_nowrap" title="this polygon intersects itself - collision detection is disabled">self-intersecting</button></div></div>'),ht=(o,t)=>{alert(`TODO this button should present choices for decomposing the concave polygon into ${t().decomped.length} convex ones`)},bt=y('<div><div class="py_sm"><button type="button" class="inline color_d selected deselectable white_space_nowrap">concave</button></div></div>'),yt=y('<div class="row gap_sm"><!> <!></div>'),xt=y('<div><div class="row pb_sm pt_md"><div class="pr_md text_align_right font_weight_600 input_width_sm">id</div> <small> </small></div> <!></div> <!> <!>',1),wt=y('<li class="unit_layer svelte-ffu65v" role="none"><header class="row gap_xs2 svelte-ffu65v"><div class="unit_layer_type svelte-ffu65v"><button type="button" class="plain"><div class="row"><div class="chevron svelte-ffu65v"></div> <!></div></button></div> <input class="name_input plain svelte-ffu65v" placeholder="name"></header> <!></li>');function kt(o,t){A(t,!0);const e=N(t,"unit",7),a=N(t,"project",7),{unit_selection:d,collapsed_layers:s}=be.get(),v=Z(()=>s.has(e())),i=.5,m=.1;var u=wt();u.__pointerdown=[ut,d,e];const x=Z(()=>d.has(e()));var k=n(u),l=n(k),c=n(l);c.__click=[vt,s,e];var g=n(c),b=p(n(g),2);xe(b,{get unit(){return e()}}),r(g),r(c),r(l);var w=p(l,2);X(w),r(k);var V=p(k,2);{var M=B=>{var ue=xt(),se=J(ue),oe=n(se),de=p(n(oe),2);ne(de,"padding","var(--input_padding_y) var(--input_padding_x)");var ke=n(de,!0);r(de),r(oe);var je=p(oe,2);{var Pe=q=>{var C=pt(),E=J(C);ne(E,"--title_width","3.4rem");var F=n(E);z(F,{title:"circle x",input_classes:"plain",row:!0,step:i,get value(){return e().x},set value(h){e().x=h},children:(h,ae)=>{U();var L=S("x");_(h,L)},$$slots:{default:!0}});var W=p(F,2);z(W,{title:"circle y",input_classes:"plain",row:!0,step:i,get value(){return e().y},set value(h){e().y=h},children:(h,ae)=>{U();var L=S("y");_(h,L)},$$slots:{default:!0}}),r(E);var G=p(E,2),T=n(G);z(T,{title:"circle scale",input_classes:"plain",row:!0,step:.01,get value(){return e().scale},set value(h){e().scale=h},children:(h,ae)=>{U();var L=S("scale");_(h,L)},$$slots:{default:!0}}),r(G);var j=p(G,2),D=n(j);z(D,{title:"circle radius",input_classes:"plain",row:!0,min:0,step:m,get value(){return e().radius},set value(h){e().radius=h},children:(h,ae)=>{U();var L=S("radius");_(h,L)},$$slots:{default:!0}}),r(j),_(q,C)},Te=q=>{var C=qe(),E=J(C);{var F=W=>{var G=ft(),T=J(G);ne(T,"--title_width","3.4rem");var j=n(T);z(j,{title:"polygon x",input_classes:"plain",row:!0,step:i,get value(){return e().x},set value(P){e().x=P},children:(P,ce)=>{U();var K=S("x");_(P,K)},$$slots:{default:!0}});var D=p(j,2);z(D,{title:"polygon y",input_classes:"plain",row:!0,step:i,get value(){return e().y},set value(P){e().y=P},children:(P,ce)=>{U();var K=S("y");_(P,K)},$$slots:{default:!0}}),r(T);var h=p(T,2),ae=n(h);z(ae,{title:"polygon angle",input_classes:"plain",row:!0,step:Math.PI/360,get value(){return e().angle},set value(P){e().angle=P},children:(P,ce)=>{U();var K=S("angle");_(P,K)},$$slots:{default:!0}}),r(h);var L=p(h,2),Be=n(L);z(Be,{title:"polygon scale",input_classes:"plain",row:!0,step:.01,get value(){return e().scale},set value(P){e().scale=P},children:(P,ce)=>{U();var K=S("scale");_(P,K)},$$slots:{default:!0}}),r(L);var ge=p(L,2);_t(ge,{get unit(){return e()},get project(){return a()}});var Le=p(ge,2);Le.__click=[gt,e,a],_(W,G)};R(E,W=>{e().type==="polygon"&&W(F)},!0)}_(q,C)};R(je,q=>{e().type==="circle"?q(Pe):q(Te,!1)})}r(se);var pe=p(se,2);{var Ue=q=>{var C=yt(),E=n(C);{var F=T=>{var j=mt(),D=n(j);r(j),Y(3,D,()=>$),Y(3,j,()=>$,()=>({axis:"x"})),_(T,j)};R(E,T=>{e().is_simple_polygon||T(F)})}var W=p(E,2);{var G=T=>{var j=bt(),D=n(j),h=n(D);h.__click=[ht,e],r(D),r(j),I(()=>Q(h,"title",`this polygon is concave, and can be decomposed into ${e().decomped.length??""} convex polygons`)),Y(3,D,()=>$),Y(3,j,()=>$,()=>({axis:"x"})),_(T,j)};R(W,T=>{e().concave&&T(G)})}r(C),_(q,C)};R(pe,q=>{e().type==="polygon"&&q(Ue)})}var Ie=p(pe,2);it(Ie,{get unit(){return e()}}),I(()=>he(ke,e().id)),Y(3,se,()=>$),_(B,ue)};R(V,B=>{f(v)||B(M)})}r(u),I(()=>{Q(u,"id",`unit_layer_${e().id??""}`),ee(u,"collapsed",f(v)),ee(u,"selected",f(x)),Q(c,"title",e().type),Q(w,"title",`${e().type??""} name`)}),ye(w,()=>e().name,B=>e().name=B),_(o,u),H()}te(["pointerdown","click"]);var jt=y('<ul class="unit_layers unstyled"></ul>');function Pt(o,t){A(t,!0),N(t,"scroll_on_select",3,!0)()&&me(()=>{var s;const{latest:d}=t.project.editor.unit_selection;d&&((s=document.getElementById("unit_layer_"+d.id))==null||s.scrollIntoView({block:"nearest"}))});var a=jt();ve(a,21,()=>t.project.scene.units,ze,(d,s)=>{we(d,{get scene(){return t.project.scene},get unit(){return f(s)},children:(v,i)=>{kt(v,{get project(){return t.project},get unit(){return f(s)}})},$$slots:{default:!0}})}),r(a),_(o,a),H()}var Tt=y('<div class="column svelte-175igsh"><div class="column_panel svelte-175igsh"><!></div> <div class="p_lg"><!></div></div> <div class="column svelte-175igsh"><div class="unit_layers_controls svelte-175igsh"><!></div> <div class="column_panel svelte-175igsh"><!></div></div>',1);function Dt(o,t){const e=Z(()=>t.project.scene),a=Z(()=>t.project.editor);let d=re(0),s=re(0);var v=Tt(),i=J(v),m=n(i),u=n(m);et(u,{get project(){return t.project}}),r(m);var x=p(m,2),k=n(x);at(k,{get scene(){return f(e)}}),r(x),r(i);var l=p(i,2),c=n(l),g=n(c);Ne(g,{get editor(){return f(a)}}),r(c);var b=p(c,2),w=n(b);Pt(w,{get project(){return t.project}}),r(b),r(l),I(()=>{ee(i,"scrolled",f(d)>0),ee(b,"scrolled",f(s)>0)}),le("scroll",i,V=>{O(d,ie(V.currentTarget.scrollTop))}),le("scroll",b,V=>{O(s,ie(V.currentTarget.scrollTop))}),_(o,v)}export{Dt as U,Ne as a};
