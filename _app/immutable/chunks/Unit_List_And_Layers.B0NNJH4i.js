import{a as _,t as b,b as S,c as Le}from"./disclose-version.Ds06f9Vu.js";import{q as A,v as F,s as p,m as U,o as H,c as n,r,K as g,L as X,a0 as re,W as O,u as fe,D as qe,n as j}from"./runtime.5k9ShzZt.js";import{d as ee,s as me,k as le}from"./render.CAjsxhF5.js";import{s as J,t as Z,r as Q,e as ve,b as ne,h as _e,i as Se}from"./string.25aLtQ0-.js";import{p as te,i as G,c as se}from"./props.lofZ2jro.js";import{t as W,s as K}from"./index.DteDSzYE.js";import{e as he,f as be,U as ge,u as ze,v as Ce,H as Ee,G as $e,x as De}from"./renderer_components.DC7U4vDT.js";import{U as ye,d as xe,c as z}from"./Help_Button.DhQof_K7.js";import{s as Oe}from"./snippet.CcawutmI.js";var Ae=(c,t)=>{t.editor.collapsed_layers.clear()},He=(c,t,e)=>{for(const a of t.units)e.editor.collapsed_layers.add(a)},Me=b('<button type="button" class="plain">expand all</button> <button type="button" class="plain">collapse all</button>',1);function Ge(c,t){A(t,!0);const{scene:e}=t.editor.project;var a=Me(),s=F(a);s.__click=[Ae,t];var i=p(s,2);i.__click=[He,e,t],U(()=>{s.disabled=!t.editor.collapsed_layers.size,i.disabled=t.editor.collapsed_layers.size===e.units.length}),_(c,a),H()}ee(["click"]);var Re=(c,t,e)=>t.set(e()),Ne=b('<input class="unit_name plain svelte-znqd6i" placeholder="name">'),Ve=b('<div class="unit_name svelte-znqd6i"> </div>'),We=b('<li role="none" class="unit_list_item plain svelte-znqd6i"><label class="flex_1 row mb_0 pr_lg"><div class="unit_type svelte-znqd6i"><!></div> <!></label></li>');function Ke(c,t){A(t,!0);const e=te(t,"unit",7),{unit_selection:a}=he.get(),s=X(()=>a.has(e()));var i=We();i.__pointerdown=[Re,a,e];var o=n(i),u=n(o),v=n(u);ye(v,{get unit(){return e()}}),r(u);var m=p(u,2);{var x=l=>{var d=Ne();Q(d),be(d,()=>e().name,y=>e().name=y),_(l,d)},P=l=>{var d=Ve(),y=n(d,!0);r(d),U(()=>me(y,e().name)),_(l,d)};G(m,l=>{g(s)?l(x):l(P,!1)})}r(o),r(i),U(()=>{J(i,"id",`unit_list_item_${e().id??""}`),Z(i,"selected",g(s))}),W(3,i,()=>K),_(c,i),H()}ee(["pointerdown"]);var Ye=b('<div class="list_item svelte-1ukt32m" draggable="true"><!></div>'),Fe=b('<div class="drop_indicator svelte-1ukt32m"></div>'),Je=b('<div class="reorderable_list svelte-1ukt32m"><ul class="unstyled"></ul> <!></div>');function Qe(c,t){A(t,!0);let e=re(null),a=re(null),s=re(null);const i=l=>{if(l.preventDefault(),g(e)===null||!l.currentTarget||!l.dataTransfer)return;const d=l.currentTarget,y=Array.from(d.children),f=y.map(C=>C.getBoundingClientRect()),L=d.getBoundingClientRect(),R=l.clientY;let I=f.findIndex(C=>R<(C.bottom+C.top)/2);if(I===-1){if(I=y.length,y.length>0){const C=f[y.length-1];O(s,C.bottom-L.top)}}else O(s,f[I].top-L.top);I>g(e)&&I--,O(a,se(I)),l.dataTransfer.dropEffect="move"},o=l=>{var d;l.preventDefault(),((d=l.dataTransfer)==null?void 0:d.dropEffect)==="move"&&g(e)!==null&&g(a)!==null&&g(e)!==g(a)&&t.on_reorder(g(e),g(a)),O(e,null),O(a,null),O(s,null)},u=l=>{if(!l.dataTransfer)return;const y=l.target.closest("[data-item]");if(!y)return;const f=parseInt(y.dataset.item??"",10);f&&(l.dataTransfer.effectAllowed="move",O(e,se(t.items.findIndex(L=>L.id===f))))};var v=Je(),m=n(v);ve(m,22,()=>t.items,l=>l,(l,d,y)=>{var f=Ye(),L=n(f);Oe(L,()=>t.children,()=>d),r(f),U(()=>{J(f,"data-item",d.id),Z(f,"dragging",g(y)===g(e))}),_(l,f)}),r(m);var x=p(m,2);{var P=l=>{var d=Fe();U(()=>ne(d,"top",`${g(s)??""}px`)),_(l,d)};G(x,l=>{g(s)!==null&&l(P)})}r(v),le("dragover",m,i),le("dragend",m,o),le("dragstart",m,u),_(c,v),H()}var Xe=b('<div class="unit_list svelte-xyjzex"><!></div>');function Ze(c,t){A(t,!0),te(t,"scroll_on_select",3,!0)()&&fe(()=>{var o;const{latest:i}=t.project.editor.unit_selection;i&&((o=document.getElementById("unit_list_item_"+i.id))==null||o.scrollIntoView({block:"nearest"}))});var a=Xe(),s=n(a);Qe(s,{get items(){return t.project.scene.units},on_reorder:(o,u)=>t.project.scene.move_unit(o,u),children:(o,u=qe)=>{xe(o,{get scene(){return t.project.scene},get unit(){return u()},children:(v,m)=>{Ke(v,{get unit(){return u()}})},$$slots:{default:!0}})},$$slots:{default:!0}}),r(a),_(c,a),H()}var et=b('<div class="unit_palette svelte-1qh4yco"><button type="button" title="add circle" class="svelte-1qh4yco">add circle ⬤</button> <button type="button" title="add polygon" class="svelte-1qh4yco">add polygon ▰</button></div>');function tt(c,t){A(t,!0);const e=te(t,"add_unit",3,m=>t.scene.add_unit(m));let a=0;const s=()=>{e()(new ge(t.scene,{type:"circle",x:100+Math.cos(a)*((a+10)*2),y:100+Math.sin(a)*((a+10)*2),radius:10})),a++},i=()=>{e()(new ge(t.scene,{type:"polygon",x:100+Math.cos(a)*((a+10)*2),y:100+Math.sin(a)*((a+10)*2),rotation:a*.8,points:[{x:-20,y:12},{x:30,y:-15},{x:17,y:17}]})),a++};var o=et(),u=n(o);u.__click=s;var v=p(u,2);v.__click=i,r(o),_(c,o),H()}ee(["click"]);var at=(c,t)=>{c.currentTarget.checked?t().add_behavior(new Ce):t().remove_behavior("Player_Controller_Behavior")},rt=(c,t)=>{c.currentTarget.checked?t().add_behavior(new Ee):t().remove_behavior("Harmful_Behavior")},lt=(c,t)=>{c.currentTarget.checked?t().add_behavior(new $e):t().remove_behavior("Goal_Behavior")},nt=b('<div class="w_100 mt_lg flex gap_lg justify_content_end flex_wrap"><label class="row mb_0" title="use WASD to move the player"><input type="checkbox"> player controls</label> <label class="row mb_0" title="causes damage to the player"><input type="checkbox"> harmful</label> <label class="row mb_0" title="the player touches this unit to win"><input type="checkbox"> goal</label> <label class="row mb_0" title="the unit is a goner"><input type="checkbox"> dead</label></div>');function it(c,t){A(t,!0);const e=te(t,"unit",7);var a=nt(),s=n(a),i=n(s);Q(i),U(()=>_e(i,e().behaviors.has("Player_Controller_Behavior"))),i.__change=[at,e],j(),r(s);var o=p(s,2),u=n(o);Q(u),U(()=>_e(u,e().behaviors.has("Harmful_Behavior"))),u.__change=[rt,e],j(),r(o);var v=p(o,2),m=n(v);Q(m),U(()=>_e(m,e().behaviors.has("Goal_Behavior"))),m.__change=[lt,e],j(),r(v);var x=p(v,2),P=n(x);Q(P),j(),r(x),r(a),ze(P,()=>e().dead,l=>e().dead=l),_(c,a),H()}ee(["change"]);var st=(c,t,e)=>{t.unit.remove_point(e)},ot=b('<li class="row"><div class="flex_1 row justify_content_end"><!> <!></div> <button type="button" class="icon_button plain ml_md" title="remove point">✕</button></li>'),dt=b('<ul class="unstyled"></ul>');function ct(c,t){A(t,!0);const e=.5,a=X(()=>t.unit.points.length<=3);var s=dt();ve(s,22,()=>t.unit.points,i=>i,(i,o,u)=>{var v=ot(),m=n(v);ne(m,"--title_width","3.4rem");var x=n(m);z(x,{get title(){return`polygon.points[${g(u)??""}].x`},classes:"mb_0",input_classes:"plain",row:!0,get value(){return o.x},oninput:d=>{o.x=d,t.unit.update_points()},step:e,children:(d,y)=>{j();var f=S("x");_(d,f)},$$slots:{default:!0}});var P=p(x,2);z(P,{get title(){return`polygon.points[${g(u)??""}].y`},classes:"mb_0",input_classes:"plain",row:!0,get value(){return o.y},oninput:d=>{o.y=d,t.unit.update_points()},step:e,children:(d,y)=>{j();var f=S("y");_(d,f)},$$slots:{default:!0}}),r(m);var l=p(m,2);l.__pointerup=[st,t,o],r(v),U(()=>l.disabled=g(a)),W(3,v,()=>K),_(i,v)}),r(s),_(c,s),H()}ee(["pointerup"]);const _t=(c,t,e)=>{t.has(e())?t.delete(e()):t.add(e())};var vt=(c,t,e)=>t.set(e()),ut=b('<div class="input_row svelte-ffu65v"><!> <!></div> <div class="input_row svelte-ffu65v"><!></div> <div class="input_row svelte-ffu65v"><!></div>',1),pt=(c,t)=>{t().add_point(new De(120,200))},gt=b('<div class="input_row svelte-ffu65v"><!> <!></div> <div class="input_row svelte-ffu65v"><!></div> <div class="input_row mb_md svelte-ffu65v"><!></div> <!> <button type="button" title="add a point to this polygon" class="plain justify_self_end">add point ◎</button>',1),ft=b('<div><div class="py_sm"><button type="button" class="inline color_g selected white_space_nowrap" title="this polygon intersects itself - collision detection is disabled">self-intersecting</button></div></div>'),mt=(c,t)=>{alert(`TODO automatically decompose the concave polygon into ${t().decomped.length} convex ones, need to support multiple bodies per unit`)},ht=b('<div><div class="py_sm"><button type="button" class="inline color_d selected deselectable white_space_nowrap">concave</button></div></div>'),bt=b('<div class="row gap_sm"><!> <!></div>'),yt=b('<div><div class="row pb_sm pt_md"><div class="pr_md text_align_right font_weight_600 input_width_sm">id</div> <small> </small></div> <!></div> <!> <!>',1),xt=b('<li class="unit_layer svelte-ffu65v" role="none"><header class="row gap_xs2 svelte-ffu65v"><div class="unit_layer_type svelte-ffu65v"><button type="button" class="plain"><div class="row"><div class="chevron svelte-ffu65v"></div> <!></div></button></div> <input class="name_input plain svelte-ffu65v" placeholder="name"></header> <!></li>');function wt(c,t){A(t,!0);const e=te(t,"unit",7),{unit_selection:a,collapsed_layers:s}=he.get(),i=X(()=>s.has(e())),o=.5,u=.1;var v=xt();v.__pointerdown=[vt,a,e];const m=X(()=>a.has(e()));var x=n(v),P=n(x),l=n(P);l.__click=[_t,s,e];var d=n(l),y=p(n(d),2);ye(y,{get unit(){return e()}}),r(d),r(l),r(P);var f=p(P,2);Q(f),r(x);var L=p(x,2);{var R=I=>{var C=yt(),ie=F(C),oe=n(ie),de=p(n(oe),2);ne(de,"padding","var(--input_padding_y) var(--input_padding_x)");var we=n(de,!0);r(de),r(oe);var ke=p(oe,2);{var Pe=q=>{var E=ut(),$=F(E);ne($,"--title_width","3.4rem");var Y=n($);z(Y,{title:"circle x",input_classes:"plain",row:!0,step:o,get value(){return e().x},set value(h){e().x=h},children:(h,ae)=>{j();var B=S("x");_(h,B)},$$slots:{default:!0}});var N=p(Y,2);z(N,{title:"circle y",input_classes:"plain",row:!0,step:o,get value(){return e().y},set value(h){e().y=h},children:(h,ae)=>{j();var B=S("y");_(h,B)},$$slots:{default:!0}}),r($);var M=p($,2),T=n(M);z(T,{title:"circle scale",input_classes:"plain",row:!0,step:.01,get value(){return e().scale},set value(h){e().scale=h},children:(h,ae)=>{j();var B=S("scale");_(h,B)},$$slots:{default:!0}}),r(M);var w=p(M,2),D=n(w);z(D,{title:"circle radius",input_classes:"plain",row:!0,min:0,step:u,get value(){return e().radius},set value(h){e().radius=h},children:(h,ae)=>{j();var B=S("radius");_(h,B)},$$slots:{default:!0}}),r(w),_(q,E)},Te=q=>{var E=Le(),$=F(E);{var Y=N=>{var M=gt(),T=F(M);ne(T,"--title_width","3.4rem");var w=n(T);z(w,{title:"polygon x",input_classes:"plain",row:!0,step:o,get value(){return e().x},set value(k){e().x=k},children:(k,ce)=>{j();var V=S("x");_(k,V)},$$slots:{default:!0}});var D=p(w,2);z(D,{title:"polygon y",input_classes:"plain",row:!0,step:o,get value(){return e().y},set value(k){e().y=k},children:(k,ce)=>{j();var V=S("y");_(k,V)},$$slots:{default:!0}}),r(T);var h=p(T,2),ae=n(h);z(ae,{title:"polygon rotation",input_classes:"plain",row:!0,step:Math.PI/360,get value(){return e().rotation},set value(k){e().rotation=k},children:(k,ce)=>{j();var V=S("rotation");_(k,V)},$$slots:{default:!0}}),r(h);var B=p(h,2),Ie=n(B);z(Ie,{title:"polygon scale",input_classes:"plain",row:!0,step:.01,get value(){return e().scale},set value(k){e().scale=k},children:(k,ce)=>{j();var V=S("scale");_(k,V)},$$slots:{default:!0}}),r(B);var pe=p(B,2);ct(pe,{get unit(){return e()}});var Be=p(pe,2);Be.__click=[pt,e],_(N,M)};G($,N=>{e().type==="polygon"&&N(Y)},!0)}_(q,E)};G(ke,q=>{e().type==="circle"?q(Pe):q(Te,!1)})}r(ie);var ue=p(ie,2);{var je=q=>{var E=bt(),$=n(E);{var Y=T=>{var w=ft(),D=n(w);r(w),W(3,D,()=>K),W(3,w,()=>K,()=>({axis:"x"})),_(T,w)};G($,T=>{e().is_simple_polygon||T(Y)})}var N=p($,2);{var M=T=>{var w=ht(),D=n(w),h=n(D);h.__click=[mt,e],r(D),r(w),U(()=>J(h,"title",`this polygon is concave, and can be decomposed into ${e().decomped.length??""} convex polygons`)),W(3,D,()=>K),W(3,w,()=>K,()=>({axis:"x"})),_(T,w)};G(N,T=>{e().concave&&T(M)})}r(E),_(q,E)};G(ue,q=>{e().type==="polygon"&&q(je)})}var Ue=p(ue,2);it(Ue,{get unit(){return e()}}),U(()=>me(we,e().id)),W(3,ie,()=>K),_(I,C)};G(L,I=>{g(i)||I(R)})}r(v),U(()=>{J(v,"id",`unit_layer_${e().id??""}`),Z(v,"collapsed",g(i)),Z(v,"selected",g(m)),J(l,"title",e().type),J(f,"title",`${e().type??""} name`)}),be(f,()=>e().name,I=>e().name=I),_(c,v),H()}ee(["pointerdown","click"]);var kt=b('<ul class="unit_layers unstyled"></ul>');function Pt(c,t){A(t,!0),te(t,"scroll_on_select",3,!0)()&&fe(()=>{var i;const{latest:s}=t.project.editor.unit_selection;s&&((i=document.getElementById("unit_layer_"+s.id))==null||i.scrollIntoView({block:"nearest"}))});var a=kt();ve(a,21,()=>t.project.scene.units,Se,(s,i)=>{xe(s,{get scene(){return t.project.scene},get unit(){return g(i)},children:(o,u)=>{wt(o,{get unit(){return g(i)}})},$$slots:{default:!0}})}),r(a),_(c,a),H()}var Tt=b('<div class="column svelte-175igsh"><div class="column_panel svelte-175igsh"><!></div> <div class="p_lg"><!></div></div> <div class="column svelte-175igsh"><div class="unit_layers_controls svelte-175igsh"><!></div> <div class="column_panel svelte-175igsh"><!></div></div>',1);function Et(c,t){const e=X(()=>t.project.scene),a=X(()=>t.project.editor);let s=re(0),i=re(0);var o=Tt(),u=F(o),v=n(u),m=n(v);Ze(m,{get project(){return t.project}}),r(v);var x=p(v,2),P=n(x);tt(P,{get scene(){return g(e)}}),r(x),r(u);var l=p(u,2),d=n(l),y=n(d);Ge(y,{get editor(){return g(a)}}),r(d);var f=p(d,2),L=n(f);Pt(L,{get project(){return t.project}}),r(f),r(l),U(()=>{Z(u,"scrolled",g(s)>0),Z(f,"scrolled",g(i)>0)}),le("scroll",u,R=>{O(s,se(R.currentTarget.scrollTop))}),le("scroll",f,R=>{O(i,se(R.currentTarget.scrollTop))}),_(c,o)}export{Et as U,Ge as a};
