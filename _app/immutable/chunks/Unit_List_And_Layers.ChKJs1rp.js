import{a as c,t as m,b as z,c as He}from"./disclose-version.Ds06f9Vu.js";import{q as R,v as X,s as v,m as B,o as V,c as l,r,K as g,L as se,a0 as le,W as H,u as we,D as Me,n as j}from"./runtime.5k9ShzZt.js";import{d as ie,s as ke,k as ne}from"./render.CAjsxhF5.js";import{s as Z,t as te,r as ee,e as me,b as re,h as fe,i as Ge}from"./string.25aLtQ0-.js";import{p as J,i as O,c as _e}from"./props.lofZ2jro.js";import{t as Y,s as F}from"./index.DteDSzYE.js";import{e as je,f as Pe,U as xe,u as Oe,v as Re,H as Ve,G as We,x as Ke}from"./renderer_components.D7vW3J2n.js";import{U as Te,d as Ue,c as C}from"./Help_Button.CrBvpbYP.js";import{s as Ne}from"./snippet.CcawutmI.js";var Ye=(i,t)=>{t.editor.collapsed_layers.clear()},Fe=(i,t,e)=>{for(const a of t.units)e.editor.collapsed_layers.add(a)},Je=m('<button type="button" class="plain">expand all</button> <button type="button" class="plain">collapse all</button>',1);function Qe(i,t){R(t,!0);const{scene:e}=t.editor.project;var a=Je(),o=X(a);o.__click=[Ye,t];var s=v(o,2);s.__click=[Fe,e,t],B(()=>{o.disabled=!t.editor.collapsed_layers.size,s.disabled=t.editor.collapsed_layers.size===e.units.length}),c(i,a),V()}ie(["click"]);var Xe=(i,t,e)=>t.set(e()),Ze=m('<input class="unit_name plain svelte-znqd6i" placeholder="name">'),et=m('<div class="unit_name svelte-znqd6i"> </div>'),tt=m('<li role="none" class="unit_list_item plain svelte-znqd6i"><label class="flex_1 row mb_0 pr_lg"><div class="unit_type svelte-znqd6i"><!></div> <!></label></li>');function at(i,t){R(t,!0);const e=J(t,"unit",7),{unit_selection:a}=je.get(),o=se(()=>a.has(e()));var s=tt();s.__pointerdown=[Xe,a,e];var u=l(s),d=l(u),h=l(d);Te(h,{get unit(){return e()}}),r(d);var p=v(d,2);{var I=n=>{var _=Ze();ee(_),Pe(_,()=>e().name,x=>e().name=x),c(n,_)},P=n=>{var _=et(),x=l(_,!0);r(_),B(()=>ke(x,e().name)),c(n,_)};O(p,n=>{g(o)?n(I):n(P,!1)})}r(u),r(s),B(()=>{Z(s,"id",`unit_list_item_${e().id??""}`),te(s,"selected",g(o))}),Y(3,s,()=>F),c(i,s),V()}ie(["pointerdown"]);var rt=m('<div class="list_item svelte-1ukt32m" draggable="true"><!></div>'),lt=m('<div class="drop_indicator svelte-1ukt32m"></div>'),nt=m('<div class="reorderable_list svelte-1ukt32m"><ul class="unstyled"></ul> <!></div>');function st(i,t){R(t,!0);let e=le(null),a=le(null),o=le(null);const s=n=>{if(n.preventDefault(),g(e)===null||!n.currentTarget||!n.dataTransfer)return;const _=n.currentTarget,x=Array.from(_.children),y=x.map(U=>U.getBoundingClientRect()),T=_.getBoundingClientRect(),W=n.clientY;let M=y.findIndex(U=>W<(U.bottom+U.top)/2);if(M===-1){if(M=x.length,x.length>0){const U=y[x.length-1];H(o,U.bottom-T.top)}}else H(o,y[M].top-T.top);M>g(e)&&M--,H(a,_e(M)),n.dataTransfer.dropEffect="move"},u=n=>{var _;n.preventDefault(),((_=n.dataTransfer)==null?void 0:_.dropEffect)==="move"&&g(e)!==null&&g(a)!==null&&g(e)!==g(a)&&t.on_reorder(g(e),g(a)),H(e,null),H(a,null),H(o,null)},d=n=>{if(!n.dataTransfer)return;const x=n.target.closest("[data-item]");if(!x)return;const y=parseInt(x.dataset.item??"",10);y&&(n.dataTransfer.effectAllowed="move",H(e,_e(t.items.findIndex(T=>T.id===y))))};var h=nt(),p=l(h);me(p,22,()=>t.items,n=>n,(n,_,x)=>{var y=rt(),T=l(y);Ne(T,()=>t.children,()=>_),r(y),B(()=>{Z(y,"data-item",_.id),te(y,"dragging",g(x)===g(e))}),c(n,y)}),r(p);var I=v(p,2);{var P=n=>{var _=lt();B(()=>re(_,"top",`${g(o)??""}px`)),c(n,_)};O(I,n=>{g(o)!==null&&n(P)})}r(h),ne("dragover",p,s),ne("dragend",p,u),ne("dragstart",p,d),c(i,h),V()}var it=m('<div class="unit_list svelte-xyjzex"><!></div>');function ot(i,t){R(t,!0),J(t,"scroll_on_select",3,!0)()&&we(()=>{var u;const{latest:s}=t.project.editor.unit_selection;s&&((u=document.getElementById("unit_list_item_"+s.id))==null||u.scrollIntoView({block:"nearest"}))});var a=it(),o=l(a);st(o,{get items(){return t.project.scene.units},on_reorder:(u,d)=>t.project.scene.move_unit(u,d),children:(u,d=Me)=>{Ue(u,{get scene(){return t.project.scene},get unit(){return d()},children:(h,p)=>{at(h,{get unit(){return d()}})},$$slots:{default:!0}})},$$slots:{default:!0}}),r(a),c(i,a),V()}var dt=m('<div class="unit_palette svelte-1qh4yco"><button type="button" title="add circle" class="svelte-1qh4yco">add circle ⬤</button> <button type="button" title="add polygon" class="svelte-1qh4yco">add polygon ▰</button></div>');function ct(i,t){R(t,!0);const e=J(t,"add_unit",3,p=>t.scene.add_unit(p));let a=0;const o=()=>{e()(new xe(t.scene,{type:"circle",x:100+Math.cos(a)*((a+10)*2),y:100+Math.sin(a)*((a+10)*2),radius:10})),a++},s=()=>{e()(new xe(t.scene,{type:"polygon",x:100+Math.cos(a)*((a+10)*2),y:100+Math.sin(a)*((a+10)*2),angle:a*.8,points:[{x:-20,y:12},{x:30,y:-15},{x:17,y:17}]})),a++};var u=dt(),d=l(u);d.__click=o;var h=v(d,2);h.__click=s,r(u),c(i,u),V()}ie(["click"]);var _t=(i,t)=>{i.currentTarget.checked?t().add_behavior(new Re):t().remove_behavior("Player_Controller_Behavior")},vt=(i,t)=>{i.currentTarget.checked?t().add_behavior(new Ve):t().remove_behavior("Harmful_Behavior")},ut=(i,t)=>{i.currentTarget.checked?t().add_behavior(new We):t().remove_behavior("Goal_Behavior")},pt=m('<div class="w_100 mt_lg flex gap_lg justify_content_end flex_wrap"><label class="row mb_0" title="use WASD to move the player"><input type="checkbox"> player controls</label> <label class="row mb_0" title="causes damage to the player"><input type="checkbox"> harmful</label> <label class="row mb_0" title="the player touches this unit to win"><input type="checkbox"> goal</label> <label class="row mb_0" title="the unit is a goner"><input type="checkbox"> dead</label></div>');function gt(i,t){R(t,!0);const e=J(t,"unit",7);var a=pt(),o=l(a),s=l(o);ee(s),B(()=>fe(s,e().behaviors.has("Player_Controller_Behavior"))),s.__change=[_t,e],j(),r(o);var u=v(o,2),d=l(u);ee(d),B(()=>fe(d,e().behaviors.has("Harmful_Behavior"))),d.__change=[vt,e],j(),r(u);var h=v(u,2),p=l(h);ee(p),B(()=>fe(p,e().behaviors.has("Goal_Behavior"))),p.__change=[ut,e],j(),r(h);var I=v(h,2),P=l(I);ee(P),j(),r(I),r(a),Oe(P,()=>e().dead,n=>e().dead=n),c(i,a),V()}ie(["change"]);const ft=(i,t,e)=>{t.has(e())?t.delete(e()):t.add(e())};var mt=(i,t,e)=>t.set(e()),ht=m('<div class="input_row svelte-ffu65v"><!> <!></div> <div class="input_row svelte-ffu65v"><!></div> <div class="input_row svelte-ffu65v"><!></div>',1),yt=(i,t,e,a)=>{t().remove_point(e),a().renderer.dirty++},bt=m('<li class="row"><div class="flex_1 row justify_content_end"><!> <!></div> <button type="button" class="icon_button plain ml_md" title="remove point">✕</button></li>'),xt=(i,t,e)=>{t().add_point(new Ke(120,200)),e().renderer.dirty++},wt=m('<div class="input_row svelte-ffu65v"><!> <!></div> <div class="input_row svelte-ffu65v"><!></div> <div class="input_row svelte-ffu65v"><!></div> <ul class="unstyled mt_md"></ul> <button type="button" title="add a point to this polygon" class="plain">◎ add point</button>',1),kt=m('<div><div class="py_sm"><button type="button" class="inline color_g selected white_space_nowrap" title="this polygon intersects itself - collision detection is disabled">self-intersecting</button></div></div>'),jt=(i,t)=>{alert(`TODO this button should present choices for decomposing the concave polygon into ${t().decomped.length} convex ones`)},Pt=m('<div><div class="py_sm"><button type="button" class="inline color_d selected deselectable white_space_nowrap">concave</button></div></div>'),Tt=m('<div class="row gap_sm"><!> <!></div>'),Ut=m('<div><div class="row pb_sm pt_md"><div class="pr_md text_align_right font_weight_600 input_width_sm">id</div> <small> </small></div> <!></div> <!> <!>',1),Bt=m('<li class="unit_layer svelte-ffu65v" role="none"><header class="row gap_xs2 svelte-ffu65v"><div class="unit_layer_type svelte-ffu65v"><button type="button" class="plain"><div class="row"><div class="chevron svelte-ffu65v"></div> <!></div></button></div> <input class="name_input plain svelte-ffu65v" placeholder="name"></header> <!></li>');function It(i,t){R(t,!0);const e=J(t,"unit",7),a=J(t,"project",7),{unit_selection:o,collapsed_layers:s}=je.get(),u=se(()=>s.has(e())),d=.5,h=.1;var p=Bt();p.__pointerdown=[mt,o,e];const I=se(()=>o.has(e()));var P=l(p),n=l(P),_=l(n);_.__click=[ft,s,e];var x=l(_),y=v(l(x),2);Te(y,{get unit(){return e()}}),r(x),r(_),r(n);var T=v(n,2);ee(T),r(P);var W=v(P,2);{var M=U=>{var he=Ut(),oe=X(he),ve=l(oe),ue=v(l(ve),2);re(ue,"padding","var(--input_padding_y) var(--input_padding_x)");var Be=l(ue,!0);r(ue),r(ve);var Ie=v(ve,2);{var $e=L=>{var D=ht(),E=X(D);re(E,"--title_width","3.4rem");var Q=l(E);C(Q,{title:"circle x",input_classes:"plain",row:!0,step:d,get value(){return e().x},set value(f){e().x=f},children:(f,ae)=>{j();var $=z("x");c(f,$)},$$slots:{default:!0}});var K=v(Q,2);C(K,{title:"circle y",input_classes:"plain",row:!0,step:d,get value(){return e().y},set value(f){e().y=f},children:(f,ae)=>{j();var $=z("y");c(f,$)},$$slots:{default:!0}}),r(E);var G=v(E,2),k=l(G);C(k,{title:"circle scale",input_classes:"plain",row:!0,step:.01,get value(){return e().scale},set value(f){e().scale=f},children:(f,ae)=>{j();var $=z("scale");c(f,$)},$$slots:{default:!0}}),r(G);var w=v(G,2),S=l(w);C(S,{title:"circle radius",input_classes:"plain",row:!0,min:0,step:h,get value(){return e().radius},set value(f){e().radius=f},children:(f,ae)=>{j();var $=z("radius");c(f,$)},$$slots:{default:!0}}),r(w),c(L,D)},Le=L=>{var D=He(),E=X(D);{var Q=K=>{var G=wt(),k=X(G);re(k,"--title_width","3.4rem");var w=l(k);C(w,{title:"polygon x",input_classes:"plain",row:!0,step:d,get value(){return e().x},set value(b){e().x=b},children:(b,A)=>{j();var q=z("x");c(b,q)},$$slots:{default:!0}});var S=v(w,2);C(S,{title:"polygon y",input_classes:"plain",row:!0,step:d,get value(){return e().y},set value(b){e().y=b},children:(b,A)=>{j();var q=z("y");c(b,q)},$$slots:{default:!0}}),r(k);var f=v(k,2),ae=l(f);C(ae,{title:"polygon angle",input_classes:"plain",row:!0,step:Math.PI/360,get value(){return e().angle},set value(b){e().angle=b},children:(b,A)=>{j();var q=z("angle");c(b,q)},$$slots:{default:!0}}),r(f);var $=v(f,2),Ce=l($);C(Ce,{title:"polygon scale",input_classes:"plain",row:!0,step:.01,get value(){return e().scale},set value(b){e().scale=b},children:(b,A)=>{j();var q=z("scale");c(b,q)},$$slots:{default:!0}}),r($);var pe=v($,2);me(pe,22,()=>e().points,b=>b,(b,A,q)=>{var de=bt(),ce=l(de);re(ce,"--title_width","3.4rem");var be=l(ce);C(be,{get title(){return`polygon.points[${g(q)??""}].x`},classes:"mb_0",input_classes:"plain",row:!0,get value(){return A.x},oninput:N=>{A.x=N,e().update_points(),a().renderer.dirty++},step:d,children:(N,Ae)=>{j();var ge=z("x");c(N,ge)},$$slots:{default:!0}});var Ee=v(be,2);C(Ee,{get title(){return`polygon.points[${g(q)??""}].y`},classes:"mb_0",input_classes:"plain",row:!0,get value(){return A.y},oninput:N=>{A.y=N,e().update_points(),a().renderer.dirty++},step:d,children:(N,Ae)=>{j();var ge=z("y");c(N,ge)},$$slots:{default:!0}}),r(ce);var Se=v(ce,2);Se.__pointerup=[yt,e,A,a],r(de),Y(3,de,()=>F),c(b,de)}),r(pe);var De=v(pe,2);De.__click=[xt,e,a],c(K,G)};O(E,K=>{e().type==="polygon"&&K(Q)},!0)}c(L,D)};O(Ie,L=>{e().type==="circle"?L($e):L(Le,!1)})}r(oe);var ye=v(oe,2);{var qe=L=>{var D=Tt(),E=l(D);{var Q=k=>{var w=kt(),S=l(w);r(w),Y(3,S,()=>F),Y(3,w,()=>F,()=>({axis:"x"})),c(k,w)};O(E,k=>{e().is_simple_polygon||k(Q)})}var K=v(E,2);{var G=k=>{var w=Pt(),S=l(w),f=l(S);f.__click=[jt,e],r(S),r(w),B(()=>Z(f,"title",`this polygon is concave, and can be decomposed into ${e().decomped.length??""} convex polygons`)),Y(3,S,()=>F),Y(3,w,()=>F,()=>({axis:"x"})),c(k,w)};O(K,k=>{e().concave&&k(G)})}r(D),c(L,D)};O(ye,L=>{e().type==="polygon"&&L(qe)})}var ze=v(ye,2);gt(ze,{get unit(){return e()}}),B(()=>ke(Be,e().id)),Y(3,oe,()=>F),c(U,he)};O(W,U=>{g(u)||U(M)})}r(p),B(()=>{Z(p,"id",`unit_layer_${e().id??""}`),te(p,"collapsed",g(u)),te(p,"selected",g(I)),Z(_,"title",e().type),Z(T,"title",`${e().type??""} name`)}),Pe(T,()=>e().name,U=>e().name=U),c(i,p),V()}ie(["pointerdown","click","pointerup"]);var $t=m('<ul class="unit_layers unstyled"></ul>');function Lt(i,t){R(t,!0),J(t,"scroll_on_select",3,!0)()&&we(()=>{var s;const{latest:o}=t.project.editor.unit_selection;o&&((s=document.getElementById("unit_layer_"+o.id))==null||s.scrollIntoView({block:"nearest"}))});var a=$t();me(a,21,()=>t.project.scene.units,Ge,(o,s)=>{Ue(o,{get scene(){return t.project.scene},get unit(){return g(s)},children:(u,d)=>{It(u,{get project(){return t.project},get unit(){return g(s)}})},$$slots:{default:!0}})}),r(a),c(i,a),V()}var qt=m('<div class="column svelte-175igsh"><div class="column_panel svelte-175igsh"><!></div> <div class="p_lg"><!></div></div> <div class="column svelte-175igsh"><div class="unit_layers_controls svelte-175igsh"><!></div> <div class="column_panel svelte-175igsh"><!></div></div>',1);function Ot(i,t){const e=se(()=>t.project.scene),a=se(()=>t.project.editor);let o=le(0),s=le(0);var u=qt(),d=X(u),h=l(d),p=l(h);ot(p,{get project(){return t.project}}),r(h);var I=v(h,2),P=l(I);ct(P,{get scene(){return g(e)}}),r(I),r(d);var n=v(d,2),_=l(n),x=l(_);Qe(x,{get editor(){return g(a)}}),r(_);var y=v(_,2),T=l(y);Lt(T,{get project(){return t.project}}),r(y),r(n),B(()=>{te(d,"scrolled",g(o)>0),te(y,"scrolled",g(s)>0)}),ne("scroll",d,W=>{H(o,_e(W.currentTarget.scrollTop))}),ne("scroll",y,W=>{H(s,_e(W.currentTarget.scrollTop))}),c(i,u)}export{Ot as U,Qe as a};
