var yt=Object.defineProperty;var Ne=c=>{throw TypeError(c)};var wt=(c,e,t)=>e in c?yt(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var o=(c,e,t)=>wt(c,typeof e!="symbol"?e+"":e,t),Xe=(c,e,t)=>e.has(c)||Ne("Cannot "+t);var b=(c,e,t)=>(Xe(c,e,"read from private field"),t?t.call(c):e.get(c)),G=(c,e,t)=>e.has(c)?Ne("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(c):e.set(c,t);var qe=(c,e,t)=>(Xe(c,e,"access private method"),t);import{a as C,t as $,b as Ee,c as V}from"./disclose-version.hpen2EY6.js";import{o as ee,c as Z,r as J,s as le,t as re,K as i,m as te,L as H,f as I,n as ze,u as Ie,aI as O,W as y,a0 as E,D as st,$ as kt}from"./runtime.BxixJYQn.js";import{p as T,i as N,c as D,d as _t}from"./props.DCp65xQH.js";import{s as Q}from"./snippet.ODdKu9lL.js";import{s as Me,d as jt,o as At,k as Se}from"./render.CII73B8B.js";import{s as Ve,d as Oe,e as Ct,b as Et}from"./string.Bu0lHRZq.js";import{y as it,z as Mt,A as St,B as R,F as Bt,b as Fe,I as U,J as Ce,K as Je,L as Qe,M as Gt,N as Lt,O as Pt,g as Kt,Q as Dt,C as Rt,V as Ht,W as Tt,X as It,Y as Ot,e as at}from"./renderer_components.Br8110jH.js";import{b as Ut}from"./preload-helper.CYsmXywa.js";import{c as Wt}from"./context_helpers.DD_dcjTe.js";var Yt=(c,e)=>e.close(),Nt=$('<li role="none" class="svelte-xrqtyv"><a class="menu_item plain svelte-xrqtyv" role="menuitem"><div class="content"><div class="icon"><!></div> <div class="title"><span class="text svelte-xrqtyv"><!></span></div></div></a></li>');function Xt(c,e){ee(e,!0);const t="ðŸ”—",a=T(e,"icon",3,t),n=it.get(),u=(w,A=location.host)=>{const P=Oe(Oe(w,"https://"),"http://");return P.startsWith(A+"/")?Oe(P,A):P},s=H(()=>u(e.href)),_=H(()=>!(i(s)[0]==="."||i(s)[0]==="/"&&i(s)[1]!=="/")),f=H(()=>i(_)?"noreferrer":void 0);var g=Nt(),m=Z(g);m.__click=[Yt,n];var x=Z(m),h=Z(x),M=Z(h);{var p=w=>{var A=Ee();re(()=>Me(A,a())),C(w,A)},K=w=>{var A=V(),P=I(A);Q(P,a,()=>t),C(w,A)};N(M,w=>{typeof a()=="string"?w(p):w(K,!1)})}J(h);var L=le(h,2),B=Z(L),W=Z(B);{var S=w=>{var A=V(),P=I(A);Q(P,()=>e.children),C(w,A)},Y=w=>{var A=Ee();re(()=>Me(A,i(s))),C(w,A)};N(W,w=>{e.children?w(S):w(Y,!1)})}J(B),J(L),J(x),J(m),J(g),re(()=>{Ve(m,"href",e.href),Ve(m,"rel",i(f))}),C(c,g),te()}jt(["click"]);function qt(c,e){Mt(c,{get run(){return e.run},icon:a=>{ze();var n=Ee();re(()=>Me(n,e.icon)),C(a,n)},children:(a,n)=>{ze();var u=Ee();re(()=>Me(u,e.content)),C(a,u)},$$slots:{icon:!0,default:!0}})}const zt=(c,e=st)=>{Xt(c,_t(e))},Vt=(c,e=st)=>{qt(c,_t(e))};var Ft=$('<div class="contextmenu_root svelte-aif9y6" role="region"><!></div>'),Jt=$('<div class="contextmenu_layout svelte-aif9y6" aria-hidden="true"></div>'),Qt=$('<menu class="contextmenu unstyled pane svelte-aif9y6" role="dialog" tabindex="-1"></menu>'),Zt=$("<!> <!> <!>",1);function $t(c,e){ee(e,!0);const t=T(e,"contextmenu",19,()=>new Bt),a=T(e,"longpress_move_tolerance",3,21),n=T(e,"longpress_duration",3,633),u=T(e,"bypass_with_tap_then_longpress",3,!0),s=T(e,"tap_then_longpress_duration",3,660),_=T(e,"tap_then_longpress_move_tolerance",3,7),f=T(e,"open_offset_x",19,()=>-2),g=T(e,"open_offset_y",19,()=>-2),m=T(e,"scoped",3,!1);it.set(t());let x=E(void 0);const h=H(()=>t().layout),M=H(()=>t().initial_layout),p=H(()=>i(h)===i(M));let K=E(void 0),L=E(void 0);Ie(()=>{!i(p)&&i(K)!==void 0&&(i(h).width=i(K))}),Ie(()=>{!i(p)&&i(L)!==void 0&&(i(h).height=i(L))});const B=St.set();Ie(()=>{if(i(x)){const r=i(x).getBoundingClientRect();B.width=r.width,B.height=r.height}});const W=H(()=>t().x+Math.min(0,i(h).width-(t().x+B.width))),S=H(()=>t().y+Math.min(0,i(h).height-(t().y+B.height)));let Y=E(void 0),w=E(void 0),A=E(void 0),P=E(void 0),X=E(void 0),q=E(void 0);const z=()=>{i(X)&&y(X,!1),i(P)!=null&&(clearTimeout(i(P)),y(P,null))},ne=r=>{var v;if(i(q)){y(q,!1);return}if(i(X)){z(),U(r);return}const{target:l}=r;r.shiftKey||!(l instanceof HTMLElement||l instanceof SVGElement)||(v=i(x))!=null&&v.contains(l)||Ce(l)||Je(l)||Qe(l,r.clientX+f(),r.clientY+g(),t())&&(U(r),z())},se=r=>{i(X)&&y(X,!1);const{touches:l,target:v}=r;if(t().opened||l.length!==1||r.shiftKey||!(v instanceof HTMLElement||v instanceof SVGElement)||Ce(v)||Je(v))return;const{clientX:k,clientY:j}=l[0];if(u()){if(i(A)!=null&&performance.now()-i(A)<s()&&Math.hypot(k-i(Y),j-i(w))<_()){y(q,!0),y(A,null);return}y(A,D(performance.now()))}y(Y,D(k)),y(w,D(j)),i(P)!=null&&z(),y(P,D(setTimeout(()=>{y(X,!0),Qe(v,i(Y)+f(),i(w)+g(),t())},n())))},_e=r=>{if(i(P)==null)return;const{touches:l}=r;if(l.length!==1)return;const{clientX:v,clientY:k}=l[0];Math.hypot(v-i(Y),k-i(w))>a()&&(t().opened&&t().close(),z())},F=r=>{i(P)!=null&&(i(X)&&U(r),z())},ce=r=>{i(x)&&!i(x).contains(r.target)&&t().close()},he=new Map([["Escape",()=>t().close()],["ArrowLeft",()=>t().collapse_selected()],["ArrowRight",()=>t().expand_selected()],["ArrowDown",()=>t().select_next()],["PageDown",()=>t().select_next()],["ArrowUp",()=>t().select_previous()],["PageUp",()=>t().select_previous()],["Home",()=>t().select_first()],["End",()=>t().select_last()],[" ",()=>t().activate_selected()],["Enter",()=>t().activate_selected()]]),ue=r=>{const l=he.get(r.key);!l||Ce(r.target)||(U(r),l())},d=(r,l)=>{let v=null;const k=j=>{v&&(v(),v=null),j.disabled||(v=At(r,j.event,j.cb,{capture:!0,passive:j.passive}))};return k(l),{update:j=>{k(j)},destroy:()=>{v==null||v()}}};var Re=Zt();R(O,(r,l)=>d==null?void 0:d(r,l),()=>({event:"contextmenu",passive:!1,cb:ne,disabled:m()})),R(O,(r,l)=>d==null?void 0:d(r,l),()=>({event:"touchstart",passive:!0,cb:se,disabled:m()})),R(O,(r,l)=>d==null?void 0:d(r,l),()=>({event:"touchmove",passive:!0,cb:_e,disabled:m()})),R(O,(r,l)=>d==null?void 0:d(r,l),()=>({event:"touchend",passive:!1,cb:F,disabled:m()})),R(O,(r,l)=>d==null?void 0:d(r,l),()=>({event:"touchcancel",passive:!1,cb:F,disabled:m()})),R(O,(r,l)=>d==null?void 0:d(r,l),()=>({event:"mousedown",passive:!0,cb:ce,disabled:!t().opened})),R(O,(r,l)=>d==null?void 0:d(r,l),()=>({event:"keydown",passive:!1,cb:ue,disabled:!t().opened}));var Ae=I(Re);{var lt=r=>{var l=Ft(),v=Z(l);Q(v,()=>e.children),J(l),R(l,(k,j)=>d==null?void 0:d(k,j),()=>({event:"contextmenu",passive:!1,cb:ne})),R(l,(k,j)=>d==null?void 0:d(k,j),()=>({event:"touchstart",passive:!0,cb:se})),R(l,(k,j)=>d==null?void 0:d(k,j),()=>({event:"touchmove",passive:!0,cb:_e})),R(l,(k,j)=>d==null?void 0:d(k,j),()=>({event:"touchend",passive:!1,cb:F})),R(l,(k,j)=>d==null?void 0:d(k,j),()=>({event:"touchcancel",passive:!1,cb:F})),C(r,l)},ct=r=>{var l=V(),v=I(l);Q(v,()=>e.children),C(r,l)};N(Ae,r=>{m()?r(lt):r(ct,!1)})}var We=le(Ae,2);{var ht=r=>{var l=Jt();Fe(l,"clientHeight",v=>y(L,v)),Fe(l,"clientWidth",v=>y(K,v)),C(r,l)};N(We,r=>{i(p)||r(ht)})}var ut=le(We,2);{var mt=r=>{var l=Qt();Ct(l,20,()=>t().params,v=>v,(v,k)=>{var j=V(),ft=I(j);{var dt=ie=>{var me=V(),He=I(me);Q(He,()=>k),C(ie,me)},gt=ie=>{var me=V(),He=I(me);{var vt=ae=>{zt(ae,()=>k.props)},pt=ae=>{var Ye=V(),bt=I(Ye);{var xt=Te=>{Vt(Te,()=>k.props)};N(bt,Te=>{k.snippet==="text"&&Te(xt)},!0)}C(ae,Ye)};N(He,ae=>{k.snippet==="link"?ae(vt):ae(pt,!1)},!0)}C(ie,me)};N(ft,ie=>{typeof k=="function"?ie(dt):ie(gt,!1)})}C(v,j)}),J(l),Ut(l,v=>y(x,v),()=>i(x)),re(()=>Et(l,"transform",`translate3d(${i(W)??""}px, ${i(S)??""}px, 0)`)),C(r,l)};N(ut,r=>{t().opened&&r(mt)})}C(c,Re),te()}const oe=class oe{constructor(){o(this,"_bvh_branch",!0);o(this,"_bvh_parent",null);o(this,"_bvh_left",null);o(this,"_bvh_right",null);o(this,"_bvh_sort",0);o(this,"_bvh_min_x",0);o(this,"_bvh_min_y",0);o(this,"_bvh_max_x",0);o(this,"_bvh_max_y",0)}static get_branch(e=oe.branch_pool){return e.pop()??new oe}static release_branch(e,t=oe.branch_pool){t.push(e)}};o(oe,"branch_pool",[]);let Be=oe;class en{constructor(){o(this,"_hierarchy",null);o(this,"_bodies",[]);o(this,"_dirty_branches",[])}insert(e,t=!1){if(!t){const p=e._bvh;if(p&&p!==this)throw new Error("Body belongs to another collision system");e._bvh=this,this._bodies.push(e)}const a=e.is_polygon,n=e.x,u=e.y;a&&(e._dirty_coords||e.x!==e._x||e.y!==e._y||e.angle!==e._angle||e.scale_x!==e._scale_x||e.scale_y!==e._scale_y)&&e._calculate_coords();const s=e._bvh_padding,_=a?0:e.radius*e.scale,f=(a?e._min_x:n-_)-s,g=(a?e._min_y:u-_)-s,m=(a?e._max_x:n+_)+s,x=(a?e._max_y:u+_)+s;e._bvh_min_x=f,e._bvh_min_y=g,e._bvh_max_x=m,e._bvh_max_y=x;let h=this._hierarchy,M=0;if(!h)this._hierarchy=e;else for(;;)if(h._bvh_branch){const p=h._bvh_left,K=p._bvh_min_y,L=p._bvh_max_x,B=p._bvh_max_y,W=f<p._bvh_min_x?f:p._bvh_min_x,S=g<K?g:K,Y=m>L?m:L,w=x>B?x:B,A=(L-p._bvh_min_x)*(B-K),X=(Y-W)*(w-S)-A,q=h._bvh_right,z=q._bvh_min_x,ne=q._bvh_min_y,se=q._bvh_max_x,_e=q._bvh_max_y,F=f<z?f:z,ce=g<ne?g:ne,he=m>se?m:se,ue=x>_e?x:_e,d=(se-z)*(_e-ne),Ae=(he-F)*(ue-ce)-d;h._bvh_sort=M++,h._bvh_min_x=W<F?W:F,h._bvh_min_y=S<ce?S:ce,h._bvh_max_x=Y>he?Y:he,h._bvh_max_y=w>ue?w:ue,h=X<=Ae?p:q}else{const p=h._bvh_parent,K=h._bvh_min_x,L=h._bvh_min_y,B=h._bvh_max_x,W=h._bvh_max_y,S=h._bvh_parent=e._bvh_parent=Be.get_branch();S._bvh_parent=p,S._bvh_left=h,S._bvh_right=e,S._bvh_sort=M++,S._bvh_min_x=f<K?f:K,S._bvh_min_y=g<L?g:L,S._bvh_max_x=m>B?m:B,S._bvh_max_y=x>W?x:W,p?p._bvh_left===h?p._bvh_left=S:p._bvh_right=S:this._hierarchy=S;break}}remove(e,t=!1){if(!t){const _=e._bvh;if(_&&_!==this)throw new Error("Body belongs to another collision system");e._bvh=null,this._bodies.splice(this._bodies.indexOf(e),1)}if(this._hierarchy===e){this._hierarchy=null;return}const a=e._bvh_parent,n=a._bvh_parent,u=a._bvh_left,s=u===e?a._bvh_right:u;if(s._bvh_parent=n,s._bvh_branch&&(s._bvh_sort=a._bvh_sort),n){n._bvh_left===a?n._bvh_left=s:n._bvh_right=s;let _=n;for(;_;){const f=_._bvh_left,g=f._bvh_min_x,m=f._bvh_min_y,x=f._bvh_max_x,h=f._bvh_max_y,M=_._bvh_right,p=M._bvh_min_x,K=M._bvh_min_y,L=M._bvh_max_x,B=M._bvh_max_y;_._bvh_min_x=g<p?g:p,_._bvh_min_y=m<K?m:K,_._bvh_max_x=x>L?x:L,_._bvh_max_y=h>B?h:B,_=_._bvh_parent}}else this._hierarchy=s;Be.release_branch(a)}update(){const e=this._bodies,t=e.length;for(let a=0;a<t;++a){const n=e[a];let u=!1;if(n.padding!==n._bvh_padding&&(n._bvh_padding=n.padding,u=!0),!u){const s=n.is_polygon;s&&(n._dirty_coords||n.x!==n._x||n.y!==n._y||n.angle!==n._angle||n.scale_x!==n._scale_x||n.scale_y!==n._scale_y)&&n._calculate_coords();const _=n.x,f=n.y,g=s?0:n.radius*n.scale,m=s?n._min_x:_-g,x=s?n._min_y:f-g,h=s?n._max_x:_+g,M=s?n._max_y:f+g;u=m<n._bvh_min_x||x<n._bvh_min_y||h>n._bvh_max_x||M>n._bvh_max_y}u&&(this.remove(n,!0),this.insert(n,!0))}}potentials(e){const t=[],a=e._bvh_min_x,n=e._bvh_min_y,u=e._bvh_max_x,s=e._bvh_max_y;let _=this._hierarchy,f=!0;if(!(_!=null&&_._bvh_branch))return t;for(;_;){if(f){f=!1;let m=_._bvh_branch?_._bvh_left:null;for(;m&&m._bvh_max_x>=a&&m._bvh_max_y>=n&&m._bvh_min_x<=u&&m._bvh_min_y<=s;)_=m,m=_._bvh_branch?_._bvh_left:null}const g=_._bvh_branch?_._bvh_right:null;if(g&&g._bvh_max_x>a&&g._bvh_max_y>n&&g._bvh_min_x<u&&g._bvh_min_y<s)_=g,f=!0;else{!_._bvh_branch&&_!==e&&t.push(_);let m=_._bvh_parent;if(m){for(;m&&m._bvh_right===_;)_=m,m=_._bvh_parent;_=m}else break}}return t}}class tn extends Gt{constructor(t=0,a=0,n=0,u=1,s=0){super(t,a,s);o(this,"is_polygon",!1);o(this,"is_circle",!0);o(this,"is_point",!1);o(this,"radius");o(this,"scale");this.radius=n,this.scale=u}}class nn{constructor(){o(this,"_bvh",new en)}create_circle(e=0,t=0,a=0,n=1,u=0){const s=new tn(e,t,a,n,u);return this._bvh.insert(s),s}create_polygon(e=0,t=0,a=[{x:0,y:0}],n=0,u=1,s=1,_=0){const f=new Lt(e,t,a,n,u,s,_);return this._bvh.insert(f),f}create_point(e=0,t=0,a=0){const n=new Pt(e,t,a);return this._bvh.insert(n),n}insert(...e){for(const t of e)this._bvh.insert(t,!1);return this}remove(...e){for(const t of e)this._bvh.remove(t,!1);return this}update(){return this._bvh.update(),this}potentials(e){return this._bvh.potentials(e)}}class sn{constructor(){o(this,"collision",!1);o(this,"a",null);o(this,"b",null);o(this,"a_in_b",!1);o(this,"b_in_a",!1);o(this,"overlap",0);o(this,"overlap_x",0);o(this,"overlap_y",0)}}const Ze=new sn;var fe;class _n{constructor(e){o(this,"collisions");G(this,fe,E(1));this.collisions=e}get speed(){return i(b(this,fe))}set speed(e){y(b(this,fe),D(e))}update(e,t,a){this.collisions.update();const n=t*this.speed;var u;for(const s of e){s.dead||(u=s.speed*n,u!==0&&(s.direction_x!==0&&(s.x+=s.direction_x*u),s.direction_y!==0&&(s.y+=s.direction_y*u))),s.teleporting_x!==0&&(s.x+=s.teleporting_x),s.teleporting_y!==0&&(s.y+=s.teleporting_y);for(const _ of s.body.potentials())Kt(s.body,_,Ze)&&(_.unit.behaviors.has("Harmful_Behavior")&&s.behaviors.has("Player_Controller_Behavior")?s.kill():_.unit.behaviors.has("Player_Controller_Behavior")&&s.behaviors.has("Harmful_Behavior")?_.unit.kill():_.unit.behaviors.has("Goal_Behavior")&&s.behaviors.has("Player_Controller_Behavior")?s.scene.exit():_.unit.behaviors.has("Player_Controller_Behavior")&&s.behaviors.has("Goal_Behavior")?_.unit.scene.exit():a(s,_.unit,Ze))}}}fe=new WeakMap;var de,ge,ve,pe,be,xe,Ge,Le,ye,we,ke,Pe,Ke,ot;class an{constructor(){G(this,Ke);G(this,de,E(!1));G(this,ge,E(!1));G(this,ve,E(!1));G(this,pe,E(!1));o(this,"teleporting_x",null);o(this,"teleporting_y",null);G(this,be,E(0));G(this,xe,E(0));o(this,"just_pressed_button_a",!1);o(this,"just_pressed_button_b",!1);o(this,"just_pressed_button_x",!1);o(this,"just_pressed_button_y",!1);o(this,"pressing_button_a",!1);o(this,"pressing_button_b",!1);o(this,"pressing_button_x",!1);o(this,"pressing_button_y",!1);G(this,Ge,H(()=>this.gamepad_moving_x||(this.moving_left?-1:0)+(this.moving_right?1:0)));G(this,Le,H(()=>this.gamepad_moving_y||(this.moving_up?-1:0)+(this.moving_down?1:0)));G(this,ye,E(!1));G(this,we,E(!1));G(this,ke,E(!1));o(this,"pointer_down",!1);G(this,Pe,H(()=>this.pointer_down||this.moving_x!==0||this.moving_y!==0));o(this,"pointer_screen_x",null);o(this,"pointer_screen_y",null);o(this,"connected_gamepads",new Dt);o(this,"gamepad_axis_sensitivity",.04);o(this,"teleport_distance_md",12);o(this,"teleport_distance_lg",this.teleport_distance_md*4);o(this,"teleport_distance_xl",this.teleport_distance_lg*4)}get moving_left(){return i(b(this,de))}set moving_left(e){y(b(this,de),D(e))}get moving_right(){return i(b(this,ge))}set moving_right(e){y(b(this,ge),D(e))}get moving_up(){return i(b(this,ve))}set moving_up(e){y(b(this,ve),D(e))}get moving_down(){return i(b(this,pe))}set moving_down(e){y(b(this,pe),D(e))}get gamepad_moving_x(){return i(b(this,be))}set gamepad_moving_x(e){y(b(this,be),D(e))}get gamepad_moving_y(){return i(b(this,xe))}set gamepad_moving_y(e){y(b(this,xe),D(e))}get moving_x(){return i(b(this,Ge))}get moving_y(){return i(b(this,Le))}get pressing_shift(){return i(b(this,ye))}set pressing_shift(e){y(b(this,ye),D(e))}get pressing_ctrl(){return i(b(this,we))}set pressing_ctrl(e){y(b(this,we),D(e))}get pressing_alt(){return i(b(this,ke))}set pressing_alt(e){y(b(this,ke),D(e))}set_pointer_down(e){this.pointer_down=e}get moving(){return i(b(this,Pe))}set_pointer_location(e,t){this.pointer_screen_x=e,this.pointer_screen_y=t}update(e){qe(this,Ke,ot).call(this);const t=this.just_pressed_button_a&&this.pressing_button_x||this.just_pressed_button_x&&this.pressing_button_a?this.teleport_distance_xl:this.just_pressed_button_x?this.teleport_distance_lg:this.just_pressed_button_a?this.teleport_distance_md:0;this.teleporting_x=t===0||this.moving_x===0?null:this.moving_x*t,this.teleporting_y=t===0||this.moving_y===0?null:this.moving_y*t}handle_keydown(e){switch(e){case"Shift":return this.pressing_shift=!0,!0;case"Control":return this.pressing_ctrl=!0,!0;case"Alt":return this.pressing_alt=!0,!0;case"ArrowLeft":case"a":return this.moving_left=!0,!0;case"ArrowRight":case"d":return this.moving_right=!0,!0;case"ArrowUp":case"w":return this.moving_up=!0,!0;case"ArrowDown":case"s":return this.moving_down=!0,!0;default:return!1}}handle_keyup(e){switch(e){case"Shift":return this.pressing_shift=!1,!0;case"Control":return this.pressing_ctrl=!1,!0;case"Alt":return this.pressing_alt=!1,!0;case"ArrowLeft":case"a":return this.moving_left=!1,!0;case"ArrowRight":case"d":return this.moving_right=!1,!0;case"ArrowUp":case"w":return this.moving_up=!1,!0;case"ArrowDown":case"s":return this.moving_down=!1,!0;default:return!1}}handle_gamepad_connected(e){console.log("[controller] handle_gamepad_connected gamepad",e),this.connected_gamepads.add(e.index)}handle_gamepad_disconnected(e){console.log("[controller] handle_gamepad_disconnected gamepad",e),this.connected_gamepads.delete(e.index)}reset(){this.moving_left=!1,this.moving_right=!1,this.moving_up=!1,this.moving_down=!1,this.teleporting_x=null,this.teleporting_y=null,this.pressing_shift=!1,this.pressing_ctrl=!1,this.pressing_alt=!1,this.just_pressed_button_a=!1,this.just_pressed_button_b=!1,this.just_pressed_button_x=!1,this.just_pressed_button_y=!1,this.pressing_button_a=!1,this.pressing_button_b=!1,this.pressing_button_x=!1,this.pressing_button_y=!1}}de=new WeakMap,ge=new WeakMap,ve=new WeakMap,pe=new WeakMap,be=new WeakMap,xe=new WeakMap,Ge=new WeakMap,Le=new WeakMap,ye=new WeakMap,we=new WeakMap,ke=new WeakMap,Pe=new WeakMap,Ke=new WeakSet,ot=function(){if(!this.connected_gamepads.size)return;const e=navigator.getGamepads();for(const t of e){if(!t)continue;const[a,n]=t.axes;this.gamepad_moving_x=Math.abs(a)>this.gamepad_axis_sensitivity?a:0,this.gamepad_moving_y=Math.abs(n)>this.gamepad_axis_sensitivity?n:0;const[u,s,_,f]=t.buttons;this.just_pressed_button_a=u.pressed?!this.pressing_button_a:!1,this.just_pressed_button_b=s.pressed?!this.pressing_button_b:!1,this.just_pressed_button_x=_.pressed?!this.pressing_button_x:!1,this.just_pressed_button_y=f.pressed?!this.pressing_button_y:!1,this.pressing_button_a=u.pressed,this.pressing_button_b=s.pressed,this.pressing_button_x=_.pressed,this.pressing_button_y=f.pressed}};const rt=Wt(),on={show_main_menu:()=>!1},$e=c=>(console.log("[parse_app_json]",c),{show_main_menu:typeof(c==null?void 0:c.show_main_menu)=="boolean"?c.show_main_menu:on.show_main_menu()}),et="app";var je,De;const Ue=class Ue{constructor(e){o(this,"clock");o(this,"renderer");o(this,"simulation");o(this,"collisions");o(this,"controller");G(this,je,E(!1));G(this,De,H(()=>It(this)));o(this,"toggle_main_menu",()=>{this.show_main_menu?this.close_main_menu():this.open_main_menu()});o(this,"open_main_menu",()=>{this.show_main_menu=!0});o(this,"close_main_menu",()=>{this.show_main_menu=!1});console.log("[app] new with options",e);const{renderer:t,clock:a=new Rt,simulation:n=new _n(new nn),controller:u=new an,app_json:s=Ue.load()}=e;this.renderer=t,this.clock=a,this.collisions=n.collisions,this.simulation=n,this.controller=u,console.log("[app] app_json",s),this.set_json(s)}get show_main_menu(){return i(b(this,je))}set show_main_menu(e){y(b(this,je),D(e))}get json(){return i(b(this,De))}toJSON(){return{show_main_menu:this.show_main_menu}}set_json(e){console.log("[app] set_json",e),this.show_main_menu=e.show_main_menu}save(e=this.json){console.log("[app] save"),Ht(et,e)}static load(e=et){return console.log("[app] loading app"),Tt(e,()=>$e(null),$e,!0)}};je=new WeakMap,De=new WeakMap;let tt=Ue;function rn(c,e){ee(e,!0);const t=T(e,"app",19,()=>rt.get()),a=H(()=>{let n=[{snippet:"text",props:{content:"Main menu",icon:"?",run:()=>{t().toggle_main_menu()}}},{snippet:"text",props:{content:"Reload",icon:"âŸ³",run:()=>{location.reload()}}}];return e.contextmenu_params_before&&(Array.isArray(e.contextmenu_params_before)?n=e.contextmenu_params_before.concat(n):n.unshift(e.contextmenu_params_before)),e.contextmenu_params_after&&(Array.isArray(e.contextmenu_params_after)?n=n.concat(e.contextmenu_params_after):n.push(e.contextmenu_params_after)),n});R(kt.body,(n,u)=>{var s;return(s=Ot)==null?void 0:s(n,u)},()=>i(a)),te()}const nt=c=>!c||!Ce(c);function ln(c,e){ee(e,!0);const t=rt.get(),a=at.get(),n=s=>{if(!nt(s.target))return;const{key:_,ctrlKey:f,altKey:g}=s;if(_===" "){a.clock.toggle(),U(s);return}else if(_==="r"&&!f){a.project.scene.reset(),U(s);return}else if(_==="`"&&!f&&!g){a.toggle_playing(),U(s);return}else if(_==="~"&&!f&&!g){a.editing=!a.editing,U(s);return}else if(_==="Escape"&&!f&&!g){a.show_scene_menu?a.show_scene_menu=!1:t.toggle_main_menu(),U(s);return}e.controller.handle_keydown(_)&&U(s)},u=s=>{nt(s.target)&&e.controller.handle_keyup(s.key)&&U(s)};Se("keydown",O,n),Se("keyup",O,u),te()}function cn(c,e){ee(e,!0),Se("gamepadconnected",O,t=>{e.controller.handle_gamepad_connected(t.gamepad)}),Se("gamepaddisconnected",O,t=>{e.controller.handle_gamepad_disconnected(t.gamepad)}),te()}var hn=$("<!> <!>",1);function un(c,e){ee(e,!0);const t=T(e,"controller",19,()=>at.get().controller);var a=hn(),n=I(a);ln(n,{get controller(){return t()}});var u=le(n,2);cn(u,{get controller(){return t()}}),C(c,a),te()}var mn=$("<!> <!> <!>",1);function jn(c,e){ee(e,!0),$t(c,{children:(t,a)=>{var n=mn(),u=I(n);{var s=h=>{var M=V(),p=I(M);Q(p,()=>e.global_controls),C(h,M)},_=h=>{un(h,{})};N(u,h=>{e.global_controls?h(s):h(_,!1)})}var f=le(u,2);{var g=h=>{var M=V(),p=I(M);Q(p,()=>e.app_contextmenu),C(h,M)},m=h=>{rn(h,{})};N(f,h=>{e.app_contextmenu?h(g):h(m,!1)})}var x=le(f,2);Q(x,()=>e.children),C(t,n)},$$slots:{default:!0}}),te()}export{tt as A,an as C,jn as D,_n as S,rt as a,nn as b,Ze as c,rn as d};
