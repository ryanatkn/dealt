var Rt=Object.defineProperty;var St=l=>{throw TypeError(l)};var Vt=(l,e,t)=>e in l?Rt(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var It=(l,e,t)=>Vt(l,typeof e!="symbol"?e+"":e,t),Mt=(l,e,t)=>e.has(l)||St("Cannot "+t);var G=(l,e,t)=>(Mt(l,e,"read from private field"),t?t.call(l):e.get(l)),dt=(l,e,t)=>e.has(l)?St("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(l):e.set(l,t),wt=(l,e,t,o)=>(Mt(l,e,"write to private field"),o?o.call(l,t):e.set(l,t),t);import{a as E,t as L,n as lt,c as ct,b as at}from"./disclose-version.Ds06f9Vu.js";import{aJ as Wt,K as n,k as Ft,j as Xt,a1 as Zt,a4 as Jt,v as J,m as B,o as Q,q as $,L as H,c as D,s as q,D as Et,r as R,n as rt,a0 as m,u as Pt,W as i,aI as V}from"./runtime.5k9ShzZt.js";import{d as st,o as zt,k as T,s as vt}from"./render.CAjsxhF5.js";import{i as W,p as tt,c as _}from"./props.lofZ2jro.js";import{s as _t}from"./snippet.CcawutmI.js";import{b as et,r as Ct,t as O,s as A,g as Lt,a as Ot,e as Kt}from"./string.25aLtQ0-.js";import{t as Gt,s as Qt}from"./index.DteDSzYE.js";import{ap as $t,e as At,P as te,u as ee,aq as ne,I as nt,ar as pt,as as ie,at as le,au as oe,av as Ht,y as re,A as Yt,B as se,Y as ae,z as mt,aw as ue,Z as ce,c as _e,a1 as de}from"./renderer_components.BRuy53NI.js";import{c as ge}from"./svelte-component.BgFhLqea.js";import{b as ve}from"./preload-helper.DV2ohNv5.js";function he(l){let e=0,t=Jt(0),o;return()=>{Wt()&&(n(t),Ft(()=>(e===0&&(o=Xt(()=>l(()=>$t(t)))),e+=1,()=>{Zt().then(()=>{e-=1,e===0&&(o==null||o(),o=void 0)})})))}}var ht,ft;class Ut{constructor(e,t){dt(this,ht);dt(this,ft);wt(this,ht,e),wt(this,ft,he(t))}get current(){return G(this,ft).call(this),G(this,ht).call(this)}}ht=new WeakMap,ft=new WeakMap;var fe=(l,e)=>n(e).reset(),ye=L('<fieldset><label class="row pt_xs"><input type="checkbox"> show bounding volume hierarchy</label></fieldset>'),me=L('<div class="scene_controls svelte-1l7n56e"><button type="button" title="toggle the clock [Spacebar]"><div class="pr_sm">clock</div> <!></button> <button type="button" title="reset the scene [r]" class="plain">reset</button> <button type="button" class="plain deselectable">edit</button> <!></div> <!>',1);function Mn(l,e){$(e,!0);const t=H(()=>e.project.renderer),o=H(()=>e.project.scene),f=H(()=>n(o).clock),s=At.get();var r=me(),d=J(r),a=D(d);a.__click=function(...x){var I;(I=n(f).toggle)==null||I.apply(this,x)},et(a,"min-width","105px");var u=q(D(a),2);te(u,{get running(){return n(f).running}}),R(a);var p=q(a,2);p.__click=[fe,o];var w=q(p,2);w.__click=()=>s.editing=!s.editing;var y=q(w,2);_t(y,()=>e.children??Et),R(d);var k=q(d,2);{var S=x=>{var I=ye(),X=D(I),v=D(X);Ct(v),rt(),R(X),R(I),ee(v,()=>n(t).show_bvh,M=>n(t).show_bvh=M),Gt(3,I,()=>Qt),E(x,I)};W(k,x=>{n(t).type==="canvas"&&x(S)})}B(()=>{O(a,"color_d",n(f).running),A(w,"title",`${(s.editing?"stop editing":"start editing")??""} [~ Shift+Backtick]`),O(w,"color_d",s.editing)}),E(l,r),Q()}st(["click"]);const pe=new Ut(()=>window.innerWidth,l=>zt(window,"resize",l)),we=new Ut(()=>window.innerHeight,l=>zt(window,"resize",l));var xe=lt('<line class="svelte-4z6b3j"></line>'),be=lt('<svg class="scrubbing_indicator svelte-4z6b3j" aria-hidden="true"><!></svg>');function gt(l,e){$(e,!0);const t=H(()=>e.container_width??pe.current),o=H(()=>e.container_height??we.current);ne(l,{to:document.body,children:(f,s)=>{var r=be(),d=D(r);{var a=u=>{var p=xe();B(()=>{A(p,"x1",e.x_start),A(p,"y1",e.y_start),A(p,"x2",e.x_last),A(p,"y2",e.y_last)}),E(u,p)};W(d,u=>{e.x_start!==null&&e.y_start!==null&&e.x_last!==null&&e.y_last!==null&&u(a)})}R(r),B(()=>{A(r,"viewBox",`0 0 ${n(t)??""} ${n(o)??""}`),A(r,"width",n(t)),A(r,"height",n(o))}),E(f,r)},$$slots:{default:!0}}),Q()}const ke=(l,e)=>{l.ctrlKey||e(l.clientX,l.clientY)};var Se=L('<div class="title svelte-1emv8hj"><!></div>'),Ie=L('<label role="slider"><!> <input></label> <!>',1);function Yn(l,e){$(e,!0);let t=tt(e,"value",15,0),o=tt(e,"type",3,"text"),f=tt(e,"inputmode",3,"numeric"),s=tt(e,"step",3,1),r=tt(e,"min",19,()=>1/0*-1),d=tt(e,"row",3,!1),a=m(_(t())),u=m(_(t().toString()));const p=z=>{var j;i(a,_(z)),t(Math.max(r(),z)),i(u,_(t().toString())),(j=e.oninput)==null||j.call(e,t())};Pt(()=>{t()!==Xt(()=>n(a))&&(i(a,_(t())),i(u,_(t().toString())))});const w=z=>{i(u,_(z));const j=parseFloat(z);Number.isNaN(j)||p(j)},y=z=>{p(n(a)+z)};let k=m(!1),S=m(null),x=m(null),I=m(null),X=m(null),v=m(null),M=m(null),b=m(null);const c=H(()=>n(M)===null||n(X)===null?null:n(M)-n(X)),Y=H(()=>n(b)===null||n(v)===null?null:n(v)-n(b)),C=H(()=>n(c)===null||n(Y)===null?null:(n(c)+n(Y))*s()),U=(z,j)=>{n(k)||(i(k,!0),i(S,_(t())),i(x,_(z)),i(I,_(j)),i(X,_(z)),i(v,_(j)))},F=()=>{i(k,!1),i(S,null),i(x,null),i(I,null),i(X,null),i(v,null),i(M,null),i(b,null)},Z=(z,j)=>{i(X,_(n(M))),i(v,_(n(b))),i(M,_(z)),i(b,_(j)),n(C)!==null&&y(n(C))},h=z=>{F()},g=z=>{F()},K=z=>{Z(z.clientX,z.clientY)},P=z=>{z.key==="Escape"&&(p(n(S)),F(),nt(z))};var N=Ie();T("pointerup",V,function(...z){var j;(j=n(k)?h:void 0)==null||j.apply(this,z)}),T("pointermove",V,function(...z){var j;(j=n(k)?K:void 0)==null||j.apply(this,z)}),T("pointerleave",V,function(...z){var j;(j=n(k)?g:void 0)==null||j.apply(this,z)}),T("keydown",V,function(...z){var j;(j=n(k)?P:void 0)==null||j.apply(this,z)},!0);var ot=J(N);ot.__pointerdown=[ke,U];var xt=D(ot);{var jt=z=>{var j=Se(),Dt=D(j);_t(Dt,()=>e.children),R(j),E(z,j)};W(xt,z=>{e.children&&z(jt)})}var bt=q(xt,2);Ct(bt);var qt=z=>w(z.currentTarget.value);let kt;R(ot);var Bt=q(ot,2);{var Nt=z=>{gt(z,{get x_start(){return n(x)},get y_start(){return n(I)},get x_last(){return n(X)},get y_last(){return n(v)}})};W(Bt,z=>{n(k)&&z(Nt)})}B(()=>{Lt(ot,`${e.classes??""} svelte-1emv8hj`),A(ot,"aria-valuenow",n(C)),A(ot,"title",e.title),O(ot,"selected",n(k)),O(ot,"row",d()),kt=Ot(bt,kt,{...e.attrs,class:e.input_classes,value:n(u),oninput:qt,type:o(),inputmode:f(),step:s(),min:r(),max:e.max},"svelte-1emv8hj")}),E(l,N),Q()}st(["pointerdown"]);var Me=L('<div class="scene_renderer svelte-1hiky75"><!></div>');function Xn(l,e){$(e,!0);var t=Me(),o=D(t);{var f=s=>{var r=ct(),d=J(r);ge(d,()=>e.Component,(a,u)=>{u(a,{get scene(){return e.scene},get renderer(){return e.renderer}})}),E(s,r)};W(o,s=>{s(f)})}R(t),B(()=>{et(t,"width",`${e.renderer.width??""}px`),et(t,"height",`${e.renderer.height??""}px`),et(t,"min-width",`${e.renderer.width??""}px`),et(t,"min-height",`${e.renderer.height??""}px`)}),E(l,t),Q()}const Ye=(l,e)=>{e(l.clientX,l.clientY),nt(l)};var Xe=lt('<polygon role="none" class="unit_circle_radius_handles svelte-1i5of7p" fill="var(--color_selected)"></polygon><!>',1);function Ee(l,e){$(e,!0);const t=tt(e,"unit",7),o=tt(e,"size",3,pt),f=.5;let s=m(!1),r=m(null),d=m(null),a=m(null),u=m(null),p=m(null),w=m(null),y=m(null);const k=H(()=>t().x),S=H(()=>t().y-Math.max(o(),t().radius*Math.abs(t().scale))),x=H(()=>o()/2),I=(h,g)=>{n(s)||(i(s,!0),i(r,_(t().radius)),i(d,_(h)),i(a,_(g)),i(u,_(h)),i(p,_(g)))},X=()=>{i(s,!1),i(r,null),i(d,null),i(a,null),i(u,null),i(p,null),i(w,null),i(y,null)},v=(h,g)=>{i(u,_(n(w))),i(p,_(n(y))),i(w,_(h)),i(y,_(g)),n(u)!==null&&n(p)!==null&&(t().radius=ie(n(r)+f*(n(w)-n(d)-(n(y)-n(a)))))},M=h=>{X()},b=h=>{X()},c=h=>{v(h.clientX,h.clientY)},Y=h=>{h.key==="Escape"&&(t().radius=n(r),X(),nt(h))};var C=Xe();T("pointerup",V,function(...h){var g;(g=n(s)?M:void 0)==null||g.apply(this,h)}),T("pointermove",V,function(...h){var g;(g=n(s)?c:void 0)==null||g.apply(this,h)}),T("pointerleave",V,function(...h){var g;(g=n(s)?b:void 0)==null||g.apply(this,h)}),T("keydown",V,function(...h){var g;(g=n(s)?Y:void 0)==null||g.apply(this,h)},!0);var U=J(C);U.__pointerdown=[Ye,I];var F=q(U);{var Z=h=>{gt(h,{get x_start(){return n(d)},get y_start(){return n(a)},get x_last(){return n(u)},get y_last(){return n(p)}})};W(F,h=>{n(s)&&h(Z)})}B(()=>{A(U,"points",`${n(k)-n(x)},${n(S)-n(x)} ${n(k)+n(x)},${n(S)-n(x)} ${n(k)??""},${n(S)+n(x)}`),O(U,"pressing",n(s))}),E(l,C),Q()}st(["pointerdown"]);const Pe=(l,e)=>{e(l.clientX,l.clientY),nt(l)};var ze=lt('<circle role="none" class="unit_scale_handles svelte-rpawlp" fill="var(--color_selected)"></circle><!>',1);function Tt(l,e){$(e,!0);const t=tt(e,"unit",7),o=tt(e,"size",3,pt),f=.01;let s=m(!1),r=m(null),d=m(null),a=m(null),u=m(null),p=m(null),w=m(null),y=m(null),k=m(null),S=m(null);const x=H(()=>t().scene.controller.pressing_alt?"move":"nesw-resize"),I=(h,g)=>{n(s)||(i(s,!0),i(r,_(t().scale)),i(d,_(t().x)),i(a,_(t().y)),i(u,_(h)),i(p,_(g)),i(w,_(h)),i(y,_(g)))},X=()=>{i(s,!1),i(r,null),i(d,null),i(a,null),i(u,null),i(p,null),i(w,null),i(y,null),i(k,null),i(S,null)},v=(h,g)=>{i(w,_(n(k))),i(y,_(n(S))),i(k,_(h)),i(S,_(g)),n(w)!==null&&n(y)!==null&&(t().scene.controller.pressing_alt?t().move_center_to(t().x+(n(k)-n(w)),t().y+(n(S)-n(y))):t().scale=le(n(r)+f*(n(k)-n(u)-(n(S)-n(p)))))},M=h=>{X()},b=h=>{X()},c=h=>{v(h.clientX,h.clientY)},Y=h=>{h.key==="Escape"&&(t().scene.controller.pressing_alt?t().move_center_to(n(d),n(a)):t().scale=n(r),X(),nt(h))};var C=ze();T("pointerup",V,function(...h){var g;(g=n(s)?M:void 0)==null||g.apply(this,h)}),T("pointermove",V,function(...h){var g;(g=n(s)?c:void 0)==null||g.apply(this,h)}),T("pointerleave",V,function(...h){var g;(g=n(s)?b:void 0)==null||g.apply(this,h)}),T("keydown",V,function(...h){var g;(g=n(s)?Y:void 0)==null||g.apply(this,h)},!0);var U=J(C);U.__pointerdown=[Pe,I];var F=q(U);{var Z=h=>{gt(h,{get x_start(){return n(u)},get y_start(){return n(p)},get x_last(){return n(w)},get y_last(){return n(y)}})};W(F,h=>{n(s)&&h(Z)})}B(()=>{A(U,"cx",t().x),A(U,"cy",t().y),A(U,"r",o()/2),O(U,"pressing",n(s)),et(U,"cursor",n(x))}),E(l,C),Q()}st(["pointerdown"]);var Ce=L("<!> <!>",1);function Ke(l,e){var t=Ce(),o=J(t);Tt(o,{get unit(){return e.unit}});var f=q(o,2);Ee(f,{get unit(){return e.unit}}),E(l,t)}const Ae=(l,e)=>{e(l.clientX,l.clientY),nt(l)};var He=lt('<polygon role="none" class="unit_polygon_point_handles svelte-1fl6mbc" fill="var(--color_selected)"></polygon><!>',1);function Ue(l,e){$(e,!0);const t=tt(e,"size",3,pt);let o=m(!1),f=m(null),s=m(null),r=m(null),d=m(null),a=m(null),u=m(null),p=m(null),w=m(null),y=m(_(e.point));const k=H(()=>e.unit.x+e.transformed_point.x),S=H(()=>e.unit.y+e.transformed_point.y),x=H(()=>t()/2),I=H(()=>e.unit.scene.controller.pressing_ctrl&&e.unit.scene.controller.pressing_alt?"no-drop":e.unit.scene.controller.pressing_alt?e.unit.scene.controller.pressing_shift?"alias":"copy":"move"),X=(g,K)=>{if(e.unit.scene.controller.pressing_ctrl&&e.unit.scene.controller.pressing_alt){e.unit.points.length>3&&e.unit.remove_point(e.point);return}n(o)||(i(o,!0),e.unit.scene.controller.pressing_alt?i(y,_(e.unit.duplicate_point(e.point,e.unit.scene.controller.pressing_shift))):i(y,_(e.point)),i(f,_(n(y).x)),i(s,_(n(y).y)),i(r,_(g)),i(d,_(K)),i(a,_(g)),i(u,_(K)))},v=()=>{i(o,!1),i(f,null),i(s,null),i(r,null),i(d,null),i(a,null),i(u,null),i(p,null),i(w,null),i(y,_(e.point))},M=(g,K)=>{i(a,_(n(p))),i(u,_(n(w))),i(p,_(g)),i(w,_(K)),n(a)!==null&&n(u)!==null&&e.unit.move_transformed_point(n(y),n(p)-n(a),n(w)-n(u))},b=g=>{v()},c=g=>{v()},Y=g=>{M(g.clientX,g.clientY)},C=g=>{g.key==="Escape"&&(e.unit.scene.controller.pressing_alt&&n(y)!==e.point?e.unit.remove_point(n(y)):(n(y).x=n(f),n(y).y=n(s),e.unit.update_points()),v(),nt(g))};var U=He();T("pointerup",V,function(...g){var K;(K=n(o)?b:void 0)==null||K.apply(this,g)}),T("pointermove",V,function(...g){var K;(K=n(o)?Y:void 0)==null||K.apply(this,g)}),T("pointerleave",V,function(...g){var K;(K=n(o)?c:void 0)==null||K.apply(this,g)}),T("keydown",V,function(...g){var K;(K=n(o)?C:void 0)==null||K.apply(this,g)},!0);var F=J(U);F.__pointerdown=[Ae,X];var Z=q(F);{var h=g=>{gt(g,{get x_start(){return n(r)},get y_start(){return n(d)},get x_last(){return n(a)},get y_last(){return n(u)}})};W(Z,g=>{n(o)&&g(h)})}B(()=>{A(F,"points",`${n(k)-n(x)},${n(S)-n(x)} ${n(k)+n(x)},${n(S)-n(x)} ${n(k)??""},${n(S)+n(x)}`),O(F,"pressing",n(o)),et(F,"cursor",n(I))}),E(l,U),Q()}st(["pointerdown"]);const Te=(l,e)=>{e(l.clientX,l.clientY),nt(l)};var je=lt('<polygon role="none" class="unit_polygon_rotation_handles svelte-tnupuo" fill="var(--color_selected)"></polygon><!>',1);function qe(l,e){$(e,!0);const t=tt(e,"unit",7),o=tt(e,"size",3,pt),f=.013;let s=m(!1),r=m(null),d=m(null),a=m(null),u=m(null),p=m(null),w=m(null),y=m(null),k=m(null),S=m(null);const x=H(()=>t().scene.controller.pressing_alt?"move":"ew-resize"),I=H(()=>t().x+o()*Math.cos(-1*(t().rotation-Math.PI/2))),X=H(()=>t().y-o()*Math.sin(-1*(t().rotation-Math.PI/2))),v=H(()=>`${n(I)},${n(X)-o()/2} ${n(I)+o()/3},${n(X)} ${n(I)},${n(X)+o()/2} ${n(I)-o()/3},${n(X)}`),M=(P,N)=>{n(s)||(i(s,!0),i(r,_(t().rotation)),i(d,_(t().x)),i(a,_(t().y)),i(u,_(P)),i(p,_(N)),i(w,_(P)),i(y,_(N)))},b=()=>{i(s,!1),i(r,null),i(u,null),i(p,null),i(w,null),i(y,null),i(k,null),i(S,null)},c=(P,N)=>{i(w,_(n(k))),i(y,_(n(S))),i(k,_(P)),i(S,_(N)),n(w)!==null&&n(y)!==null&&(t().scene.controller.pressing_alt?t().move_center_to(t().x+(n(k)-n(w)),t().y+(n(S)-n(y))):t().rotation=oe(n(r)+f*(n(k)-n(u)-(n(S)-n(p)))))},Y=P=>{b()},C=P=>{b()},U=P=>{c(P.clientX,P.clientY)},F=P=>{P.key==="Escape"&&(t().scene.controller.pressing_alt?t().move_center_to(n(d),n(a)):t().rotation=n(r),b(),nt(P))};var Z=je();T("pointerup",V,function(...P){var N;(N=n(s)?Y:void 0)==null||N.apply(this,P)}),T("pointermove",V,function(...P){var N;(N=n(s)?U:void 0)==null||N.apply(this,P)}),T("pointerleave",V,function(...P){var N;(N=n(s)?C:void 0)==null||N.apply(this,P)}),T("keydown",V,function(...P){var N;(N=n(s)?F:void 0)==null||N.apply(this,P)},!0);var h=J(Z);h.__pointerdown=[Te,M];var g=q(h);{var K=P=>{gt(P,{get x_start(){return n(u)},get y_start(){return n(p)},get x_last(){return n(w)},get y_last(){return n(y)}})};W(g,P=>{n(s)&&P(K)})}B(()=>{A(h,"points",n(v)),A(h,"transform",`rotate(${t().rotation_degrees??""} ${n(I)??""} ${n(X)??""})`),O(h,"pressing",n(s)),et(h,"cursor",n(x))}),E(l,Z),Q()}st(["pointerdown"]);var Be=L("<!> <!> <!>",1);function Ne(l,e){$(e,!0);var t=Be(),o=J(t);Kt(o,18,()=>e.unit.points,r=>r,(r,d,a)=>{Ue(r,{get unit(){return e.unit},get point(){return d},get transformed_point(){return e.unit.transformed_points[n(a)]}})});var f=q(o,2);Tt(f,{get unit(){return e.unit}});var s=q(f,2);qe(s,{get unit(){return e.unit}}),E(l,t),Q()}function De(l,e){$(e,!0);const t=H(()=>e.unit.type);var o=ct(),f=J(o);{var s=d=>{Ke(d,{get unit(){return e.unit}})},r=d=>{var a=ct(),u=J(a);{var p=y=>{Ne(y,{get unit(){return e.unit}})},w=y=>{var k=at();B(()=>vt(k,Ht(n(t)))),E(y,k)};W(u,y=>{n(t)==="polygon"?y(p):y(w,!1)},!0)}E(d,a)};W(f,d=>{n(t)==="circle"?d(s):d(r,!1)})}E(l,o),Q()}var Re=L('<menu class="pane unstyled svelte-pa2qv7"><!></menu>'),Ve=L('<li role="none" class="svelte-pa2qv7"><div class="menu_item plain selectable svelte-pa2qv7" role="menuitem" aria-label="contextmenu submenmu" tabindex="-1"><div class="content"><div class="icon"><!></div> <div class="title"><!></div></div> <div class="chevron svelte-pa2qv7" aria-hidden="true"></div></div> <!></li>');function We(l,e){$(e,!0);const t=re.get(),o=t.add_submenu(),{layout:f}=t,s=H(()=>o.selected);let r=m(void 0);const d=Yt.get(),a=Yt.set();let u=m(0),p=m(0);Pt(()=>{n(r)&&w(n(r),f,d)});const w=(c,Y,C)=>{const{x:U,y:F,width:Z,height:h}=c.getBoundingClientRect();a.width=Z,a.height=h;const g=U-n(u),K=F-n(p),P=g+Z+C.width-Y.width;if(P<=0)i(u,_(C.width));else{const N=Z-g;N<=0?i(u,-Z):N>P?i(u,C.width-P):i(u,N-Z)}i(p,_(Math.min(0,Y.height-(K+h))))};var y=Ve(),k=D(y),S=D(k),x=D(S),I=D(x);_t(I,()=>e.icon??Et),R(x);var X=q(x,2),v=D(X);_t(v,()=>e.children),R(X),R(S),rt(2),R(k);var M=q(k,2);{var b=c=>{var Y=Re(),C=D(Y);_t(C,()=>e.menu),R(Y),ve(Y,U=>i(r,U),()=>n(r)),B(()=>{et(Y,"transform",`translate3d(${n(u)??""}px, ${n(p)??""}px, 0)`),et(Y,"max-height",`${f.height??""}px`)}),E(c,Y)};W(M,c=>{n(s)&&c(b)})}R(y),B(()=>{et(y,"--contextmenu_depth",o.depth),A(k,"aria-expanded",n(s)),O(k,"selected",n(s))}),T("mouseenter",k,c=>{nt(c),setTimeout(()=>t.select(o))}),E(l,y),Q()}var Fe=lt('<circle role="none"></circle>'),Ze=lt('<polygon role="none"></polygon>'),Je=lt('<svg class="unit_icon svelte-yrh1le"><!></svg>');function Le(l,e){$(e,!0);const t=tt(e,"padding",3,2),o=H(()=>e.unit.type),f=H(()=>e.unit.points),s=H(()=>e.unit.rotation),r=100,d=r/2,a=H(()=>`rotate(${n(s)*360/(Math.PI*2)} ${d} ${d})`),u=H(()=>{if(n(o)!=="polygon"||!n(f).length)return"";const S=n(f).map(Y=>Y.x),x=n(f).map(Y=>Y.y),I=(Math.min(...S)+Math.max(...S))/2,X=(Math.min(...x)+Math.max(...x))/2,v=Math.max(...n(f).map(Y=>Math.sqrt((Y.x-I)**2+(Y.y-X)**2))),M=(r-t()*2)/(v*2),b=r/2-I*M,c=r/2-X*M;return n(f).map(Y=>`${Y.x*M+b},${Y.y*M+c}`).join(" ")});var p=Je();A(p,"viewBox",`0 0 ${r} ${r}`);var w=D(p);{var y=S=>{var x=Fe();A(x,"cx",d),A(x,"cy",d),B(()=>{A(x,"r",(r-t()*2)/2.6),A(x,"fill",e.unit.color),A(x,"transform",n(a))}),E(S,x)},k=S=>{var x=ct(),I=J(x);{var X=M=>{var b=Ze();B(()=>{A(b,"points",n(u)),A(b,"fill",e.unit.color),A(b,"transform",n(a))}),E(M,b)},v=M=>{var b=at();B(()=>vt(b,Ht(n(o)))),E(M,b)};W(I,M=>{n(o)==="polygon"?M(X):M(v,!1)},!0)}E(S,x)};W(w,S=>{n(o)==="circle"?S(y):S(k,!1)})}R(p),E(l,p),Q()}var Oe=L("<!> <!> <!> <!>",1),Ge=L("<small><code> </code></small>"),Qe=L("Unit <!>",1),$e=L('<div class="display_contents"><!></div>');function tn(l,e){$(e,!0);const t=d=>{var a=ct(),u=J(a);{var p=w=>{We(w,{menu:S=>{var x=Oe(),I=J(x);mt(I,{icon:"⎘",run:()=>{const c=e.unit.clone();c.x+=10,c.y+=10,e.scene.add_unit(c)},children:(c,Y)=>{rt();var C=at("Duplicate unit");E(c,C)},$$slots:{default:!0}});var X=q(I,2);{var v=c=>{mt(c,{icon:"◎",run:()=>{e.unit.create_new_point()},children:(Y,C)=>{rt();var U=at("Add point to polygon");E(Y,U)},$$slots:{default:!0}})};W(X,c=>{e.unit.type==="polygon"&&c(v)})}var M=q(X,2);mt(M,{icon:"⌸",run:async()=>{const c=JSON.stringify(e.unit.json);await navigator.clipboard.writeText(c)},children:(c,Y)=>{rt();var C=at("Copy data to clipboard");E(c,C)},$$slots:{default:!0}});var b=q(M,2);mt(b,{icon:"✕",run:()=>{e.scene.remove_unit(e.unit)},children:(c,Y)=>{rt();var C=at("Delete unit");E(c,C)},$$slots:{default:!0}}),E(S,x)},icon:S=>{Le(S,{get unit(){return e.unit}})},children:(S,x)=>{rt();var I=Qe(),X=q(J(I));{var v=b=>{var c=at();B(()=>vt(c,e.unit.name)),E(b,c)},M=b=>{var c=Ge(),Y=D(c),C=D(Y,!0);R(Y),R(c),B(()=>vt(C,e.unit.id_string)),E(b,c)};W(X,b=>{e.unit.name?b(v):b(M,!1)})}E(S,I)},$$slots:{menu:!0,icon:!0,default:!0}})};W(u,w=>{e.unit&&w(p)})}E(d,a)};var o=ct(),f=J(o);{var s=d=>{var a=$e(),u=D(a);_t(u,()=>e.children),R(a),se(a,(p,w)=>{var y;return(y=ae)==null?void 0:y(p,w)},()=>t),B(()=>A(a,"data-unit",e.unit.id)),E(d,a)},r=d=>{var a=ct(),u=J(a);_t(u,()=>e.children),E(d,a)};W(f,d=>{e.unit?d(s):d(r,!1)})}E(l,o),Q()}const en=()=>({selecting:!1,selection_start_x:0,selection_start_y:0,selection_width:0,selection_height:0,initial_pointer_x:0,initial_pointer_y:0});var yt,it,ut;class nn{constructor(e){It(this,"selection_threshold",0);dt(this,yt,m(_(en())));dt(this,it,m(_(new Set)));dt(this,ut,m(_(new Set)));this.helpers=e}get state(){return n(G(this,yt))}set state(e){i(G(this,yt),_(e))}has(e){return n(G(this,it)).has(e)}add(e){n(G(this,it)).add(e)}delete(e){n(G(this,it)).delete(e)}clear(){n(G(this,it)).clear()}get_selected_items(){return Array.from(n(G(this,it)))}handle_selection_start(e,t,o){const f=this.helpers.find_top_item(e,t),s=f&&this.has(f);if(this.state.initial_pointer_x=e,this.state.initial_pointer_y=t,i(G(this,ut),_(new Set(n(G(this,it))))),o==="subtractive"&&s){this.delete(f);return}f&&o!=="subtractive"?(o==="normal"&&this.clear(),this.add(f)):o==="normal"&&this.clear()}start_drag(e,t){this.state.selecting=!0,this.state.selection_start_x=e,this.state.selection_start_y=t,this.state.selection_width=0,this.state.selection_height=0}update_drag(e,t,o){if(!this.state.selecting)return;this.state.selection_width=e-this.state.selection_start_x,this.state.selection_height=t-this.state.selection_start_y;const f=this.state.selection_width>=0?this.state.selection_start_x:e,s=this.state.selection_height>=0?this.state.selection_start_y:t,r=Math.abs(this.state.selection_width),d=Math.abs(this.state.selection_height),a=this.helpers.find_all_items(f,s,r,d);switch(o){case"additive":i(G(this,it),_(new Set(n(G(this,ut)))));for(const u of a)this.add(u);break;case"subtractive":i(G(this,it),_(new Set(n(G(this,ut)))));for(const u of a)this.delete(u);break;case"normal":this.clear();for(const u of a)this.add(u);break;default:throw new ue(o)}}end_drag(e,t,o){const f=e-this.state.initial_pointer_x,s=t-this.state.initial_pointer_y,r=Math.sqrt(f*f+s*s)>this.selection_threshold;this.state.selecting&&r&&this.update_drag(e,t,o),this.state.selecting=!1,this.state.selection_width=0,this.state.selection_height=0,n(G(this,ut)).clear()}}yt=new WeakMap,it=new WeakMap,ut=new WeakMap;const ln=(l,e,t,o,f,s,r,d)=>{e(l.offsetX,l.offsetY),t(t().pointer_down=!0,!0),t(t().drag_start_x=t().pointer_x,!0),t(t().drag_start_y=t().pointer_y,!0),t(t().drag_start_client_x=t(t().pointer_last_client_x=l.clientX,!0),!0),t(t().drag_start_client_y=t(t().pointer_last_client_y=l.clientY,!0),!0);const a=l.shiftKey&&l.ctrlKey&&!l.altKey;if(t().hovering_handle){!l.altKey&&l.shiftKey&&t().hovering_unit&&(t(t().dragging_unit=t().hovering_unit,!0),t(t().dragging_selection=!0,!0),o.unit_selection.has(t().hovering_unit)||((!l.ctrlKey||a)&&o.unit_selection.clear(),o.unit_selection.add(t().hovering_unit)),a&&n(f)&&s());return}const u=t().hovering_unit;if(u&&o.unit_selection.has(u)&&(l.shiftKey&&!l.altKey||!l.ctrlKey)){t(t().dragging_unit=u,!0),t(t().dragging_selection=!0,!0),a&&n(f)&&s();return}r.handle_selection_start(t().pointer_x,t().pointer_y,d(l)),o.unit_selection.clear();for(const w of r.get_selected_items())o.unit_selection.add(w)},on=(l,e,t,o,f,s,r)=>{if(e(l.offsetX,l.offsetY),t.state.selecting){t.end_drag(o().pointer_x,o().pointer_y,f(l)),s.unit_selection.clear();for(const d of t.get_selected_items())s.unit_selection.add(d)}r()},rn=(l,e,t,o,f,s)=>{if(e(l.offsetX,l.offsetY),t(t().pointer_last_client_x=l.clientX,!0),t(t().pointer_last_client_y=l.clientY,!0),t().pointer_down&&!t().dragging_unit){const r=t().pointer_x-o.state.initial_pointer_x,d=t().pointer_y-o.state.initial_pointer_y;Math.sqrt(r*r+d*d)>o.selection_threshold&&!o.state.selecting&&o.start_drag(o.state.initial_pointer_x,o.state.initial_pointer_y)}if(o.state.selecting){o.update_drag(t().pointer_x,t().pointer_y,f(l)),s.unit_selection.clear();for(const r of o.get_selected_items())s.unit_selection.add(r)}};var sn=lt('<rect class="selection_rect svelte-1s96klh"></rect>'),an=L('<div class="scene_interaction_surface svelte-1s96klh"><svg class="controls_layer svelte-1s96klh"><!><!></svg></div> <!>',1);function En(l,e){$(e,!0);const t=tt(e,"scene_interaction_surface_state",15),o=H(()=>e.scene.controller),f=v=>v,s=v=>v,r=new nn({find_top_item:e.scene.find_top_unit_at_point,find_all_items:e.scene.find_all_units_in_rect}),d=v=>v.shiftKey&&v.ctrlKey?"additive":v.ctrlKey?"subtractive":v.shiftKey?"additive":"normal",a=H(()=>t().hovering_unit!==null&&e.unit_selection.has(t().hovering_unit)),u=(v,M)=>{const b=f(v),c=s(M),Y=t().pointer_x,C=t().pointer_y;if(t(t().pointer_x=b,!0),t(t().pointer_y=c,!0),t().dragging_unit){const U=b-Y,F=c-C;for(const Z of e.unit_selection)Z.x+=U,Z.y+=F}else t(t().hovering_unit=e.scene.find_top_unit_at_point(b,c),!0),t().hovering_unit&&t(t().hovered_unit=t().hovering_unit,!0)},p=()=>{t(t().pointer_down=!1,!0),t(t().drag_start_x=null,!0),t(t().drag_start_y=null,!0),t(t().dragging_unit=null,!0),t(t().dragging_selection=!1,!0),t(t().drag_start_client_x=null,!0),t(t().drag_start_client_y=null,!0),t(t().pointer_last_client_x=null,!0),t(t().pointer_last_client_y=null,!0)},w=()=>{const v=[];for(const M of e.unit_selection){const b=M.clone();e.scene.add_unit(b),v.push(b)}e.unit_selection.clear(),r.clear();for(const M of v)e.unit_selection.add(M),r.add(M)},y=v=>{u(v.offsetX,v.offsetY),t(t().pointing=!0,!0)},k=v=>{u(v.offsetX,v.offsetY),t(t().pointing=!1,!0),t(t().hovering_unit=null,!0)},S=v=>{t().pointer_down&&t(t().pointer_down=!1,!0),t(t().dragging_unit=null,!0),t(t().dragging_selection=!1,!0)},x=v=>{(v.key==="Shift"||v.key==="Control")&&r.update_drag(t().pointer_x,t().pointer_y,d(v))},I=v=>{(v.key==="Shift"||v.key==="Control")&&r.update_drag(t().pointer_x,t().pointer_y,d(v))},X=v=>{if(!ce(v.target))return;const{key:M}=v;if(M==="Escape"){if(!t().dragging_unit)return;const b=t().pointer_x-t().drag_start_x,c=t().pointer_y-t().drag_start_y;for(const Y of e.unit_selection)Y.x-=b,Y.y-=c;p(),nt(v)}else if(M==="Delete"){for(const b of e.unit_selection)e.scene.remove_unit(b);e.unit_selection.clear(),r.clear(),p(),nt(v)}};T("keydown",V,x),T("keyup",V,I),T("keydown",V,X,!0),tn(l,{get scene(){return e.scene},get unit(){return t().hovered_unit},children:(v,M)=>{var b=an(),c=J(b);c.__pointerdown=[ln,u,t,e,a,w,r,d],c.__pointerup=[on,u,r,t,d,e,p],c.__pointermove=[rn,u,t,r,d,e];const Y=H(()=>t().hovering_unit&&e.unit_selection.has(t().hovering_unit)&&!r.state.selecting&&!t().pointer_down);B(()=>O(c,"grabbable",n(Y)));var C=D(c),U=D(C);Kt(U,16,()=>Array.from(e.unit_selection),K=>K,(K,P)=>{De(K,{get unit(){return P}})});var F=q(U);{var Z=K=>{var P=sn();B(()=>A(P,"width",Math.abs(r.state.selection_width))),B(()=>A(P,"height",Math.abs(r.state.selection_height))),B(()=>{A(P,"x",r.state.selection_width>=0?r.state.selection_start_x:r.state.selection_start_x+r.state.selection_width),A(P,"y",r.state.selection_height>=0?r.state.selection_start_y:r.state.selection_start_y+r.state.selection_height)}),E(K,P)};W(F,K=>{r.state.selecting&&K(Z)})}R(C),R(c);var h=q(c,2);{var g=K=>{gt(K,{get x_start(){return t().drag_start_client_x},get y_start(){return t().drag_start_client_y},get x_last(){return t().pointer_last_client_x},get y_last(){return t().pointer_last_client_y}})};W(h,K=>{t().dragging_unit&&K(g)})}B(()=>{O(c,"pressing",t().pointer_down),O(c,"selecting",r.state.selecting),O(c,"hovering",!!t().hovering_unit),O(c,"hovering_selection",n(a)),O(c,"grabbing",t().dragging_unit!==null),O(c,"pressing_shift",n(o).pressing_shift),O(c,"pressing_ctrl",n(o).pressing_ctrl),O(c,"pressing_alt",n(o).pressing_alt),et(c,"width",`${e.width??""}px`),et(c,"height",`${e.height??""}px`),A(C,"width",e.width),A(C,"height",e.height)}),T("pointerenter",c,y),T("pointerleave",c,k),T("pointercancel",c,S),E(v,b)},$$slots:{default:!0}}),Q()}st(["pointerdown","pointerup","pointermove"]);var un=L('<div class="flex align_items_end font_weight_700 px_md font_mono"><div class="text_align_right pr_xs"> </div> <div class="text_color_4">fps</div></div>');function Pn(l,e){$(e,!0);const t=H(()=>e.clock??_e.get());var o=un(),f=D(o);et(f,"width","4rem");var s=D(f,!0);R(f),rt(2),R(o),B(()=>vt(s,n(t).average_fps)),E(l,o),Q()}var cn=(l,e)=>i(e,!0),_n=L("<p><strong>WASD</strong> and <strong>arrow keys</strong> to move the player</p>"),dn=L("<p><strong>` Backtick</strong> to toggle playing</p>"),gn=L('<div class="content pane svelte-1487nr8"><h2 class="mt_0">Global controls</h2> <!> <p><strong>r</strong> to reset</p> <p><strong>spacebar</strong> to toggle the clock</p> <!> <p><strong>~ Shift+Backtick</strong> to toggle editing</p> <p>edit with mouse and <strong>Ctrl</strong>/<strong>Shift</strong>/<strong>Alt</strong>:</p> <ul><li><strong>Shift</strong> to add to selection</li> <li><strong>Ctrl</strong> to remove from selection</li> <li><strong>Delete</strong> to delete the selected units</li> <li><strong>Shift+Ctrl</strong> to duplicate the selected units</li> <li><strong>Alt</strong> to recenter polygons</li> <li><strong>Alt</strong> to duplicate points</li> <li><strong>Alt+Shift</strong> to duplicate points counterclockwise</li> <li><strong>Alt+Ctrl</strong> to delete points</li></ul></div>'),vn=L('<button type="button">help</button> <!>',1);function zn(l,e){$(e,!0);const t=At.get();let o=m(!1);var f=vn(),s=J(f);s.__click=[cn,o];var r=q(s,2);{var d=a=>{de(a,{onclose:()=>i(o,!1),children:(u,p)=>{var w=gn(),y=q(D(w),2);{var k=I=>{var X=_n();E(I,X)};W(y,I=>{t.player_input_enabled&&I(k)})}var S=q(y,6);{var x=I=>{var X=dn();E(I,X)};W(S,I=>{t.player_input_enabled&&I(x)})}rt(6),R(w),E(u,w)},$$slots:{default:!0}})};W(r,a=>{n(o)&&a(d)})}E(l,f),Q()}st(["click"]);export{Pn as F,zn as H,Mn as S,Le as U,Xn as a,En as b,Yn as c,tn as d};
